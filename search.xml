<?xml version="1.0" encoding="utf-8"?>
<search>
  <entry>
    <title>Cesium基本地图组件创建</title>
    <url>/2023/03/07/Cesium%E5%9F%BA%E6%9C%AC%E5%9C%B0%E5%9B%BE%E7%BB%84%E4%BB%B6%E5%88%9B%E5%BB%BA/</url>
    <content><![CDATA[<h5 id="最近的项目中用到了-CesiumJS-，目前基本使用的问题大体排清"><a href="#最近的项目中用到了-CesiumJS-，目前基本使用的问题大体排清" class="headerlink" title="最近的项目中用到了 CesiumJS ，目前基本使用的问题大体排清"></a>最近的项目中用到了 CesiumJS ，目前基本使用的问题大体排清</h5><ol>
<li><p>官网下载 <code>Cesium</code> 源码程序包，解压</p>
</li>
<li><p>解压后的目录中进入 <code>Build</code> 文件夹，找到 <code>Cesium</code> 文件夹，复制 <code>Cesium</code> 整个文件夹到项目的 <code>public</code> 文件夹下</p>
</li>
<li><p>项目根组件 <code>index.html</code> 中引入 <code>public</code> 下的 <code>Cesium</code> (目录根据自己实际情况改写)：</p>
<span id="more"></span>
  <figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">&lt;script type=<span class="string">&quot;text/javascript&quot;</span> src=<span class="string">&quot;xxx/Cesium/Cesium.js&quot;</span>&gt;&lt;/script&gt;</span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">&quot;stylesheet&quot;</span> <span class="attr">href</span>=<span class="string">&quot;xxx/Cesium/Widgets/widgets.css&quot;</span>/&gt;</span></span></span><br></pre></td></tr></table></figure>
</li>
<li><p>此时页面中即可引用 <code>Cesium</code> 库及其 <code>api</code> 了</p>
</li>
<li><p>以下是创建的基本地图组件，可以传入一个容器ID 供各个页面调用，可满足同时创建多个实例；<br/><br>父组件引用这个组件时只需要在mounted里面给地图容器一个 <code>ref</code> 值，然后调用子组件的 <code>loadMap()</code> 方法： <code>this.$refs.cesiumMap.loadMap()</code><br/><br><strong>注意：如果在线使用需要填入自己账户的defaultAccessToken</strong></p>
</li>
</ol>
 <figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;track3D-container&quot;</span> <span class="attr">:id</span>=<span class="string">&quot;cId&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br></pre></td></tr></table></figure>

 <figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">&lt;script&gt;</span><br><span class="line"><span class="keyword">let</span> viewer = <span class="literal">null</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line"> <span class="attr">name</span>: <span class="string">&#x27;cesiumMap&#x27;</span>,</span><br><span class="line"> <span class="attr">props</span>: [<span class="string">&#x27;cId&#x27;</span>],</span><br><span class="line"> <span class="attr">components</span>: &#123;&#125;,</span><br><span class="line"> <span class="attr">watch</span>: &#123;&#125;,</span><br><span class="line"> <span class="title function_">data</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> &#123;&#125;</span><br><span class="line"> &#125;,</span><br><span class="line"> <span class="attr">computed</span>: &#123;&#125;,</span><br><span class="line"> <span class="attr">methods</span>: &#123;</span><br><span class="line">  <span class="title function_">loadMap</span>(<span class="params"></span>) &#123;</span><br><span class="line">     <span class="comment">// Cesium.Ion.defaultAccessToken = &#x27;&#x27;</span></span><br><span class="line">      viewer = <span class="keyword">new</span> <span class="title class_">Cesium</span>.<span class="title class_">Viewer</span>(<span class="variable language_">this</span>.<span class="property">cId</span>, &#123;</span><br><span class="line">       <span class="attr">animation</span>: <span class="literal">false</span>, <span class="comment">// 隐藏动画控件</span></span><br><span class="line">       <span class="attr">baseLayerPicker</span>: <span class="literal">false</span>, <span class="comment">// 隐藏图层选择控件</span></span><br><span class="line">       <span class="attr">fullscreenButton</span>: <span class="literal">false</span>, <span class="comment">// 隐藏全屏按钮</span></span><br><span class="line">       <span class="attr">vrButton</span>: <span class="literal">false</span>, <span class="comment">// 隐藏VR按钮，默认false</span></span><br><span class="line">       <span class="attr">geocoder</span>: <span class="literal">false</span>, <span class="comment">// 隐藏地名查找控件</span></span><br><span class="line">       <span class="attr">homeButton</span>: <span class="literal">false</span>, <span class="comment">// 隐藏Home按钮</span></span><br><span class="line">       <span class="attr">infoBox</span>: <span class="literal">false</span>, <span class="comment">// 隐藏点击要素之后显示的信息窗口</span></span><br><span class="line">       <span class="attr">sceneModePicker</span>: <span class="literal">false</span>, <span class="comment">// 隐藏场景模式选择控件</span></span><br><span class="line">       <span class="attr">selectionIndicator</span>: <span class="literal">true</span>, <span class="comment">// 显示实体对象选择框，默认true</span></span><br><span class="line">       <span class="attr">timeline</span>: <span class="literal">true</span>, <span class="comment">// 时间线控件</span></span><br><span class="line">       <span class="attr">navigationHelpButton</span>: <span class="literal">false</span>, <span class="comment">// 隐藏帮助按钮</span></span><br><span class="line">       <span class="attr">scene3DOnly</span>: <span class="literal">true</span>, <span class="comment">// 每个几何实例将只在3D中呈现，以节省GPU内存</span></span><br><span class="line">       <span class="attr">shouldAnimate</span>: <span class="literal">true</span>, <span class="comment">// 开启动画自动播放</span></span><br><span class="line">       <span class="attr">sceneMode</span>: <span class="number">3</span>, <span class="comment">// 初始场景模式 1：2D 2：2D循环 3：3D，默认3</span></span><br><span class="line">       <span class="attr">requestRenderMode</span>: <span class="literal">true</span>, <span class="comment">// 减少Cesium渲染新帧总时间并减少Cesium在应用程序中总体CPU使用率</span></span><br><span class="line">       <span class="comment">// 如场景中的元素没有随仿真时间变化，请考虑将设置maximumRenderTimeChange为较高的值，例如Infinity</span></span><br><span class="line">       <span class="comment">// maximumRenderTimeChange: Infinity,</span></span><br><span class="line">       <span class="attr">shadows</span>: <span class="literal">false</span>,</span><br><span class="line">       <span class="comment">// imageryProvider: new Cesium.UrlTemplateImageryProvider(&#123;</span></span><br><span class="line">       <span class="comment">//   url: cesium_config.baseMap,</span></span><br><span class="line">       <span class="comment">//   fileExtension: &quot;png&quot;</span></span><br><span class="line">       <span class="comment">// &#125;),</span></span><br><span class="line">       <span class="attr">imageryProvider</span>: <span class="keyword">new</span> <span class="title class_">Cesium</span>.<span class="title class_">ArcGisMapServerImageryProvider</span>(&#123;</span><br><span class="line">         <span class="attr">url</span>: <span class="string">&quot;https://services.arcgisonline.com/ArcGIS/rest/services/NatGeo_World_Map/MapServer/&quot;</span>,</span><br><span class="line">       &#125;),</span><br><span class="line">       <span class="comment">// terrainProvider: Cesium.createWorldTerrain(), // 地形</span></span><br><span class="line">     &#125;);</span><br><span class="line">     viewer.<span class="property">cesiumWidget</span>.<span class="property">creditContainer</span>.<span class="property">style</span>.<span class="property">display</span> = <span class="string">&quot;none&quot;</span></span><br><span class="line">     <span class="comment">// 以下设置为了使cesium地图鼠标控制符合mapbox习惯</span></span><br><span class="line">     <span class="comment">// 关闭双击事件</span></span><br><span class="line">     viewer.<span class="property">cesiumWidget</span>.<span class="property">screenSpaceEventHandler</span>.<span class="title function_">removeInputAction</span>(</span><br><span class="line">         <span class="title class_">Cesium</span>.<span class="property">ScreenSpaceEventType</span>.<span class="property">LEFT_DOUBLE_CLICK</span></span><br><span class="line">     );</span><br><span class="line">     <span class="comment">// 鼠标右键旋转</span></span><br><span class="line">     viewer.<span class="property">scene</span>.<span class="property">screenSpaceCameraController</span>.<span class="property">tiltEventTypes</span> = [</span><br><span class="line">       <span class="title class_">Cesium</span>.<span class="property">CameraEventType</span>.<span class="property">RIGHT_DRAG</span>,</span><br><span class="line">     ];</span><br><span class="line">     <span class="comment">// 中键滚动缩放</span></span><br><span class="line">     viewer.<span class="property">scene</span>.<span class="property">screenSpaceCameraController</span>.<span class="property">zoomEventTypes</span> = [</span><br><span class="line">       <span class="title class_">Cesium</span>.<span class="property">CameraEventType</span>.<span class="property">WHEEL</span>,</span><br><span class="line">     ];</span><br><span class="line">     <span class="comment">// 鼠标左键平移</span></span><br><span class="line">     viewer.<span class="property">scene</span>.<span class="property">screenSpaceCameraController</span>.<span class="property">rotateEventTypes</span> = [</span><br><span class="line">       <span class="title class_">Cesium</span>.<span class="property">CameraEventType</span>.<span class="property">LEFT_DRAG</span>,</span><br><span class="line">     ];</span><br><span class="line">     viewer.<span class="property">scene</span>.<span class="property">globe</span>.<span class="property">enableLighting</span> = <span class="literal">true</span></span><br><span class="line">     viewer.<span class="property">camera</span>.<span class="title function_">flyTo</span>(&#123;</span><br><span class="line">       <span class="attr">destination</span>: <span class="title class_">Cesium</span>.<span class="property">Cartesian3</span>.<span class="title function_">fromDegrees</span>(...map_config.<span class="property">MAP_CENTER</span>, <span class="number">30000</span>),</span><br><span class="line">       <span class="attr">orientation</span>: &#123;</span><br><span class="line">         <span class="attr">heading</span>: <span class="title class_">Cesium</span>.<span class="property">Math</span>.<span class="title function_">toRadians</span>(<span class="number">0</span>), <span class="comment">// 旋转角度</span></span><br><span class="line">         <span class="attr">pitch</span>: <span class="title class_">Cesium</span>.<span class="property">Math</span>.<span class="title function_">toRadians</span>(-<span class="number">90.0</span>), <span class="comment">// 相机方向</span></span><br><span class="line">       &#125;</span><br><span class="line">     &#125;);</span><br><span class="line">     <span class="keyword">return</span> viewer</span><br><span class="line">  &#125;,</span><br><span class="line"> &#125;,</span><br><span class="line"> <span class="title function_">mounted</span>(<span class="params"></span>) &#123;</span><br><span class="line"> &#125;,</span><br><span class="line"> <span class="title function_">created</span>(<span class="params"></span>) &#123;</span><br><span class="line"> &#125;,</span><br><span class="line"> <span class="title function_">beforeDestroy</span>(<span class="params"></span>) &#123;</span><br><span class="line"></span><br><span class="line"> &#125;</span><br><span class="line">&#125;</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>前端</category>
      </categories>
      <tags>
        <tag>Cesium</tag>
      </tags>
  </entry>
  <entry>
    <title>Cesium自定义popup封装使用</title>
    <url>/2023/03/07/Cesium%E8%87%AA%E5%AE%9A%E4%B9%89popup%E5%B0%81%E8%A3%85%E4%BD%BF%E7%94%A8/</url>
    <content><![CDATA[<h5 id="前几天项目中有个需求是基于Vue框架使用CesiumJS库，需要创建里面gltf模型对应的Popup弹窗组件-来介绍一些关于这个entity的详细信息。"><a href="#前几天项目中有个需求是基于Vue框架使用CesiumJS库，需要创建里面gltf模型对应的Popup弹窗组件-来介绍一些关于这个entity的详细信息。" class="headerlink" title="前几天项目中有个需求是基于Vue框架使用CesiumJS库，需要创建里面gltf模型对应的Popup弹窗组件 来介绍一些关于这个entity的详细信息。"></a>前几天项目中有个需求是基于<code>Vue</code>框架使用<code>CesiumJS</code>库，需要创建里面<code>gltf</code>模型对应的<code>Popup</code>弹窗组件 来介绍一些关于这个<code>entity</code>的详细信息。<br/></h5><ul>
<li>因为UI样式定制化较高，且可能多处需要调用，所以需要封装一个<code>Popup</code>组件。</li>
<li>并且如果使用原生<code>html</code>文本来一点点编写组件的话，开发起来会很呆 - -| 所以，改用创建并挂载一个<code>Vue</code>页面组件来实现这个弹窗页面。</li>
<li>接下来介绍一下实现步骤：<br/><span id="more"></span><ol>
<li><p>先全局注册一个<code>popup</code>组件，并在原型中加入一些配置方法，借鉴常用的一些其他库的<code>popup</code>应该具备的方法，一般会有：<code>setOffset</code>设置偏移、<code>remove</code>删除、<code>setTitle</code>设置标题、<code>setPosition</code>设置位置、<code>setHTML</code>设置内容、<code>addTo</code>添加至哪个场景，代码如下：</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> <span class="title class_">BaseEvent</span> = <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">		<span class="variable language_">this</span>.<span class="property">handles</span> = &#123;&#125;</span><br><span class="line">		<span class="variable language_">this</span>.<span class="property">cached</span> = []</span><br><span class="line">&#125;</span><br><span class="line"><span class="title class_">BaseEvent</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">on</span> = <span class="keyword">function</span> (<span class="params">eventName, callback</span>) &#123;</span><br><span class="line">		<span class="keyword">if</span> (<span class="keyword">typeof</span> callback !== <span class="string">&quot;function&quot;</span>) <span class="keyword">return</span>;</span><br><span class="line">		<span class="keyword">if</span> (!<span class="variable language_">this</span>.<span class="property">handles</span>[eventName]) &#123;</span><br><span class="line">				<span class="variable language_">this</span>.<span class="property">handles</span>[eventName] = [];</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="variable language_">this</span>.<span class="property">handles</span>[eventName].<span class="title function_">push</span>(callback);</span><br><span class="line">		<span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">cached</span>[eventName] <span class="keyword">instanceof</span> <span class="title class_">Array</span>) &#123;</span><br><span class="line">				<span class="comment">//说明有缓存的 可以执行</span></span><br><span class="line">				callback.<span class="title function_">apply</span>(<span class="literal">null</span>, <span class="variable language_">this</span>.<span class="property">cached</span>[eventName]);</span><br><span class="line">		&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="title class_">BaseEvent</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">emit</span> = <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">		<span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">handles</span>[<span class="variable language_">arguments</span>[<span class="number">0</span>]] <span class="keyword">instanceof</span> <span class="title class_">Array</span>) &#123;</span><br><span class="line">				<span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; <span class="variable language_">this</span>.<span class="property">handles</span>[<span class="variable language_">arguments</span>[<span class="number">0</span>]].<span class="property">length</span>; i++) &#123;</span><br><span class="line">						<span class="variable language_">this</span>.<span class="property">handles</span>[<span class="variable language_">arguments</span>[<span class="number">0</span>]][i](<span class="variable language_">arguments</span>[<span class="number">1</span>]);</span><br><span class="line">				&#125;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="comment">//默认缓存</span></span><br><span class="line">		<span class="variable language_">this</span>.<span class="property">cached</span>[<span class="variable language_">arguments</span>[<span class="number">0</span>]] = <span class="title class_">Array</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">slice</span>.<span class="title function_">call</span>(<span class="variable language_">arguments</span>, <span class="number">1</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> <span class="title class_">CesiumPopup</span> = (<span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">		<span class="keyword">var</span> _panelContainer = <span class="literal">null</span></span><br><span class="line">		<span class="keyword">var</span> _contentContainer = <span class="literal">null</span></span><br><span class="line">		<span class="keyword">var</span> _closeBtn = <span class="literal">null</span></span><br><span class="line">		<span class="keyword">var</span> _renderListener = <span class="literal">null</span></span><br><span class="line">		<span class="keyword">var</span> _viewer = <span class="literal">null</span></span><br><span class="line">		<span class="keyword">var</span> <span class="title class_">CesiumPopup</span> = <span class="keyword">function</span> (<span class="params">options</span>) &#123;</span><br><span class="line">				<span class="comment">//继承</span></span><br><span class="line">				<span class="title class_">BaseEvent</span>.<span class="title function_">call</span>(<span class="variable language_">this</span>)</span><br><span class="line">				<span class="variable language_">this</span>.<span class="property">className</span> = options.<span class="property">className</span> || <span class="string">&#x27;&#x27;</span></span><br><span class="line">				<span class="variable language_">this</span>.<span class="property">title</span> = options.<span class="property">title</span> || <span class="string">&#x27;&#x27;</span></span><br><span class="line">				<span class="variable language_">this</span>.<span class="property">offset</span> = options.<span class="property">offset</span> || [<span class="number">0</span>, <span class="number">0</span>]</span><br><span class="line">				<span class="comment">// this.render = this.render.bind(this)</span></span><br><span class="line">				<span class="variable language_">this</span>.<span class="property">closeHander</span> = <span class="variable language_">this</span>.<span class="property">closeHander</span>.<span class="title function_">bind</span>(<span class="variable language_">this</span>)</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="title class_">CesiumPopup</span>.<span class="property"><span class="keyword">prototype</span></span> = <span class="keyword">new</span> <span class="title class_">BaseEvent</span>()</span><br><span class="line">		<span class="title class_">CesiumPopup</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">constrctor</span> = <span class="title class_">CesiumPopup</span></span><br><span class="line">		<span class="title class_">CesiumPopup</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">addTo</span> = <span class="keyword">function</span> (<span class="params">viewer</span>) &#123;</span><br><span class="line">				<span class="keyword">if</span> (_viewer) <span class="variable language_">this</span>.<span class="title function_">remove</span>()</span><br><span class="line">				_viewer = viewer</span><br><span class="line">				<span class="variable language_">this</span>.<span class="title function_">initPanle</span>();</span><br><span class="line">				<span class="comment">//关闭按钮</span></span><br><span class="line">				_closeBtn.<span class="title function_">addEventListener</span>(<span class="string">&#x27;click&#x27;</span>, <span class="variable language_">this</span>.<span class="property">closeHander</span>, <span class="literal">false</span>)</span><br><span class="line">				<span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">position</span>) &#123;</span><br><span class="line">						_panelContainer.<span class="property">style</span>.<span class="property">display</span> = <span class="string">&#x27;block&#x27;</span></span><br><span class="line">						_renderListener = _viewer.<span class="property">scene</span>.<span class="property">postRender</span>.<span class="title function_">addEventListener</span>(<span class="variable language_">this</span>.<span class="property">render</span>, <span class="variable language_">this</span>)</span><br><span class="line">				&#125;</span><br><span class="line">				<span class="keyword">return</span> <span class="variable language_">this</span></span><br><span class="line">		&#125;</span><br><span class="line">		<span class="title class_">CesiumPopup</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">initPanle</span> = <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">				<span class="keyword">var</span> closeBtnIcon = <span class="string">&#x27;&lt;svg t=&quot;1603334792546&quot; class=&quot;icon&quot; viewBox=&quot;0 0 1024 1024&quot; version=&quot;1.1&quot; xmlns=&quot;http://www.w3.org/2000/svg&quot; p-id=&quot;1328&quot; width=&quot;32&quot; height=&quot;32&quot;&gt;&lt;path d=&quot;M568.922 508.232L868.29 208.807a39.139 39.139 0 0 0 0-55.145l-1.64-1.64a39.139 39.139 0 0 0-55.09 0l-299.367 299.82-299.425-299.934a39.139 39.139 0 0 0-55.088 0l-1.697 1.64a38.46 38.46 0 0 0 0 55.09l299.48 299.594-299.424 299.48a39.139 39.139 0 0 0 0 55.09l1.64 1.696a39.139 39.139 0 0 0 55.09 0l299.424-299.48L811.56 864.441a39.139 39.139 0 0 0 55.089 0l1.696-1.64a39.139 39.139 0 0 0 0-55.09l-299.48-299.537z&quot; p-id=&quot;1329&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&#x27;</span></span><br><span class="line">				_panelContainer = <span class="variable language_">document</span>.<span class="title function_">createElement</span>(<span class="string">&#x27;div&#x27;</span>)</span><br><span class="line">				_panelContainer.<span class="property">classList</span>.<span class="title function_">add</span>(<span class="string">&#x27;cesium-popup-panel&#x27;</span>)</span><br><span class="line">				<span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">className</span> &amp;&amp; <span class="variable language_">this</span>.<span class="property">className</span> !== <span class="string">&#x27;&#x27;</span>) &#123;</span><br><span class="line">						_panelContainer.<span class="property">classList</span>.<span class="title function_">add</span>(<span class="variable language_">this</span>.<span class="property">className</span>)</span><br><span class="line">				&#125;</span><br><span class="line">				_closeBtn = <span class="variable language_">document</span>.<span class="title function_">createElement</span>(<span class="string">&#x27;div&#x27;</span>)</span><br><span class="line">				_closeBtn.<span class="property">classList</span>.<span class="title function_">add</span>(<span class="string">&#x27;cesium-popup-close-btn&#x27;</span>)</span><br><span class="line">				_closeBtn.<span class="property">innerHTML</span> = closeBtnIcon</span><br><span class="line">				<span class="comment">// header container</span></span><br><span class="line">				<span class="keyword">var</span> headerContainer = <span class="variable language_">document</span>.<span class="title function_">createElement</span>(<span class="string">&#x27;div&#x27;</span>)</span><br><span class="line">				headerContainer.<span class="property">classList</span>.<span class="title function_">add</span>(<span class="string">&#x27;cesium-popup-header-panel&#x27;</span>)</span><br><span class="line">				<span class="variable language_">this</span>.<span class="property">headerTitle</span> = <span class="variable language_">document</span>.<span class="title function_">createElement</span>(<span class="string">&#x27;div&#x27;</span>)</span><br><span class="line">				<span class="variable language_">this</span>.<span class="property">headerTitle</span>.<span class="property">classList</span>.<span class="title function_">add</span>(<span class="string">&#x27;cesium-poput-header-title&#x27;</span>)</span><br><span class="line">				<span class="variable language_">this</span>.<span class="property">headerTitle</span>.<span class="property">innerHTML</span> = <span class="variable language_">this</span>.<span class="property">title</span></span><br><span class="line">				headerContainer.<span class="title function_">appendChild</span>(<span class="variable language_">this</span>.<span class="property">headerTitle</span>)</span><br><span class="line">				_panelContainer.<span class="title function_">appendChild</span>(_closeBtn)</span><br><span class="line">				_panelContainer.<span class="title function_">appendChild</span>(headerContainer)</span><br><span class="line">				<span class="comment">// content container</span></span><br><span class="line">				_contentContainer = <span class="variable language_">document</span>.<span class="title function_">createElement</span>(<span class="string">&#x27;div&#x27;</span>)</span><br><span class="line">				_contentContainer.<span class="property">classList</span>.<span class="title function_">add</span>(<span class="string">&#x27;cesium-popup-content-panel&#x27;</span>)</span><br><span class="line">				_contentContainer.<span class="property">innerHTML</span> = <span class="variable language_">this</span>.<span class="property">content</span></span><br><span class="line">				_panelContainer.<span class="title function_">appendChild</span>(_contentContainer)</span><br><span class="line">				<span class="comment">//tip container</span></span><br><span class="line">				<span class="keyword">var</span> tipContaienr = <span class="variable language_">document</span>.<span class="title function_">createElement</span>(<span class="string">&#x27;div&#x27;</span>)</span><br><span class="line">				tipContaienr.<span class="property">classList</span>.<span class="title function_">add</span>(<span class="string">&#x27;cesium-popup-tip-panel&#x27;</span>)</span><br><span class="line">				<span class="keyword">var</span> tipDiv = <span class="variable language_">document</span>.<span class="title function_">createElement</span>(<span class="string">&#x27;div&#x27;</span>)</span><br><span class="line">				tipDiv.<span class="property">classList</span>.<span class="title function_">add</span>(<span class="string">&#x27;cesium-popup-tip-bottom&#x27;</span>)</span><br><span class="line">				tipContaienr.<span class="title function_">appendChild</span>(tipDiv)</span><br><span class="line">				_panelContainer.<span class="title function_">appendChild</span>(tipContaienr)</span><br><span class="line">				_panelContainer.<span class="property">style</span>.<span class="property">display</span> = <span class="string">&#x27;none&#x27;</span></span><br><span class="line">				<span class="comment">// add to Viewer Container</span></span><br><span class="line">				_viewer.<span class="property">cesiumWidget</span>.<span class="property">container</span>.<span class="title function_">appendChild</span>(_panelContainer)</span><br><span class="line">				<span class="variable language_">this</span>.<span class="title function_">emit</span>(<span class="string">&#x27;open&#x27;</span>)</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="title class_">CesiumPopup</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">setHTML</span> = <span class="keyword">function</span> (<span class="params">html</span>) &#123;</span><br><span class="line">				<span class="keyword">if</span> (_contentContainer) &#123;</span><br><span class="line">						_contentContainer.<span class="property">innerHTML</span> = html</span><br><span class="line">				&#125;</span><br><span class="line">				<span class="variable language_">this</span>.<span class="property">content</span> = html</span><br><span class="line">				<span class="keyword">return</span> <span class="variable language_">this</span>;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="title class_">CesiumPopup</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">render</span> = <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">				<span class="keyword">var</span> geometry = <span class="variable language_">this</span>.<span class="property">position</span></span><br><span class="line">				<span class="keyword">if</span> (!geometry) <span class="keyword">return</span></span><br><span class="line">				<span class="keyword">var</span> position = <span class="title class_">Cesium</span>.<span class="property">SceneTransforms</span>.<span class="title function_">wgs84ToWindowCoordinates</span>(_viewer.<span class="property">scene</span>, geometry)</span><br><span class="line">				<span class="keyword">if</span> (!position) &#123;</span><br><span class="line">						<span class="keyword">return</span></span><br><span class="line">				&#125;</span><br><span class="line">				<span class="keyword">if</span> (_panelContainer) &#123;</span><br><span class="line">						_panelContainer.<span class="property">style</span>.<span class="property">left</span> = position.<span class="property">x</span> - _panelContainer.<span class="property">offsetWidth</span> / <span class="number">2</span> + <span class="variable language_">this</span>.<span class="property">offset</span>[<span class="number">0</span>] + <span class="string">&#x27;px&#x27;</span>;</span><br><span class="line">						_panelContainer.<span class="property">style</span>.<span class="property">top</span> = position.<span class="property">y</span> - _panelContainer.<span class="property">offsetHeight</span> - <span class="number">10</span> + <span class="variable language_">this</span>.<span class="property">offset</span>[<span class="number">1</span>] + <span class="string">&#x27;px&#x27;</span>;</span><br><span class="line">				&#125;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="title class_">CesiumPopup</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">setPosition</span> = <span class="keyword">function</span> (<span class="params">cartesian3</span>) &#123;</span><br><span class="line">				<span class="variable language_">this</span>.<span class="property">position</span> = cartesian3</span><br><span class="line">				<span class="keyword">return</span> <span class="variable language_">this</span>;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="title class_">CesiumPopup</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">addClassName</span> = <span class="keyword">function</span> (<span class="params">className</span>) &#123;</span><br><span class="line">				<span class="keyword">if</span> (_panelContainer) &#123;</span><br><span class="line">						_panelContainer.<span class="property">classList</span>.<span class="title function_">add</span>(className)</span><br><span class="line">				&#125;</span><br><span class="line">				<span class="keyword">return</span> <span class="variable language_">this</span>;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="title class_">CesiumPopup</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">removeClass</span> = <span class="keyword">function</span> (<span class="params">className</span>) &#123;</span><br><span class="line">				<span class="keyword">if</span> (_panelContainer) &#123;</span><br><span class="line">						_panelContainer.<span class="property">classList</span>.<span class="title function_">remove</span>(className)</span><br><span class="line">				&#125;</span><br><span class="line">				<span class="keyword">return</span> <span class="variable language_">this</span>;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="title class_">CesiumPopup</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">setTitle</span> = <span class="keyword">function</span> (<span class="params">title</span>) &#123;</span><br><span class="line">				<span class="variable language_">this</span>.<span class="property">headerTitle</span>.<span class="property">innerHTML</span> = title</span><br><span class="line">				<span class="keyword">return</span> <span class="variable language_">this</span>;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="title class_">CesiumPopup</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">setOffset</span> = <span class="keyword">function</span> (<span class="params">offset</span>) &#123;</span><br><span class="line">				<span class="variable language_">this</span>.<span class="property">offset</span> = offset</span><br><span class="line">				<span class="keyword">return</span> <span class="variable language_">this</span>;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="title class_">CesiumPopup</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">closeHander</span> = <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">				<span class="variable language_">this</span>.<span class="title function_">remove</span>()</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="title class_">CesiumPopup</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">remove</span> = <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">				<span class="keyword">if</span>(_closeBtn)_closeBtn.<span class="title function_">removeEventListener</span>(<span class="string">&#x27;click&#x27;</span>, <span class="variable language_">this</span>.<span class="property">closeHander</span>, <span class="literal">false</span>)</span><br><span class="line">				<span class="keyword">if</span> (_closeBtn) &#123;</span><br><span class="line">						_closeBtn.<span class="property">parentNode</span>.<span class="title function_">removeChild</span>(_closeBtn)</span><br><span class="line">						_closeBtn = <span class="literal">null</span></span><br><span class="line">				&#125;</span><br><span class="line">				<span class="keyword">if</span> (_contentContainer) &#123;</span><br><span class="line">						_contentContainer.<span class="property">parentNode</span>.<span class="title function_">removeChild</span>(_contentContainer)</span><br><span class="line">						_contentContainer = <span class="literal">null</span></span><br><span class="line">				&#125;</span><br><span class="line">				<span class="keyword">if</span> (_panelContainer) &#123;</span><br><span class="line">						_panelContainer.<span class="property">parentNode</span>.<span class="title function_">removeChild</span>(_panelContainer)</span><br><span class="line">						_panelContainer = <span class="literal">null</span></span><br><span class="line">				&#125;</span><br><span class="line">				<span class="keyword">if</span> (_renderListener) &#123;</span><br><span class="line">						<span class="title function_">_renderListener</span>()</span><br><span class="line">						_renderListener = <span class="literal">null</span></span><br><span class="line">				&#125;</span><br><span class="line">				<span class="keyword">if</span> (_viewer) &#123;</span><br><span class="line">						_viewer = <span class="literal">null</span></span><br><span class="line">				&#125;</span><br><span class="line">				<span class="variable language_">this</span>.<span class="title function_">emit</span>(<span class="string">&#x27;close&#x27;</span>)</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">return</span> <span class="title class_">CesiumPopup</span></span><br><span class="line">&#125;)()</span><br></pre></td></tr></table></figure>
<p><em>对应样式文件如下，可以自己随意调整</em></p>
  <figure class="highlight css"><table><tr><td class="code"><pre><span class="line"> <span class="comment">/* pop框css*/</span></span><br><span class="line"><span class="selector-class">.cesium-popup-panel</span> &#123;</span><br><span class="line">	<span class="attribute">opacity</span>: <span class="number">0.8</span>;</span><br><span class="line">	<span class="comment">/*width: 312px;*/</span></span><br><span class="line">	<span class="attribute">position</span>: absolute;</span><br><span class="line">	<span class="attribute">z-index</span>: <span class="number">0</span>;</span><br><span class="line">	<span class="comment">/*color: #00fcf9;*/</span></span><br><span class="line">	<span class="comment">/*background: rgba(23, 50, 108, 0.6);*/</span></span><br><span class="line">	<span class="comment">/*border: 1px solid #4674d6;*/</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.cesium-popup-close-btn</span> &gt; svg<span class="selector-pseudo">:hover</span> &#123;</span><br><span class="line">	<span class="attribute">color</span>: <span class="number">#00fcf9</span> <span class="meta">!important</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.cesium-popup-close-btn</span> &gt; svg &#123;</span><br><span class="line">	<span class="attribute">display</span>: none;</span><br><span class="line">	user-select: auto;</span><br><span class="line">	<span class="attribute">color</span>: <span class="number">#4674d6</span>;</span><br><span class="line">	<span class="attribute">cursor</span>: pointer;</span><br><span class="line">	<span class="attribute">width</span>: <span class="number">15px</span>;</span><br><span class="line">	<span class="comment">/* height: 15px; */</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>把此文件放到public文件夹下，在<code>index.html</code>入口通过<code>&lt;script&gt;</code>标签引入，此时，即可全局使用此组件。</p>
</li>
<li><p>使用：<br/><br>首先是基本使用，即<code>setHtml</code>时直接把内容用原生<code>html</code>文本嵌入到弹窗内容中：</p>
  <figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">popup = <span class="keyword">new</span> <span class="title class_">CesiumPopup</span>(&#123;<span class="attr">title</span>: <span class="string">&#x27;信息&#x27;</span>&#125;)</span><br><span class="line">	.<span class="title function_">setPosition</span>(<span class="title class_">Cesium</span>.<span class="property">Cartesian3</span>.<span class="title function_">fromDegrees</span>(lng, lat, <span class="number">1.5</span>))</span><br><span class="line">	.<span class="title function_">setHTML</span>(<span class="string">`&lt;div&gt;&lt;ul&gt;&lt;li&gt;1&lt;/li&gt;&lt;li&gt;2&lt;/li&gt;&lt;li&gt;3&lt;/li&gt;&lt;/ul&gt;&lt;/div&gt;`</span>)</span><br><span class="line">	.<span class="title function_">addTo</span>(viewer).<span class="title function_">setTitle</span>(<span class="string">&#x27;&#x27;</span>)</span><br><span class="line">	.<span class="title function_">setOffset</span>([-<span class="number">100</span>, -<span class="number">180</span>])</span><br></pre></td></tr></table></figure>
<p>  其次是稍微高级点的用法，先引入一个<code>Vue</code>组件，然后<code>setHtml</code>时提供一个唯一<code>div</code>的容器给<code>popup</code>弹窗，最后把之前引入的<code>Vue</code>组件挂载到这个唯一<code>div</code>的容器上，此时也可实现<code>props</code>传值，同时方便了组件编写开发：</p>
  <figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">popup = <span class="keyword">new</span> <span class="title class_">CesiumPopup</span>(&#123;<span class="attr">title</span>: <span class="string">&#x27;信息&#x27;</span>&#125;)</span><br><span class="line">		.<span class="title function_">setPosition</span>(<span class="title class_">Cesium</span>.<span class="property">Cartesian3</span>.<span class="title function_">fromDegrees</span>(lng, lat, <span class="number">1.5</span>))</span><br><span class="line">		.<span class="title function_">setHTML</span>(<span class="string">`&lt;div id=&quot;cesium_vehicle_popup&quot;&gt;&lt;/div&gt;`</span>)</span><br><span class="line">		.<span class="title function_">addTo</span>(viewer).<span class="title function_">setTitle</span>(<span class="string">&#x27;&#x27;</span>)</span><br><span class="line">		.<span class="title function_">setOffset</span>([-<span class="number">100</span>, -<span class="number">180</span>])</span><br><span class="line">		<span class="comment">// 这里的VehiclePopup是引入的其他Vue文件组件</span></span><br><span class="line">		<span class="keyword">new</span> <span class="title class_">VehiclePopup</span>(&#123;</span><br><span class="line">			<span class="comment">// 注意这个propsData是固定写法，里面的model才是穿的props对象</span></span><br><span class="line">			<span class="attr">propsData</span>: &#123;</span><br><span class="line">				<span class="attr">model</span>: <span class="variable language_">this</span>.<span class="property">detailData</span></span><br><span class="line">			&#125;,</span><br><span class="line">		&#125;).$mount(<span class="string">&#x27;#cesium_vehicle_popup&#x27;</span>)</span><br></pre></td></tr></table></figure></li>
<li><p>之后需要进行<code>popup</code>组件位置的调整和内容的改变只需要使用定义好的方法传参即可</p>
</li>
</ol>
</li>
</ul>
]]></content>
      <categories>
        <category>前端</category>
      </categories>
      <tags>
        <tag>Cesium</tag>
        <tag>Vue</tag>
      </tags>
  </entry>
  <entry>
    <title>Cesium加载3dtileset并修改位置/偏移位置</title>
    <url>/2024/02/23/Cesium%E5%8A%A0%E8%BD%BD3dtileset%E5%B9%B6%E4%BF%AE%E6%94%B9%E4%BD%8D%E7%BD%AE-%E5%81%8F%E7%A7%BB%E4%BD%8D%E7%BD%AE/</url>
    <content><![CDATA[<ul>
<li><p>在使用<code>cesium</code>进行开发时，有时需要加载一些外部的<code>3dtile</code>模型，由于模型制作者对模型的世界坐标可能只是随意赋值的，这时我们加载了后还需要对模型进行一定的<strong>偏移</strong>（<strong>包括经纬度和高度</strong>），以下是代码实现：</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> tileset = <span class="keyword">new</span> <span class="title class_">Cesium</span>.<span class="title class_">Cesium3DTileset</span>(&#123;</span><br><span class="line">  <span class="attr">url</span>: <span class="string">&#x27;&#x27;</span>, <span class="comment">// 托管tilesetjson根文件的 url 以及一些参数。。。</span></span><br><span class="line">&#125;); </span><br><span class="line">tileset.<span class="property">readyPromise</span>.<span class="title function_">then</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">//计算tileset的绑定范围</span></span><br><span class="line">  <span class="keyword">let</span> boundingSphere = tileset.<span class="property">boundingSphere</span>;</span><br><span class="line">  <span class="comment">//计算中心点位置</span></span><br><span class="line">  <span class="keyword">let</span> cartographic = <span class="title class_">Cesium</span>.<span class="property">Cartographic</span>.<span class="title function_">fromCartesian</span>(</span><br><span class="line">    boundingSphere.<span class="property">center</span></span><br><span class="line">  );</span><br><span class="line">  <span class="comment">//计算中心点位置的地表坐标</span></span><br><span class="line">  <span class="keyword">let</span> surface = <span class="title class_">Cesium</span>.<span class="property">Cartesian3</span>.<span class="title function_">fromRadians</span>(</span><br><span class="line">    cartographic.<span class="property">longitude</span>,</span><br><span class="line">    cartographic.<span class="property">latitude</span>,</span><br><span class="line">    <span class="number">0.0</span></span><br><span class="line">  );</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;tileset自身center : &quot;</span>, [</span><br><span class="line">    <span class="title class_">Cesium</span>.<span class="property">Math</span>.<span class="title function_">toDegrees</span>(cartographic.<span class="property">longitude</span>),</span><br><span class="line">    <span class="title class_">Cesium</span>.<span class="property">Math</span>.<span class="title function_">toDegrees</span>(cartographic.<span class="property">latitude</span>),</span><br><span class="line">  ]);</span><br><span class="line">  <span class="comment">// 偏移tileset到指定位置</span></span><br><span class="line">  <span class="keyword">const</span> heightOffset = <span class="number">100</span>; <span class="comment">// 高度偏移 正上负下</span></span><br><span class="line">  <span class="keyword">const</span> xOffset = <span class="number">100</span>; <span class="comment">// 经度偏移量 正负</span></span><br><span class="line">  <span class="keyword">const</span> yOffset = <span class="number">100</span>; <span class="comment">// 纬度偏移量 正负</span></span><br><span class="line">  <span class="keyword">let</span> x = <span class="title class_">Cesium</span>.<span class="property">Math</span>.<span class="title function_">toDegrees</span>(cartographic.<span class="property">longitude</span>);</span><br><span class="line">  <span class="keyword">let</span> y = <span class="title class_">Cesium</span>.<span class="property">Math</span>.<span class="title function_">toDegrees</span>(cartographic.<span class="property">latitude</span>);</span><br><span class="line">  <span class="keyword">let</span> offset = <span class="title class_">Cesium</span>.<span class="property">Cartesian3</span>.<span class="title function_">fromRadians</span>(</span><br><span class="line">    xOffset</span><br><span class="line">      ? <span class="title class_">Cesium</span>.<span class="property">Math</span>.<span class="title function_">toRadians</span>(x + xOffset)</span><br><span class="line">      : cartographic.<span class="property">longitude</span>,</span><br><span class="line">    yOffset</span><br><span class="line">      ? <span class="title class_">Cesium</span>.<span class="property">Math</span>.<span class="title function_">toRadians</span>(y + yOffset)</span><br><span class="line">      : cartographic.<span class="property">latitude</span>,</span><br><span class="line">    heightOffset</span><br><span class="line">  ); <span class="comment">// 进行经纬度和高度偏移</span></span><br><span class="line">  <span class="keyword">let</span> translation = <span class="title class_">Cesium</span>.<span class="property">Cartesian3</span>.<span class="title function_">subtract</span>(</span><br><span class="line">    offset,</span><br><span class="line">    surface,</span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">Cesium</span>.<span class="title class_">Cartesian3</span>()</span><br><span class="line">  );</span><br><span class="line">  <span class="comment">//tileset.modelMatrix转换</span></span><br><span class="line">  tileset.<span class="property">modelMatrix</span> = <span class="title class_">Cesium</span>.<span class="property">Matrix4</span>.<span class="title function_">fromTranslation</span>(translation);</span><br><span class="line">&#125;);</span><br><span class="line">viewer.<span class="property">scene</span>.<span class="property">primitives</span>.<span class="title function_">add</span>(tileset); <span class="comment">// 加载...</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>如果要根据指定经纬度偏移，对<strong>进行经纬度和高度偏移</strong>部分代码进行适当修改即可~~~</p>
</li>
</ul>
]]></content>
      <categories>
        <category>前端</category>
      </categories>
      <tags>
        <tag>Cesium</tag>
        <tag>Gis开发</tag>
      </tags>
  </entry>
  <entry>
    <title>ElementVue分页组件二次封装</title>
    <url>/2022/04/11/ElementUI-Vue%E5%88%86%E9%A1%B5%E7%BB%84%E4%BB%B6%E4%BA%8C%E6%AC%A1%E5%B0%81%E8%A3%85/</url>
    <content><![CDATA[<h2 id="Vue-Element-分页组件二次封装-免除了繁琐的事件编写-使用更方便"><a href="#Vue-Element-分页组件二次封装-免除了繁琐的事件编写-使用更方便" class="headerlink" title="Vue Element 分页组件二次封装 免除了繁琐的事件编写 使用更方便"></a>Vue Element 分页组件二次封装 免除了繁琐的事件编写 使用更方便</h2><h3 id="组件（复制粘贴即可用）"><a href="#组件（复制粘贴即可用）" class="headerlink" title="组件（复制粘贴即可用）"></a>组件（复制粘贴即可用）</h3><span id="more"></span>

<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  <span class="language-xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">:class</span>=<span class="string">&quot;&#123;&#x27;hidden&#x27;:hidden&#125;&quot;</span> <span class="attr">class</span>=<span class="string">&quot;pagination-container&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">el-pagination</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">      <span class="attr">:background</span>=<span class="string">&quot;background&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">      <span class="attr">:current-page.sync</span>=<span class="string">&quot;currentPage&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">      <span class="attr">:page-size.sync</span>=<span class="string">&quot;pageSize&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">      <span class="attr">:layout</span>=<span class="string">&quot;layout&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">      <span class="attr">:page-sizes</span>=<span class="string">&quot;pageSizes&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">      <span class="attr">:total</span>=<span class="string">&quot;total&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">      <span class="attr">v-bind</span>=<span class="string">&quot;$attrs&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">      @<span class="attr">size-change</span>=<span class="string">&quot;handleSizeChange&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">      @<span class="attr">current-change</span>=<span class="string">&quot;handleCurrentChange&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">    /&gt;</span></span></span><br><span class="line"><span class="language-xml">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="keyword">import</span> &#123; scrollTo &#125; <span class="keyword">from</span> <span class="string">&#x27;@/utils/scroll-to&#x27;</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  <span class="attr">name</span>: <span class="string">&#x27;Pagination&#x27;</span>,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  <span class="attr">props</span>: &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="attr">total</span>: &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      <span class="attr">required</span>: <span class="literal">true</span>,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      <span class="attr">type</span>: <span class="title class_">Number</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    &#125;,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="attr">page</span>: &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      <span class="attr">type</span>: <span class="title class_">Number</span>,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      <span class="attr">default</span>: <span class="number">1</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    &#125;,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="attr">limit</span>: &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      <span class="attr">type</span>: <span class="title class_">Number</span>,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      <span class="attr">default</span>: <span class="number">20</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    &#125;,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="attr">pageSizes</span>: &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      <span class="attr">type</span>: <span class="title class_">Array</span>,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      <span class="title function_">default</span>(<span class="params"></span>) &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        <span class="keyword">return</span> [<span class="number">10</span>, <span class="number">20</span>, <span class="number">30</span>, <span class="number">50</span>]</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      &#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    &#125;,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="attr">layout</span>: &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      <span class="attr">type</span>: <span class="title class_">String</span>,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      <span class="attr">default</span>: <span class="string">&#x27;total, sizes, prev, pager, next, jumper&#x27;</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    &#125;,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="attr">background</span>: &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      <span class="attr">type</span>: <span class="title class_">Boolean</span>,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      <span class="attr">default</span>: <span class="literal">true</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    &#125;,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="attr">autoScroll</span>: &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      <span class="attr">type</span>: <span class="title class_">Boolean</span>,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      <span class="attr">default</span>: <span class="literal">true</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    &#125;,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="attr">hidden</span>: &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      <span class="attr">type</span>: <span class="title class_">Boolean</span>,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      <span class="attr">default</span>: <span class="literal">false</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    &#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  &#125;,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  <span class="attr">computed</span>: &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="attr">currentPage</span>: &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      <span class="title function_">get</span>(<span class="params"></span>) &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="property">page</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      &#125;,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      <span class="title function_">set</span>(<span class="params">val</span>) &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        <span class="variable language_">this</span>.$emit(<span class="string">&#x27;update:page&#x27;</span>, val)</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      &#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    &#125;,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="attr">pageSize</span>: &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      <span class="title function_">get</span>(<span class="params"></span>) &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="property">limit</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      &#125;,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      <span class="title function_">set</span>(<span class="params">val</span>) &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        <span class="variable language_">this</span>.$emit(<span class="string">&#x27;update:limit&#x27;</span>, val)</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      &#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    &#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  &#125;,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  <span class="attr">methods</span>: &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="title function_">handleSizeChange</span>(<span class="params">val</span>) &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      <span class="variable language_">this</span>.$emit(<span class="string">&#x27;pagination&#x27;</span>, &#123; <span class="attr">page</span>: <span class="variable language_">this</span>.<span class="property">currentPage</span>, <span class="attr">limit</span>: val &#125;)</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">autoScroll</span>) &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        <span class="title function_">scrollTo</span>(<span class="number">0</span>, <span class="number">800</span>)</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      &#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    &#125;,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="title function_">handleCurrentChange</span>(<span class="params">val</span>) &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      <span class="variable language_">this</span>.$emit(<span class="string">&#x27;pagination&#x27;</span>, &#123; <span class="attr">page</span>: val, <span class="attr">limit</span>: <span class="variable language_">this</span>.<span class="property">pageSize</span> &#125;)</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">autoScroll</span>) &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        <span class="title function_">scrollTo</span>(<span class="number">0</span>, <span class="number">800</span>)</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      &#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    &#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  &#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">&#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">style</span> <span class="attr">scoped</span>&gt;</span><span class="language-css"></span></span></span><br><span class="line"><span class="language-css"><span class="language-xml"><span class="selector-class">.pagination-container</span> &#123;</span></span></span><br><span class="line"><span class="language-css"><span class="language-xml">  <span class="attribute">background</span>: <span class="number">#fff</span>;</span></span></span><br><span class="line"><span class="language-css"><span class="language-xml">  <span class="attribute">padding</span>: <span class="number">32px</span> <span class="number">16px</span>;</span></span></span><br><span class="line"><span class="language-css"><span class="language-xml">&#125;</span></span></span><br><span class="line"><span class="language-css"><span class="language-xml"><span class="selector-class">.pagination-container</span><span class="selector-class">.hidden</span> &#123;</span></span></span><br><span class="line"><span class="language-css"><span class="language-xml">  <span class="attribute">display</span>: none;</span></span></span><br><span class="line"><span class="language-css"><span class="language-xml">&#125;</span></span></span><br><span class="line"><span class="language-css"><span class="language-xml"></span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="使用"><a href="#使用" class="headerlink" title="使用"></a>使用</h3><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">&lt;pagination</span><br><span class="line">      v-show=<span class="string">&quot;total&gt;0&quot;</span></span><br><span class="line">      :total=<span class="string">&quot;total&quot;</span></span><br><span class="line">      :page.<span class="property">sync</span>=<span class="string">&quot;pageNum&quot;</span></span><br><span class="line">      :limit.<span class="property">sync</span>=<span class="string">&quot;pageSize&quot;</span></span><br><span class="line">      @pagination=<span class="string">&quot;getList&quot;</span></span><br><span class="line">    /&gt;</span><br><span class="line"><span class="title function_">getList</span>(<span class="params"></span>)&#123;</span><br><span class="line">  <span class="comment">//请求数据</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="非常好用"><a href="#非常好用" class="headerlink" title="非常好用~~~"></a>非常好用~~~</h2>]]></content>
      <categories>
        <category>前端</category>
      </categories>
      <tags>
        <tag>Vue</tag>
        <tag>ElementUI</tag>
      </tags>
  </entry>
  <entry>
    <title>el-table-column数据过长多行省略处理</title>
    <url>/2022/12/29/ElementUI-el-table-column%E6%95%B0%E6%8D%AE%E8%BF%87%E9%95%BF%E5%A4%9A%E8%A1%8C%E7%9C%81%E7%95%A5%E5%A4%84%E7%90%86/</url>
    <content><![CDATA[<h3 id="场景：在使用-el-table-时会遇到表格某行数据过长的情况"><a href="#场景：在使用-el-table-时会遇到表格某行数据过长的情况" class="headerlink" title="场景：在使用 el-table 时会遇到表格某行数据过长的情况"></a>场景：在使用 el-table 时会遇到表格某行数据过长的情况</h3><ul>
<li>一般的处理方式是直接使用 el-table-column 的 show-overflow-tooltip 来省略过长的内容</li>
<li>还有一种是特殊需求：需要 <strong>多行展示后</strong> 再进行省略显示。 以下是处理方式：<span id="more"></span><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">&lt;el-table-column</span><br><span class="line">	property=<span class="string">&quot;Date&quot;</span></span><br><span class="line">	label=<span class="string">&quot;Date&quot;</span>&gt;</span><br><span class="line">	<span class="comment">// 这里 template 的作用是 模拟 tooltip 的作用</span></span><br><span class="line">	<span class="language-xml"><span class="tag">&lt;<span class="name">template</span> <span class="attr">v-slot</span>=<span class="string">&quot;scope&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">		<span class="tag">&lt;<span class="name">div</span> <span class="attr">:title</span>=<span class="string">&quot;scope.row.Date&quot;</span> <span class="attr">v-html</span>=<span class="string">&quot;scope.row.Date&quot;</span> <span class="attr">class</span>=<span class="string">&quot;title-tips&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">	<span class="tag">&lt;/<span class="name">template</span>&gt;</span></span></span><br><span class="line">&lt;/el-table-column&gt;</span><br></pre></td></tr></table></figure>
  <figure class="highlight css"><table><tr><td class="code"><pre><span class="line">/deep/ <span class="selector-class">.el-table</span> <span class="selector-class">.cell</span> &#123;</span><br><span class="line">	<span class="attribute">word-break</span>: break-word ; // 避免一个单词被换行断开为两部分</span><br><span class="line">	<span class="attribute">overflow</span>:hidden;</span><br><span class="line">	<span class="attribute">text-overflow</span>:ellipsis;</span><br><span class="line">	<span class="attribute">display</span>:-webkit-box;</span><br><span class="line">	-webkit-box-orient:vertical;</span><br><span class="line">	-webkit-line-clamp:<span class="number">2</span>; // 此处是<span class="number">2</span>行的末尾再省略展示， 想要几行后再省略展示 就写几</span><br><span class="line">	<span class="attribute">max-height</span>: <span class="number">48px</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ul>
]]></content>
      <categories>
        <category>前端</category>
      </categories>
      <tags>
        <tag>ElementUI</tag>
      </tags>
  </entry>
  <entry>
    <title>cesium为entity添加跟随弹窗</title>
    <url>/2025/02/21/Cesium%E4%B8%BAentity%E6%B7%BB%E5%8A%A0%E8%B7%9F%E9%9A%8F%E5%BC%B9%E7%AA%97/</url>
    <content><![CDATA[<ul>
<li>项目需求：在 cesium 场景中为 entity 添加跟随弹窗，并且弹窗样式复杂</li>
<li>实现思路：<ol>
<li>如果是简单的 label 添加一行文字， 可以使用 billboard 直接完成</li>
<li>当前需求是复杂样式弹窗，所以需要根据使用框架考虑以组件的形式加载</li>
<li>我这边只在 vue 项目中使用，v2 v3 都有，所以涉及其他框架的组件 render 不是很清楚，但是基本原理应该是相似的</li>
</ol>
</li>
<li>步骤：<ol>
<li>创建一个 vue 组件，用于展示内容，例如 panel.vue</li>
<li>创建一个容器，使用 cesium 的 api 挂载到 cesium 上<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> pop <span class="keyword">from</span> <span class="string">&#x27;./pop.vue&#x27;</span></span><br><span class="line"><span class="keyword">let</span> toAppendDiv = <span class="variable language_">document</span>.<span class="title function_">createElement</span>(<span class="string">&#x27;div&#x27;</span>)</span><br><span class="line">toAppendDiv.<span class="property">id</span> = id</span><br><span class="line">toAppendDiv.<span class="property">style</span>.<span class="property">position</span> = <span class="string">&#x27;absolute&#x27;</span></span><br><span class="line">viewer.<span class="property">cesiumWidget</span>.<span class="property">container</span>.<span class="title function_">appendChild</span>(toAppendDiv)</span><br><span class="line"><span class="keyword">let</span> vNode = <span class="title function_">h</span>(pop, &#123;<span class="attr">model</span>: &#123;<span class="attr">name</span>: clickIndexStr&#125;&#125;)</span><br><span class="line"><span class="title function_">nextTick</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="title function_">render</span>(vNode, <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(clickIndexStr.<span class="property">value</span>))</span><br><span class="line">    panels[clickIndexStr.<span class="property">value</span>] = toAppendDiv</span><br><span class="line">    clickIndex.<span class="property">value</span>++</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure></li>
<li>在 postRender 添加监听事件，以实现弹窗位置跟随视角变化以及实体运动的效果<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">viewer.<span class="property">scene</span>.<span class="property">postRender</span>.<span class="title function_">addEventListener</span>(rerender)</span><br><span class="line"><span class="keyword">const</span> <span class="title function_">rerender</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">let</span> key <span class="keyword">in</span> panels) &#123;</span><br><span class="line">    <span class="keyword">let</span> targetPanel = panels[key]</span><br><span class="line">    <span class="keyword">let</span> positionI = <span class="title class_">Cesium</span>.<span class="property">Cartesian3</span>.<span class="title function_">fromDegrees</span>(clickLngLats[key][<span class="number">0</span>], clickLngLats[key][<span class="number">1</span>], <span class="number">0</span>)</span><br><span class="line">    <span class="keyword">let</span> position = <span class="title class_">Cesium</span>.<span class="property">SceneTransforms</span>.<span class="title function_">wgs84ToWindowCoordinates</span>(viewer.<span class="property">scene</span>, positionI)</span><br><span class="line">    <span class="keyword">if</span> (position) &#123;</span><br><span class="line">        targetPanel.<span class="property">style</span>.<span class="property">left</span> = position.<span class="property">x</span> + <span class="string">&#x27;px&#x27;</span></span><br><span class="line">        targetPanel.<span class="property">style</span>.<span class="property">top</span> = position.<span class="property">y</span> + <span class="string">&#x27;px&#x27;</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
</ol>
</li>
</ul>
]]></content>
      <categories>
        <category>前端</category>
      </categories>
      <tags>
        <tag>Cesium</tag>
        <tag>Vue</tag>
      </tags>
  </entry>
  <entry>
    <title>elementPlus的elTable自定义样式备用</title>
    <url>/2025/02/08/ElementPlus%E7%9A%84elTable%E8%87%AA%E5%AE%9A%E4%B9%89%E6%A0%B7%E5%BC%8F%E5%A4%87%E7%94%A8/</url>
    <content><![CDATA[<h5 id="众所周知-在实际的页面开发时，所有表单表格都需要高度自定义。这时如果每次来了新需求-再去使用-elementPlus-原生样式一点点改造就有点费劲，各种审查元素所以为了让后续的开发不在这种繁琐的事情上耗费经历，在这里记录一下，后续直接拿来改对应的颜色就行"><a href="#众所周知-在实际的页面开发时，所有表单表格都需要高度自定义。这时如果每次来了新需求-再去使用-elementPlus-原生样式一点点改造就有点费劲，各种审查元素所以为了让后续的开发不在这种繁琐的事情上耗费经历，在这里记录一下，后续直接拿来改对应的颜色就行" class="headerlink" title="众所周知 在实际的页面开发时，所有表单表格都需要高度自定义。这时如果每次来了新需求 再去使用 elementPlus 原生样式一点点改造就有点费劲，各种审查元素所以为了让后续的开发不在这种繁琐的事情上耗费经历，在这里记录一下，后续直接拿来改对应的颜色就行"></a>众所周知 在实际的页面开发时，所有表单表格都需要高度自定义。<br>这时如果每次来了新需求 再去使用 <code>elementPlus</code> 原生样式一点点改造就有点费劲，各种审查元素<br>所以为了让后续的开发不在这种繁琐的事情上耗费经历，在这里记录一下，后续直接拿来改对应的颜色就行</h5><ul>
<li>首先是 <code>html</code> 部分，用 <code>attr</code> 给一组类名就行，对应下面的 <code>css</code> 类名，然后看情况加 <code>highLight</code><figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">el-table</span> <span class="attr">class</span>=<span class="string">&quot;custom_el_table&quot;</span> <span class="attr">header-cell-class-name</span>=<span class="string">&quot;header_cell&quot;</span> <span class="attr">highlight-current-row</span> <span class="attr">:data</span>=<span class="string">&quot;tableData&quot;</span> <span class="attr">style</span>=<span class="string">&quot;width: 100%&quot;</span> <span class="attr">height</span>=<span class="string">&quot;100%&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">el-table</span>&gt;</span></span><br></pre></td></tr></table></figure></li>
<li>其次就是封装的 <code>scss</code> 或 <code>less</code> 文件内容了，例如把这个文件命名为 <code>myElTable.scss</code><br><br>👉注意 <code>.current-row</code> 的 <code>background-image</code> 是高亮行的背景图，如果较为简单可以用 <code>css</code> 处理<figure class="highlight css"><table><tr><td class="code"><pre><span class="line">:<span class="built_in">deep</span>(.current-row)&#123;</span><br><span class="line">    <span class="attribute">background-image</span>: <span class="built_in">url</span>(<span class="string">&quot;/src/assets/images/table_row_active.png&quot;</span>);</span><br><span class="line">    <span class="attribute">background-size</span>: <span class="number">100%</span> <span class="number">100%</span>;</span><br><span class="line">&#125;</span><br><span class="line">:<span class="built_in">deep</span>(.custom_el_table)&#123;</span><br><span class="line">    <span class="attribute">background</span>: transparent;</span><br><span class="line">    <span class="attr">--el-table-border</span>: none;</span><br><span class="line">    <span class="attr">--el-table-row-hover-bg-color</span>: <span class="built_in">rgba</span>(<span class="number">0</span>, <span class="number">158</span>, <span class="number">250</span>, .<span class="number">1</span>) <span class="meta">!important</span>;</span><br><span class="line">    <span class="attr">--el-table-current-row-bg-color</span>: <span class="built_in">rgba</span>(<span class="number">0</span>, <span class="number">158</span>, <span class="number">250</span>, <span class="number">0</span>) <span class="meta">!important</span>;</span><br><span class="line">    <span class="attr">--el-table-text-color</span>: white;</span><br><span class="line">    <span class="attr">--el-table-header-bg-color</span>: <span class="number">#041954</span>;</span><br><span class="line">    <span class="attr">--el-table-bg-color</span>: transparent;</span><br><span class="line">    <span class="attr">--el-table-tr-bg-color</span>: transparent;</span><br><span class="line">    <span class="attr">--el-table-header-text-color</span>: white;</span><br><span class="line">&#125;</span><br><span class="line">:<span class="built_in">deep</span>(.header_cell)&#123;</span><br><span class="line">    <span class="attribute">font-size</span>: <span class="number">20px</span>;</span><br><span class="line">    <span class="attribute">font-weight</span>: <span class="number">500</span>;</span><br><span class="line">&#125;</span><br><span class="line">:<span class="built_in">deep</span>(.el-table__inner-wrapper:before)&#123;</span><br><span class="line">    <span class="attribute">height</span>: <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li>最后在 <code>vue</code> 文件中的 <code>style</code> 里引入即可<figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="keyword">@import</span> <span class="string">&#x27;/src/assets/css/myElTable.scss&#x27;</span>;</span><br></pre></td></tr></table></figure></li>
<li>完事</li>
</ul>
]]></content>
      <categories>
        <category>前端</category>
      </categories>
      <tags>
        <tag>Vue</tag>
        <tag>ElementUI</tag>
      </tags>
  </entry>
  <entry>
    <title>flvjs视频流播放组件封装(&amp;断线重连)</title>
    <url>/2023/03/06/Flvjs%E8%A7%86%E9%A2%91%E6%B5%81%E6%92%AD%E6%94%BE%E7%BB%84%E4%BB%B6%E5%B0%81%E8%A3%85-%E6%96%AD%E7%BA%BF%E9%87%8D%E8%BF%9E/</url>
    <content><![CDATA[<h5 id="最近项目中遇到了视频流播放的相关业务处理，因为同时有断线重连的需求，所以为了减少业务页面的代码量，对组件进行封装使用"><a href="#最近项目中遇到了视频流播放的相关业务处理，因为同时有断线重连的需求，所以为了减少业务页面的代码量，对组件进行封装使用" class="headerlink" title="最近项目中遇到了视频流播放的相关业务处理，因为同时有断线重连的需求，所以为了减少业务页面的代码量，对组件进行封装使用"></a>最近项目中遇到了视频流播放的相关业务处理，因为同时有断线重连的需求，所以为了减少业务页面的代码量，对组件进行封装使用</h5><hr>
<p><strong>项目基于 Vue 框架进行开发</strong></p>
<ul>
<li>上代码<span id="more"></span>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;cameraVideo&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">video</span> <span class="attr">class</span>=<span class="string">&quot;videoControl&quot;</span> <span class="attr">muted</span> <span class="attr">ref</span>=<span class="string">&quot;myCameraVideoPlayer&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">video</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br></pre></td></tr></table></figure></li>
</ul>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">&lt;script&gt;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  <span class="attr">name</span>: <span class="string">&quot;cameraVideo&quot;</span>,</span><br><span class="line">  <span class="attr">props</span>: [<span class="string">&quot;videoData&quot;</span>,<span class="string">&#x27;autoPlay&#x27;</span>],</span><br><span class="line">  <span class="attr">watch</span>: &#123;&#125;,</span><br><span class="line">  <span class="attr">methods</span>: &#123;</span><br><span class="line">    <span class="title function_">loadVideo</span>(<span class="params"></span>) &#123;</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;data alive&quot;</span>, <span class="variable language_">this</span>.<span class="property">videoData</span>);</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">player</span> &amp;&amp; <span class="variable language_">this</span>.<span class="title function_">destroy</span>();</span><br><span class="line">			<span class="comment">// props 中的 videoData 为视频流url</span></span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">player</span> = flvjs.<span class="title function_">createPlayer</span>(&#123;</span><br><span class="line">        <span class="attr">type</span>: <span class="string">&quot;flv&quot;</span>,</span><br><span class="line">        <span class="attr">isLive</span>: <span class="literal">true</span>,</span><br><span class="line">        <span class="attr">url</span>: <span class="variable language_">this</span>.<span class="property">videoData</span>,</span><br><span class="line">        <span class="attr">hasAudio</span>: <span class="literal">false</span>,</span><br><span class="line">        <span class="attr">hasVideo</span>: <span class="literal">true</span>,</span><br><span class="line">        <span class="attr">cors</span>: <span class="literal">true</span>, <span class="comment">// 是否跨域</span></span><br><span class="line">      &#125;);</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">player</span>.<span class="title function_">attachMediaElement</span>(<span class="variable language_">this</span>.<span class="property">$refs</span>.<span class="property">myCameraVideoPlayer</span>);</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">player</span>.<span class="title function_">load</span>();</span><br><span class="line">      <span class="variable language_">this</span>.<span class="title function_">bindEvents</span>();</span><br><span class="line">      <span class="variable language_">this</span>.<span class="title function_">startVideo</span>();</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="title function_">bindEvents</span>(<span class="params"></span>) &#123;</span><br><span class="line">      <span class="comment">//视频出错后销毁重新创建</span></span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(flvjs);</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">player</span>.<span class="title function_">on</span>(flvjs.<span class="property">Events</span>.<span class="property">ERROR</span>, <span class="variable language_">this</span>.<span class="property">handleErr</span>);</span><br><span class="line">      <span class="comment">// this.player.on(&quot;loading_complete&quot;, this.handleErr);</span></span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">player</span>.<span class="title function_">on</span>(flvjs.<span class="property">Events</span>.<span class="property">LOADING_COMPLETE</span>, <span class="variable language_">this</span>.<span class="property">handleErr</span>);</span><br><span class="line">      <span class="comment">// this.player.on(flvjs.Events.RECOVERED_EARLY_EOF, this.handleErr);</span></span><br><span class="line">      <span class="comment">// this.player.on(&quot;media_info&quot;, this.destroy);</span></span><br><span class="line">      <span class="comment">// this.player.on(&quot;metadata_arrived&quot;, this.destroy);</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="title function_">handleErr</span>(<span class="params"></span>) &#123;</span><br><span class="line">      <span class="comment">// console.log(&quot;errorType:&quot;, errorType);</span></span><br><span class="line">      <span class="comment">// console.log(&quot;errorDetail:&quot;, errorDetail);</span></span><br><span class="line">      <span class="comment">// console.log(&quot;errorInfo:&quot;, errorInfo);</span></span><br><span class="line">      <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">player</span>) &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">player</span>.<span class="title function_">pause</span>();</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">player</span>.<span class="title function_">unload</span>();</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">player</span>.<span class="title function_">detachMediaElement</span>();</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">player</span>.<span class="title function_">destroy</span>();</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">player</span> = <span class="literal">null</span>;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="title function_">loadVideo</span>();</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="title function_">startVideo</span>(<span class="params"></span>) &#123;</span><br><span class="line">      <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">player</span>) &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">player</span>.<span class="title function_">play</span>();</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="title function_">pause</span>(<span class="params"></span>) &#123;</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">player</span> &amp;&amp; <span class="variable language_">this</span>.<span class="property">player</span>.<span class="title function_">pause</span>();</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="title function_">destroy</span>(<span class="params"></span>) &#123;</span><br><span class="line">      <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">player</span>) &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">player</span>.<span class="title function_">pause</span>();</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">player</span>.<span class="title function_">unload</span>();</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">player</span>.<span class="title function_">detachMediaElement</span>();</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">player</span>.<span class="title function_">destroy</span>();</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">player</span> = <span class="literal">null</span>;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="title function_">data</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">      <span class="attr">supported</span>: <span class="literal">false</span>,</span><br><span class="line">      <span class="attr">player</span>: <span class="literal">null</span>,</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="title function_">mounted</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="comment">// console.log(this.videoData, 2);\</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">player</span> = <span class="literal">null</span>;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">supported</span> = flvjs.<span class="title function_">isSupported</span>();</span><br><span class="line">		<span class="comment">// 因为业务需求，封装时autoPlay 的含义为：true 引用组件了即刻加载视频； false 则可以后续refs使用子组件方法load加载播放视频</span></span><br><span class="line">    <span class="keyword">if</span>(<span class="variable language_">this</span>.<span class="property">autoPlay</span>)&#123;</span><br><span class="line">      <span class="variable language_">this</span>.<span class="title function_">loadVideo</span>();</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="title function_">beforeDestroy</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;beforeDestroy&quot;</span>);</span><br><span class="line">    <span class="variable language_">this</span>.<span class="title function_">destroy</span>();</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;;</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>

<figure class="highlight css"><table><tr><td class="code"><pre><span class="line">&lt;style lang=&quot;less&quot; scoped&gt;</span><br><span class="line"><span class="selector-class">.cameraVideo</span>&#123;</span><br><span class="line">  <span class="attribute">position</span>: relative;</span><br><span class="line">  <span class="selector-class">.videoControl</span>&#123;</span><br><span class="line">    <span class="attribute">position</span>: absolute;</span><br><span class="line">    <span class="attribute">height</span>: <span class="number">100%</span>;</span><br><span class="line">    <span class="attribute">width</span>: <span class="number">100%</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">&lt;/style&gt;</span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>前端</category>
      </categories>
      <tags>
        <tag>Vue</tag>
        <tag>视频播放</tag>
        <tag>Flvjs</tag>
      </tags>
  </entry>
  <entry>
    <title>Gis二次开发相关文件处理</title>
    <url>/2022/04/18/Gis%E4%BA%8C%E6%AC%A1%E5%BC%80%E5%8F%91%E7%9B%B8%E5%85%B3%E6%96%87%E4%BB%B6%E5%A4%84%E7%90%86/</url>
    <content><![CDATA[<p><font color=red>注意：首先需要进行geoserver环境搭建（需要在 tomcat 中 geoserver 包里的 web.xml 文件中进行跨域处理）及相关依赖引入</font></p>
<h5 id="shp-文件处理（解析文件并展示）"><a href="#shp-文件处理（解析文件并展示）" class="headerlink" title=".shp 文件处理（解析文件并展示）"></a>.shp 文件处理（解析文件并展示）</h5><h6 id="后端接收前端发送的-file-文件流，通过-GeoServer-发布，并返回一个-geojson-格式数据的-url"><a href="#后端接收前端发送的-file-文件流，通过-GeoServer-发布，并返回一个-geojson-格式数据的-url" class="headerlink" title="后端接收前端发送的 file 文件流，通过 GeoServer 发布，并返回一个 geojson 格式数据的 url"></a>后端接收前端发送的 file 文件流，通过 GeoServer 发布，并返回一个 geojson 格式数据的 url</h6><p><strong>主要代码：</strong></p>
<span id="more"></span>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@PostMapping(&quot;/publishShpFile&quot;)</span></span><br><span class="line"><span class="keyword">public</span> Result <span class="title function_">publishShpFile</span><span class="params">(<span class="meta">@RequestParam(&quot;file&quot;)</span> MultipartFile shpFile)</span> &#123;</span><br><span class="line">    <span class="type">Result</span> <span class="variable">result</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Result</span>();</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="comment">//获取geoServer连接对象</span></span><br><span class="line">        <span class="type">GeoServerRESTManager</span> <span class="variable">geoServerConnection</span> <span class="operator">=</span> GeoServerPublishUtil.getGeoServerConnection(geoServerUser, geoServerPassword, geoServerUrl);</span><br><span class="line">        <span class="keyword">if</span> (ObjectUtil.isNotEmpty(geoServerConnection)) &#123;</span><br><span class="line">            <span class="type">String</span> <span class="variable">originalFilename</span> <span class="operator">=</span> shpFile.getOriginalFilename();</span><br><span class="line">            <span class="type">File</span> <span class="variable">dest</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">File</span>(shpPath + <span class="string">&quot;/&quot;</span> + originalFilename);</span><br><span class="line">            <span class="comment">// 检测是否存在目录</span></span><br><span class="line">            <span class="keyword">if</span> (!dest.getParentFile().exists()) &#123;</span><br><span class="line">                dest.getParentFile().mkdirs();</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> (dest.exists()) &#123;</span><br><span class="line">                dest.delete();</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">// 保存shp文件到本地</span></span><br><span class="line">            shpFile.transferTo(dest);</span><br><span class="line">            <span class="comment">// 发布shp文件</span></span><br><span class="line">            <span class="type">boolean</span> <span class="variable">publishResult</span> <span class="operator">=</span> GeoServerPublishUtil.publishShp(geoServerConnection, dest.getAbsolutePath(), geoServerWorkspace);</span><br><span class="line">            result.setCode(publishResult ? <span class="number">200</span> : <span class="number">500</span>);</span><br><span class="line">            result.setMessage(publishResult ? <span class="string">&quot;上传成功&quot;</span> : <span class="string">&quot;上传失败&quot;</span>);</span><br><span class="line">            <span class="comment">// 准备url</span></span><br><span class="line">            <span class="type">String</span> <span class="variable">shpUrl</span> <span class="operator">=</span> geoServerUrl + <span class="string">&quot;/&quot;</span> + geoServerWorkspace + <span class="string">&quot;/ows?service=WFS&amp;version=1.0.0&amp;request=GetFeature&amp;typeName=&quot;</span> + geoServerWorkspace + <span class="string">&quot;:&quot;</span> + originalFilename.split(<span class="string">&quot;\\.&quot;</span>)[<span class="number">0</span>] + <span class="string">&quot;&amp;maxFeatures=50&amp;outputFormat=application%2Fjson&quot;</span>;</span><br><span class="line">            result.setData(publishResult ? shpUrl : <span class="string">&quot;&quot;</span>);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            result.setCode(<span class="number">500</span>);</span><br><span class="line">            result.setMessage(<span class="string">&quot;上传失败,请检查geoServer账号密码&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">        log.error(<span class="string">&quot;Exceptions:&quot;</span>, e);</span><br><span class="line">        result.setCode(<span class="number">500</span>);</span><br><span class="line">        result.setMessage(<span class="string">&quot;上传失败,服务器内部异常&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>返回封装类：</strong></p>
<p><font color=Blue>Result.java</font></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">import</span> lombok.Data;</span><br><span class="line"><span class="keyword">import</span> java.io.Serializable;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Result</span> <span class="keyword">implements</span> <span class="title class_">Serializable</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">long</span> <span class="variable">serialVersionUID</span> <span class="operator">=</span> <span class="number">1L</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 返回处理消息</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="type">String</span> <span class="variable">message</span> <span class="operator">=</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 返回代码</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="type">Integer</span> <span class="variable">code</span> <span class="operator">=</span> HttpStatus.SUCCESS;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 返回数据对象 data</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> Object data;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Result</span><span class="params">()</span> &#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 初始化一个新创建的 Result 对象</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> code 状态码</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> msg 返回内容</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Result</span><span class="params">(<span class="type">int</span> code, String msg)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">this</span>(code,msg,<span class="literal">null</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 初始化一个新创建的 Result 对象</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> code 状态码</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> msg 返回内容</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> data 数据对象</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Result</span><span class="params">(<span class="type">int</span> code, String msg, Object data)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">this</span>.code = code;</span><br><span class="line">        <span class="built_in">this</span>.message = msg;</span><br><span class="line">        <span class="built_in">this</span>.data = data;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 返回成功消息</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 成功消息</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> Result <span class="title function_">success</span><span class="params">()</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span> Result.success(<span class="string">&quot;成功&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 返回成功数据</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 成功消息</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> Result <span class="title function_">success</span><span class="params">(Object data)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span> Result.success(<span class="string">&quot;成功&quot;</span>, data);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 返回成功消息</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> msg 返回内容</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 成功消息</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> Result <span class="title function_">success</span><span class="params">(String msg)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span> Result.success(msg, <span class="literal">null</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 返回成功消息</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> msg 返回内容</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> data 数据对象</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 成功消息</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> Result <span class="title function_">success</span><span class="params">(String msg, Object data)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Result</span>(HttpStatus.SUCCESS, msg, data);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 返回错误消息</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> Result <span class="title function_">error</span><span class="params">()</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span> Result.error(<span class="string">&quot;失败&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 返回错误消息</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 警告消息</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> Result <span class="title function_">error</span><span class="params">(Object data)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span> Result.error(<span class="string">&quot;失败&quot;</span>, data);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> Result <span class="title function_">error</span><span class="params">(String msg)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span> Result.error(msg, <span class="literal">null</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 返回错误消息</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> msg 返回内容</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> data 数据对象</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 警告消息</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> Result <span class="title function_">error</span><span class="params">(String msg, Object data)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Result</span>(HttpStatus.ERROR, msg, data);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 返回错误消息</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> code 状态码</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> msg 返回内容</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 警告消息</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> Result <span class="title function_">error</span><span class="params">(<span class="type">int</span> code, String msg)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Result</span>(code, msg, <span class="literal">null</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><strong>shp解析工具类：</strong></p>
<p><font color=Blue>GeoServerPublishUtil.java</font></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> cn.hutool.core.util.ObjectUtil;</span><br><span class="line"><span class="keyword">import</span> it.geosolutions.geoserver.rest.GeoServerRESTManager;</span><br><span class="line"><span class="keyword">import</span> it.geosolutions.geoserver.rest.GeoServerRESTPublisher;</span><br><span class="line"><span class="keyword">import</span> it.geosolutions.geoserver.rest.GeoServerRESTReader;</span><br><span class="line"><span class="keyword">import</span> it.geosolutions.geoserver.rest.decoder.RESTDataStore;</span><br><span class="line"><span class="keyword">import</span> it.geosolutions.geoserver.rest.encoder.GSLayerEncoder;</span><br><span class="line"><span class="keyword">import</span> it.geosolutions.geoserver.rest.encoder.datastore.GSGeoTIFFDatastoreEncoder;</span><br><span class="line"><span class="keyword">import</span> it.geosolutions.geoserver.rest.encoder.datastore.GSShapefileDatastoreEncoder;</span><br><span class="line"><span class="keyword">import</span> it.geosolutions.geoserver.rest.encoder.feature.GSFeatureTypeEncoder;</span><br><span class="line"><span class="keyword">import</span> lombok.extern.slf4j.Slf4j;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.File;</span><br><span class="line"><span class="keyword">import</span> java.net.MalformedURLException;</span><br><span class="line"><span class="keyword">import</span> java.net.URL;</span><br><span class="line"><span class="keyword">import</span> java.nio.charset.Charset;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Classname</span> GeoServerPublishUtil</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">GeoServerPublishUtil</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 获取geoserver连接对象</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> username</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> password</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> geoserverUrl</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> GeoServerRESTManager <span class="title function_">getGeoServerConnection</span><span class="params">(String username, String password, String geoserverUrl)</span> &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="type">GeoServerRESTManager</span> <span class="variable">geoServerRESTManager</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">GeoServerRESTManager</span>(<span class="keyword">new</span> <span class="title class_">URL</span>(geoserverUrl), username, password);</span><br><span class="line">            <span class="keyword">return</span> geoServerRESTManager;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (MalformedURLException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 发布tiff</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> tiffPath</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="type">boolean</span> <span class="title function_">publishTiff</span><span class="params">(GeoServerRESTManager geoServerRESTManager, String tiffPath, String workSpace)</span> &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="type">File</span> <span class="variable">tifFile</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">File</span>(tiffPath);</span><br><span class="line">            <span class="keyword">assert</span> geoServerRESTManager != <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line">            <span class="comment">//判断工作空间是否存在，不存在则创建</span></span><br><span class="line">            <span class="type">String</span> <span class="variable">storeName</span> <span class="operator">=</span> tifFile.getName().split(<span class="string">&quot;\\.&quot;</span>)[<span class="number">0</span>];</span><br><span class="line"></span><br><span class="line">            <span class="comment">//获取发布对象</span></span><br><span class="line">            <span class="type">GeoServerRESTPublisher</span> <span class="variable">publisher</span> <span class="operator">=</span> geoServerRESTManager.getPublisher();</span><br><span class="line">            <span class="comment">//创建工作空间</span></span><br><span class="line">            List&lt;String&gt; workspaces = geoServerRESTManager.getReader().getWorkspaceNames();</span><br><span class="line">            <span class="keyword">if</span> (!workspaces.contains(workSpace)) &#123;</span><br><span class="line">                publisher.createWorkspace(workSpace);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="comment">//获取当前要发布的数据</span></span><br><span class="line">            <span class="type">RESTDataStore</span> <span class="variable">dataStore</span> <span class="operator">=</span> geoServerRESTManager.getReader().getDatastore(workSpace, storeName);</span><br><span class="line">            <span class="keyword">if</span> (ObjectUtil.isEmpty(dataStore)) &#123;</span><br><span class="line">                <span class="type">GSGeoTIFFDatastoreEncoder</span> <span class="variable">gsGeoTIFFDataStoreEncoders</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">GSGeoTIFFDatastoreEncoder</span>(storeName);</span><br><span class="line">                gsGeoTIFFDataStoreEncoders.setWorkspaceName(workSpace);</span><br><span class="line">                gsGeoTIFFDataStoreEncoders.setUrl(<span class="keyword">new</span> <span class="title class_">URL</span>(<span class="string">&quot;file:&quot;</span> + tifFile.getName()));</span><br><span class="line">                <span class="comment">//创建图层</span></span><br><span class="line">                geoServerRESTManager.getStoreManager().create(workSpace, gsGeoTIFFDataStoreEncoders);</span><br><span class="line">                <span class="comment">//发布图层</span></span><br><span class="line">                <span class="keyword">return</span> geoServerRESTManager.getPublisher().publishGeoTIFF(workSpace, storeName, tifFile);</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 发布shp文件</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> geoServerRESTManager</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> shpPath</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> workSpace</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="type">boolean</span> <span class="title function_">publishShp</span><span class="params">(GeoServerRESTManager geoServerRESTManager, String shpPath, String workSpace)</span> &#123;</span><br><span class="line">        <span class="keyword">assert</span> geoServerRESTManager != <span class="literal">null</span>;</span><br><span class="line">        <span class="type">File</span> <span class="variable">shpFile</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">File</span>(shpPath);</span><br><span class="line">        <span class="type">GeoServerRESTReader</span> <span class="variable">restReader</span> <span class="operator">=</span> geoServerRESTManager.getReader();</span><br><span class="line">        <span class="type">GeoServerRESTPublisher</span> <span class="variable">restPublisher</span> <span class="operator">=</span> geoServerRESTManager.getPublisher();</span><br><span class="line">        <span class="comment">// 存在相应的工作区</span></span><br><span class="line">        <span class="keyword">if</span> (!restReader.existsWorkspace(workSpace)) &#123;</span><br><span class="line">            restPublisher.createWorkspace(workSpace);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//shp数据存储,如果存在 先删除</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">dataSetName</span> <span class="operator">=</span> shpFile.getName().split(<span class="string">&quot;\\.&quot;</span>)[<span class="number">0</span>];</span><br><span class="line">        <span class="keyword">if</span> (restReader.existsDatastore(workSpace, dataSetName)) &#123;</span><br><span class="line">            restPublisher.removeDatastore(workSpace, dataSetName, <span class="literal">true</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//创建shape文件存储</span></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">//shp文件所在的位置</span></span><br><span class="line">            <span class="type">String</span> <span class="variable">urlDataStorePath</span> <span class="operator">=</span> shpFile.getPath();</span><br><span class="line">            <span class="comment">// 数据存储需要的文件</span></span><br><span class="line">            <span class="type">String</span> <span class="variable">shpFilePath</span> <span class="operator">=</span> String.format(<span class="string">&quot;file://%s&quot;</span>, urlDataStorePath);</span><br><span class="line">            <span class="type">URL</span> <span class="variable">urlShapeFile</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">URL</span>(shpFilePath);</span><br><span class="line">            <span class="comment">// 创建数据集</span></span><br><span class="line">            <span class="type">GSShapefileDatastoreEncoder</span> <span class="variable">dataStoreEncoder</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">GSShapefileDatastoreEncoder</span>(dataSetName, urlShapeFile);</span><br><span class="line">            dataStoreEncoder.setCharset(Charset.forName(<span class="string">&quot;GBK&quot;</span>));</span><br><span class="line">            geoServerRESTManager.getStoreManager().create(workSpace, dataStoreEncoder);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (MalformedURLException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//shp图层layer</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">layerName</span> <span class="operator">=</span> shpFile.getName().split(<span class="string">&quot;\\.&quot;</span>)[<span class="number">0</span>];</span><br><span class="line">        <span class="keyword">if</span> (restReader.existsLayer(workSpace, layerName)) &#123;</span><br><span class="line">            restPublisher.removeLayer(workSpace, layerName);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//发布图层</span></span><br><span class="line">        <span class="type">GSFeatureTypeEncoder</span> <span class="variable">gsFeatureTypeEncoder</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">GSFeatureTypeEncoder</span>();</span><br><span class="line">        gsFeatureTypeEncoder.setName(layerName);</span><br><span class="line">        gsFeatureTypeEncoder.setTitle(layerName);</span><br><span class="line">        gsFeatureTypeEncoder.setSRS(GeoServerRESTPublisher.DEFAULT_CRS);</span><br><span class="line">        <span class="type">GSLayerEncoder</span> <span class="variable">gsLayerEncoder</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">GSLayerEncoder</span>();</span><br><span class="line">        <span class="keyword">return</span> restPublisher.publishDBLayer(workSpace, dataSetName, gsFeatureTypeEncoder, gsLayerEncoder);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h6 id="此时后端返回-res-data-即为-geojson-格式的-url"><a href="#此时后端返回-res-data-即为-geojson-格式的-url" class="headerlink" title="此时后端返回 res.data 即为 geojson 格式的 url"></a>此时后端返回 res.data 即为 geojson 格式的 url</h6><p><code>geoServerUrl + &quot;/&quot; + geoServerWorkspace + &quot;/ows?service=WFS&amp;version=1.0.0&amp;request=GetFeature&amp;typeName=&quot; + geoServerWorkspace + &quot;:&quot; + originalFilename.split(&quot;\\.&quot;)[0] + &quot;&amp;maxFeatures=50&amp;outputFormat=application%2Fjson&quot;</code><br>👇<br><code>http://localhost:18888/geoserver/geoserver_space/ows?service=WFS&amp;version=1.0.0&amp;request=GetFeature&amp;typeName=geoserver_space:1639645666000&amp;maxFeatures=50&amp;outputFormat=application%2Fjson</code></p>
<h6 id="前端使用此-url"><a href="#前端使用此-url" class="headerlink" title="前端使用此 url"></a>前端使用此 url</h6><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="variable language_">this</span>.<span class="property">map</span>.<span class="title function_">addLayer</span>(&#123; <span class="comment">// this.map 为地图实例</span></span><br><span class="line">  <span class="attr">id</span>: <span class="string">&quot;shp&quot;</span>,</span><br><span class="line">  <span class="attr">type</span>: <span class="string">&quot;fill&quot;</span>,</span><br><span class="line">  <span class="attr">source</span>: &#123;</span><br><span class="line">    <span class="attr">type</span>: <span class="string">&quot;geojson&quot;</span>,</span><br><span class="line">    <span class="attr">data</span>: response.<span class="property">data</span>, <span class="comment">// response.data 为返回url</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">paint</span>: &#123;</span><br><span class="line">    <span class="string">&quot;fill-color&quot;</span>: <span class="string">&quot;rgba(247, 79, 69, 0.5)&quot;</span>, <span class="comment">// 填充颜色</span></span><br><span class="line">  &#125;,</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h5 id="tif-文件处理（解析文件并展示）"><a href="#tif-文件处理（解析文件并展示）" class="headerlink" title=".tif 文件处理（解析文件并展示）"></a>.tif 文件处理（解析文件并展示）</h5><h6 id="同理-后端接收前端发送的-file-文件流，通过-GeoServer-发布，并返回一个-WMS-瓦片格式数据的-url"><a href="#同理-后端接收前端发送的-file-文件流，通过-GeoServer-发布，并返回一个-WMS-瓦片格式数据的-url" class="headerlink" title="同理 后端接收前端发送的 file 文件流，通过 GeoServer 发布，并返回一个 WMS 瓦片格式数据的 url"></a>同理 后端接收前端发送的 file 文件流，通过 GeoServer 发布，并返回一个 WMS 瓦片格式数据的 url</h6><p><strong>主要代码：</strong></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="type">String</span> <span class="variable">tiffPath</span> <span class="operator">=</span> decryptFilePath + partFile.getName(); <span class="comment">// partFile 为 tif 文件</span></span><br><span class="line"><span class="comment">//解析tif图片获取经纬度</span></span><br><span class="line">log.info(<span class="string">&quot;解析tiff获取经纬度开始&quot;</span>);</span><br><span class="line"><span class="type">JSONArray</span> <span class="variable">coordinateArray</span> <span class="operator">=</span> TiffUtil.getCoordinateByTiff(tiffPath);</span><br><span class="line"><span class="type">String</span> <span class="variable">bubbleLocation</span> <span class="operator">=</span> coordinateArray.toString();</span><br><span class="line">log.info(<span class="string">&quot;解析tiff获取经纬度结束&quot;</span>);</span><br><span class="line"><span class="comment">//发布tiff文件</span></span><br><span class="line">log.info(<span class="string">&quot;tiff开始发布&quot;</span>);</span><br><span class="line"><span class="type">GeoServerRESTManager</span> <span class="variable">geoServerConnection</span> <span class="operator">=</span> GeoServerPublishUtil.getGeoServerConnection(geoServerUser, geoServerPassword, geoServerUrl);</span><br><span class="line"><span class="type">boolean</span> <span class="variable">publishResult</span> <span class="operator">=</span> GeoServerPublishUtil.publishTiff(geoServerConnection, tiffPath, geoServerWorkspace);</span><br><span class="line"><span class="keyword">if</span> (!publishResult) &#123;</span><br><span class="line">    <span class="keyword">return</span> Result.error(<span class="string">&quot;请上传正确的tif文件！&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//boolean publishResult = GeoServerLayerPublish.publishTiff(geoServerConnection,tiffPath,geoServerWorkspace);</span></span><br><span class="line">log.info(<span class="string">&quot;tiff发布完成&quot;</span>);</span><br><span class="line"><span class="comment">// 此时拿到url 主要代码片结束</span></span><br><span class="line"><span class="type">String</span> <span class="variable">tiffPublishUrl</span> <span class="operator">=</span> geoServerUrl + <span class="string">&quot;/&quot;</span> + geoServerWorkspace + <span class="string">&quot;/wms?service=WMS&amp;version=1.1.0&amp;request=GetMap&amp;layers=&quot;</span> + geoServerWorkspace + <span class="string">&quot;:&quot;</span> + partFile.getName().split(<span class="string">&quot;\\.&quot;</span>)[<span class="number">0</span>] + <span class="string">&quot;&amp;styles=&amp;bbox=&#123;bbox-epsg-3857&#125;&amp;width=768&amp;height=552&amp;srs=EPSG:3857&amp;format=image%2Fpng&amp;transparent=true&quot;</span>;</span><br><span class="line"><span class="comment">// //通过经纬度查询数据库中是否有相同位置上传</span></span><br><span class="line"><span class="comment">// QueryWrapper&lt;FileTiffUploadVO&gt; wrapper = new QueryWrapper&lt;&gt;();</span></span><br><span class="line"><span class="comment">// wrapper.lambda().eq(FileTiffUploadVO::getBubbleLocation, bubbleLocation);</span></span><br><span class="line"><span class="comment">// List&lt;FileTiffUploadVO&gt; fileTiffUploadVOS = fileTiffUploadMapper.selectList(wrapper);</span></span><br><span class="line"><span class="comment">// //如果存在，复用ID信息</span></span><br><span class="line"><span class="comment">// if (ObjectUtil.isNotEmpty(fileTiffUploadVOS) &amp;&amp; fileTiffUploadVOS.size() &gt; 0) &#123;</span></span><br><span class="line"><span class="comment">//     FileTiffUploadVO fileTiffUploadVO = fileTiffUploadVOS.get(0);</span></span><br><span class="line"><span class="comment">//     fileTiffUploadVO.setFileName(partFile.getName());</span></span><br><span class="line"><span class="comment">//     fileTiffUploadVO.setFileTiffPath(tiffPath);</span></span><br><span class="line"><span class="comment">//     fileTiffUploadVO.setFilePngPath(pngFilePath);</span></span><br><span class="line"><span class="comment">//     fileTiffUploadVO.setTiffPublishUrl(publishResult ? tiffPublishUrl : &quot;&quot;);</span></span><br><span class="line"><span class="comment">//     fileTiffUploadVO.setTiffPublishStatus(publishResult ? 1 : 2);</span></span><br><span class="line"><span class="comment">//     fileTiffUploadVO.setUploadTime(DateUtil.format(new Date(), &quot;yyyy-MM-dd HH:mm:ss&quot;));</span></span><br><span class="line"><span class="comment">//     fileTiffUploadService.insert(fileTiffUploadVO);</span></span><br><span class="line"><span class="comment">// &#125; else &#123;</span></span><br><span class="line"><span class="comment">//     //如果不存在则新建存储上传信息</span></span><br><span class="line"><span class="comment">//     FileTiffUploadVO fileTiffUploadVO = new FileTiffUploadVO();</span></span><br><span class="line"><span class="comment">//     fileTiffUploadVO.setFileId(UUID.randomUUID().toString().replaceAll(&quot;-&quot;, &quot;&quot;));</span></span><br><span class="line"><span class="comment">//     fileTiffUploadVO.setFileName(partFile.getName());</span></span><br><span class="line"><span class="comment">//     fileTiffUploadVO.setFileTiffPath(tiffPath);</span></span><br><span class="line"><span class="comment">//     fileTiffUploadVO.setFilePngPath(pngFilePath);</span></span><br><span class="line"><span class="comment">//     fileTiffUploadVO.setBubbleLocation(bubbleLocation);</span></span><br><span class="line"><span class="comment">//     fileTiffUploadVO.setTiffPublishUrl(publishResult ? tiffPublishUrl : &quot;&quot;);</span></span><br><span class="line"><span class="comment">//     fileTiffUploadVO.setTiffPublishStatus(publishResult ? 1 : 2);</span></span><br><span class="line"><span class="comment">//     fileTiffUploadVO.setUploadTime(DateUtil.format(new Date(), &quot;yyyy-MM-dd HH:mm:ss&quot;));</span></span><br><span class="line"><span class="comment">//     fileTiffUploadService.insert(fileTiffUploadVO);</span></span><br><span class="line"><span class="comment">// &#125;</span></span><br></pre></td></tr></table></figure>

<p><strong>依赖实体类：</strong></p>
<p><font color=Blue>FileTiffUploadVO.java</font></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.annotation.TableField;</span><br><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.annotation.TableId;</span><br><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.annotation.TableName;</span><br><span class="line"><span class="keyword">import</span> lombok.AllArgsConstructor;</span><br><span class="line"><span class="keyword">import</span> lombok.Data;</span><br><span class="line"><span class="keyword">import</span> lombok.NoArgsConstructor;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Description;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@AllArgsConstructor</span></span><br><span class="line"><span class="meta">@NoArgsConstructor</span></span><br><span class="line"><span class="meta">@TableName(&quot;gis_file_tiff_upload&quot;)</span></span><br><span class="line"><span class="meta">@Description(&quot;tiff文件上传信息&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">FileTiffUploadVO</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String fileId;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 图像对比气泡所在经纬度</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@TableField(&quot;bubble_location&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String bubbleLocation;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 上传tiff文件名称</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@TableField(&quot;file_name&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String fileName;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * tiff图片位置</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@TableField(&quot;file_tiff_path&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String fileTiffPath;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * tiff图片发布后的URL</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@TableField(&quot;tiff_publish_url&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String tiffPublishUrl;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * tiff发布状态</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@TableField(&quot;tiff_publish_status&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> tiffPublishStatus;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 上传时间</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@TableField(&quot;upload_time&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String uploadTime;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><strong>tif解析工具类：</strong></p>
<p><font color=Blue>TiffUtil.java</font></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> com.alibaba.fastjson.JSONArray;</span><br><span class="line"><span class="keyword">import</span> org.gdal.gdal.Dataset;</span><br><span class="line"><span class="keyword">import</span> org.gdal.gdal.gdal;</span><br><span class="line"><span class="keyword">import</span> org.gdal.gdalconst.gdalconstConstants;</span><br><span class="line"><span class="keyword">import</span> <span class="keyword">static</span> java.lang.Math.PI;</span><br><span class="line"><span class="keyword">import</span> <span class="keyword">static</span> java.lang.Math.atan;</span><br><span class="line"><span class="keyword">import</span> <span class="keyword">static</span> java.lang.Math.exp;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Classname</span> TiffUtil</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TiffUtil</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 解析tiff获取坐标</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> tiffPath</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> JSONArray <span class="title function_">getCoordinateByTiff</span><span class="params">(String tiffPath)</span> &#123;</span><br><span class="line">        <span class="comment">//解析tif图片获取经纬度（假设通过解析tif图片获取到了经纬度）</span></span><br><span class="line">        gdal.AllRegister();</span><br><span class="line">        <span class="comment">//读取tif文件</span></span><br><span class="line">        <span class="type">Dataset</span> <span class="variable">dataset</span> <span class="operator">=</span> gdal.Open(tiffPath, gdalconstConstants.GA_ReadOnly);</span><br><span class="line">        <span class="comment">//栅格矩阵的列数</span></span><br><span class="line">        <span class="type">int</span> <span class="variable">rasterXSize</span> <span class="operator">=</span> dataset.getRasterXSize();</span><br><span class="line">        <span class="comment">//栅格矩阵的行数</span></span><br><span class="line">        <span class="type">int</span> <span class="variable">rasterYSize</span> <span class="operator">=</span> dataset.getRasterYSize();</span><br><span class="line">        <span class="comment">//获取仿射矩阵信息</span></span><br><span class="line">        <span class="type">double</span>[] doubles = dataset.GetGeoTransform();</span><br><span class="line">        <span class="comment">//获取投影信息</span></span><br><span class="line">        <span class="type">double</span> <span class="variable">aDouble</span> <span class="operator">=</span> doubles[<span class="number">0</span>];</span><br><span class="line">        <span class="type">double</span> <span class="variable">aDouble1</span> <span class="operator">=</span> doubles[<span class="number">3</span>];</span><br><span class="line">        <span class="type">double</span> <span class="variable">aDouble2</span> <span class="operator">=</span> doubles[<span class="number">1</span>] * rasterXSize + aDouble;</span><br><span class="line">        <span class="type">double</span> <span class="variable">aDouble3</span> <span class="operator">=</span> doubles[<span class="number">5</span>] * rasterYSize + aDouble1;</span><br><span class="line">        <span class="comment">//墨卡托转WGS84:经度</span></span><br><span class="line">        <span class="type">double</span> <span class="variable">topX</span> <span class="operator">=</span> mercator2Lon(aDouble);</span><br><span class="line">        <span class="comment">//墨卡托转WGS84:纬度</span></span><br><span class="line">        <span class="type">double</span> <span class="variable">topY</span> <span class="operator">=</span> mercator2Lat(aDouble1);</span><br><span class="line">        <span class="comment">//墨卡托转WGS84:经度</span></span><br><span class="line">        <span class="type">double</span> <span class="variable">belowX</span> <span class="operator">=</span> mercator2Lon(aDouble2);</span><br><span class="line">        <span class="comment">//墨卡托转WGS84:纬度</span></span><br><span class="line">        <span class="type">double</span> <span class="variable">belowY</span> <span class="operator">=</span> mercator2Lat(aDouble3);</span><br><span class="line">        <span class="comment">//取两个坐标点，数据封装为二维数组</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">coordinatesJSON</span> <span class="operator">=</span> <span class="string">&quot;[[&quot;</span> + topX + <span class="string">&quot;,&quot;</span> + topY + <span class="string">&quot;],&quot;</span> + <span class="string">&quot;[&quot;</span> + belowX + <span class="string">&quot;,&quot;</span> + belowY + <span class="string">&quot;]]&quot;</span>;</span><br><span class="line">        <span class="type">JSONArray</span> <span class="variable">jsonArray</span> <span class="operator">=</span> JSONArray.parseArray(coordinatesJSON);</span><br><span class="line">        <span class="keyword">return</span> jsonArray;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 墨卡托转WGS84:经度</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> longitude</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="type">double</span> <span class="title function_">mercator2Lon</span><span class="params">(<span class="type">double</span> longitude)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> longitude / <span class="number">20037508.34</span> * <span class="number">180</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 墨卡托转WGS84:纬度</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> latitude</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="type">double</span> <span class="title function_">mercator2Lat</span><span class="params">(<span class="type">double</span> latitude)</span> &#123;</span><br><span class="line">        <span class="type">double</span> <span class="variable">latitudeTemp</span> <span class="operator">=</span> latitude / <span class="number">20037508.34</span> * <span class="number">180</span>;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">180</span> / PI * (<span class="number">2</span> * atan(exp(latitudeTemp * PI / <span class="number">180</span>)) - PI / <span class="number">2</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h6 id="此时拿到-url-即可在前端进行处理展示"><a href="#此时拿到-url-即可在前端进行处理展示" class="headerlink" title="此时拿到 url 即可在前端进行处理展示"></a>此时拿到 url 即可在前端进行处理展示</h6><p><code>geoServerUrl + &quot;/&quot; + geoServerWorkspace + &quot;/wms?service=WMS&amp;version=1.1.0&amp;request=GetMap&amp;layers=&quot; + geoServerWorkspace + &quot;:&quot; + partFile.getName().split(&quot;\\.&quot;)[0] + &quot;&amp;styles=&amp;bbox=&#123;bbox-epsg-3857&#125;&amp;width=768&amp;height=552&amp;srs=EPSG:3857&amp;format=image%2Fpng&amp;transparent=true&quot;;</code><br>👇<br><code>http://localhost:18888/geoserver/a_try/wms?service=WMS&amp;version=1.1.0&amp;request=GetMap&amp;layers=a_try:aaaaaaaaaaatcz&amp;bbox=&#123;bbox-epsg-3857&#125;&amp;width=768&amp;height=437&amp;srs=EPSG:3857&amp;format=image%2Fpng&amp;transparent=true</code></p>
<h6 id="前端使用此-tif-url"><a href="#前端使用此-tif-url" class="headerlink" title="前端使用此 tif url"></a>前端使用此 tif url</h6><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="variable language_">this</span>.<span class="property">map</span>.<span class="title function_">addLayer</span>(&#123; <span class="comment">// this.map 为地图实例</span></span><br><span class="line">  <span class="attr">id</span>: <span class="string">&quot;testTif&quot;</span>,</span><br><span class="line">  <span class="attr">type</span>: <span class="string">&quot;raster&quot;</span>, <span class="comment">// type raster 即栅格数据</span></span><br><span class="line">  <span class="attr">source</span>: &#123;</span><br><span class="line">    <span class="attr">type</span>: <span class="string">&quot;raster&quot;</span>,</span><br><span class="line">    <span class="attr">tiles</span>: [e], <span class="comment">// e 为此前拿到的 url</span></span><br><span class="line">    <span class="attr">tileSize</span>: <span class="number">256</span>, <span class="comment">// size 可随意设置 目测影响不大</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">paint</span>: &#123;</span><br><span class="line">    <span class="string">&quot;raster-opacity&quot;</span>: <span class="number">1</span>, <span class="comment">// 透明度</span></span><br><span class="line">  &#125;,</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h5 id="至于-dbf-文件，处理起来相对容易"><a href="#至于-dbf-文件，处理起来相对容易" class="headerlink" title="至于 .dbf 文件，处理起来相对容易"></a>至于 .dbf 文件，处理起来相对容易</h5><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 文件转流</span></span><br><span class="line"><span class="type">InputStream</span> <span class="variable">inputStream</span> <span class="operator">=</span> file.getInputStream();</span><br><span class="line"><span class="comment">// 根据输入流初始化一个DBFReader实例，用来读取DBF文件信息</span></span><br><span class="line"><span class="type">DBFReader</span> <span class="variable">reader</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">DBFReader</span>(inputStream);</span><br><span class="line"><span class="comment">// 解决乱码</span></span><br><span class="line">reader.setCharactersetName(<span class="string">&quot;GBK&quot;</span>);</span><br><span class="line"><span class="comment">// 调用DBFReader对实例方法得到path文件中字段的个数</span></span><br><span class="line"><span class="type">int</span> <span class="variable">fieldsCount</span> <span class="operator">=</span> reader.getFieldCount();</span><br><span class="line">Object[] rowValues;</span><br><span class="line"><span class="comment">// 一条条取出path文件中记录</span></span><br><span class="line"><span class="keyword">while</span> ((rowValues = reader.nextRecord()) != <span class="literal">null</span>) &#123;</span><br><span class="line">    rowValues.toString()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>前端</category>
        <category>后端</category>
      </categories>
      <tags>
        <tag>Gis开发</tag>
      </tags>
  </entry>
  <entry>
    <title>Json串中key值改为指定字符串</title>
    <url>/2022/04/12/Json%E4%B8%B2%E4%B8%ADkey%E5%80%BC%E6%94%B9%E4%B8%BA%E6%8C%87%E5%AE%9A%E5%AD%97%E7%AC%A6%E4%B8%B2/</url>
    <content><![CDATA[<h5 id="JSON串中key值改为指定字符串"><a href="#JSON串中key值改为指定字符串" class="headerlink" title="JSON串中key值改为指定字符串"></a>JSON串中key值改为指定字符串</h5><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">objDemo[newKey] = <span class="number">1</span></span><br></pre></td></tr></table></figure>

<p>等同于👇</p>
<span id="more"></span>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="attr">objDemo</span>:&#123;</span><br><span class="line">  <span class="attr">newKey</span>: <span class="number">1</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>前端</category>
      </categories>
      <tags>
        <tag>Javascript</tag>
      </tags>
  </entry>
  <entry>
    <title>Js简写优化之路</title>
    <url>/2022/04/12/Js%E7%AE%80%E5%86%99%E4%BC%98%E5%8C%96%E4%B9%8B%E8%B7%AF/</url>
    <content><![CDATA[<h5 id="如果同一变量有多个条件"><a href="#如果同一变量有多个条件" class="headerlink" title="如果同一变量有多个条件"></a>如果同一变量有多个条件</h5><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span>(a == <span class="number">1</span> || b == <span class="number">2</span> || c == <span class="number">3</span>)&#123;</span><br><span class="line">  <span class="comment">// do something</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>👇shorter👇</p>
<span id="more"></span>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span>([<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>].<span class="title function_">includes</span>(a))&#123;</span><br><span class="line">  <span class="comment">// do something</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="简单-if-判断使用三元表达式代替"><a href="#简单-if-判断使用三元表达式代替" class="headerlink" title="简单 if 判断使用三元表达式代替"></a>简单 if 判断使用三元表达式代替</h5><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> bool</span><br><span class="line"><span class="keyword">if</span>(a == <span class="number">1</span>)&#123;</span><br><span class="line">  bool = <span class="literal">true</span></span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">  bool = <span class="literal">false</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>👇shorter👇</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> bool = a == <span class="number">1</span> ? <span class="literal">true</span> : <span class="literal">false</span></span><br></pre></td></tr></table></figure>

<h5 id="是否为空检查-简写"><a href="#是否为空检查-简写" class="headerlink" title="是否为空检查 简写"></a>是否为空检查 简写</h5><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> a</span><br><span class="line"><span class="keyword">if</span>(a != <span class="string">&#x27;&#x27;</span> &amp;&amp; a != <span class="literal">null</span> &amp;&amp; a != <span class="literal">undefined</span>)&#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;do some&#x27;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>👇shorter👇</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> a</span><br><span class="line">a &amp;&amp; <span class="title function_">dosome</span>()</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">dosome</span>(<span class="params"></span>)&#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;do some&#x27;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="检查某变量是否有值，若无则设默认值"><a href="#检查某变量是否有值，若无则设默认值" class="headerlink" title="检查某变量是否有值，若无则设默认值"></a>检查某变量是否有值，若无则设默认值</h5><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> a</span><br><span class="line"><span class="keyword">if</span>(a == <span class="literal">null</span> || a == <span class="literal">undefined</span> || a == <span class="string">&#x27;&#x27;</span>)&#123;</span><br><span class="line">  <span class="keyword">var</span> b = <span class="string">&#x27;default&#x27;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>👇shorter👇</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> b = a || <span class="string">&#x27;default&#x27;</span></span><br></pre></td></tr></table></figure>

<h5 id="常用-array-find-使用场景-有一个对象数组并且我们想要根据对象属性查找特定对象时-只返回符合条件的第一个"><a href="#常用-array-find-使用场景-有一个对象数组并且我们想要根据对象属性查找特定对象时-只返回符合条件的第一个" class="headerlink" title="(常用) array.find() 使用场景 有一个对象数组并且我们想要根据对象属性查找特定对象时(只返回符合条件的第一个)"></a>(常用) array.find() 使用场景 有一个对象数组并且我们想要根据对象属性查找特定对象时(只返回符合条件的第一个)</h5><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> data = []</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">findFromArr</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; data.<span class="property">length</span>; ++i) &#123;</span><br><span class="line">    <span class="keyword">if</span> (data[i].<span class="property">type</span> === <span class="string">&quot;test1&quot;</span>) &#123;</span><br><span class="line">      <span class="keyword">return</span> data[i];</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>👇shorter👇</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> data = []</span><br><span class="line">findSingle = data.<span class="title function_">find</span>(</span><br><span class="line">  <span class="function">(<span class="params">data</span>) =&gt;</span> data.<span class="property">type</span> === <span class="string">&quot;test1&quot;</span></span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<p>&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 待续。。。</span></span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>前端</category>
      </categories>
      <tags>
        <tag>Javascript</tag>
        <tag>语法优化</tag>
      </tags>
  </entry>
  <entry>
    <title>Js实现网页时钟（备用）</title>
    <url>/2022/04/18/Js%E5%AE%9E%E7%8E%B0%E7%BD%91%E9%A1%B5%E6%97%B6%E9%92%9F%EF%BC%88%E5%A4%87%E7%94%A8%EF%BC%89/</url>
    <content><![CDATA[<h6 id="js定时器实现一个网页时钟，直接贴代码（Vue框架环境）"><a href="#js定时器实现一个网页时钟，直接贴代码（Vue框架环境）" class="headerlink" title="js定时器实现一个网页时钟，直接贴代码（Vue框架环境）"></a>js定时器实现一个网页时钟，直接贴代码（Vue框架环境）</h6><figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;he-sjzt&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;he-xs&quot;</span>&gt;</span>&#123;&#123; dateTime &#125;&#125;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;he-nyr&quot;</span>&gt;</span>&#123;&#123; yearTime &#125;&#125;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br></pre></td></tr></table></figure>
<span id="more"></span>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">&lt;script&gt;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  <span class="title function_">data</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">      <span class="attr">dateTime</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">      <span class="attr">yearTime</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="title function_">mounted</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="title function_">time</span>();</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">methods</span>: &#123;</span><br><span class="line">    <span class="title function_">time</span>(<span class="params"></span>) &#123;</span><br><span class="line">      <span class="comment">// 获取当前时间</span></span><br><span class="line">      <span class="variable language_">window</span>.<span class="built_in">setInterval</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">const</span> yy = <span class="keyword">new</span> <span class="title class_">Date</span>().<span class="title function_">getFullYear</span>();</span><br><span class="line">        <span class="keyword">const</span> mm =</span><br><span class="line">          <span class="keyword">new</span> <span class="title class_">Date</span>().<span class="title function_">getMonth</span>() + <span class="number">1</span> &lt; <span class="number">10</span></span><br><span class="line">            ? <span class="string">&quot;0&quot;</span> + (<span class="keyword">new</span> <span class="title class_">Date</span>().<span class="title function_">getMonth</span>() + <span class="number">1</span>)</span><br><span class="line">            : <span class="keyword">new</span> <span class="title class_">Date</span>().<span class="title function_">getMonth</span>() + <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">const</span> dd =</span><br><span class="line">          <span class="keyword">new</span> <span class="title class_">Date</span>().<span class="title function_">getDate</span>() &lt; <span class="number">10</span></span><br><span class="line">            ? <span class="string">&quot;0&quot;</span> + <span class="keyword">new</span> <span class="title class_">Date</span>().<span class="title function_">getDate</span>()</span><br><span class="line">            : <span class="keyword">new</span> <span class="title class_">Date</span>().<span class="title function_">getDate</span>();</span><br><span class="line">        <span class="keyword">const</span> hh = <span class="keyword">new</span> <span class="title class_">Date</span>().<span class="title function_">getHours</span>();</span><br><span class="line">        <span class="keyword">const</span> mf =</span><br><span class="line">          <span class="keyword">new</span> <span class="title class_">Date</span>().<span class="title function_">getMinutes</span>() &lt; <span class="number">10</span></span><br><span class="line">            ? <span class="string">&quot;0&quot;</span> + <span class="keyword">new</span> <span class="title class_">Date</span>().<span class="title function_">getMinutes</span>()</span><br><span class="line">            : <span class="keyword">new</span> <span class="title class_">Date</span>().<span class="title function_">getMinutes</span>();</span><br><span class="line">        <span class="keyword">const</span> ss =</span><br><span class="line">          <span class="keyword">new</span> <span class="title class_">Date</span>().<span class="title function_">getSeconds</span>() &lt; <span class="number">10</span></span><br><span class="line">            ? <span class="string">&quot;0&quot;</span> + <span class="keyword">new</span> <span class="title class_">Date</span>().<span class="title function_">getSeconds</span>()</span><br><span class="line">            : <span class="keyword">new</span> <span class="title class_">Date</span>().<span class="title function_">getSeconds</span>();</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">yearTime</span> = yy + <span class="string">&quot;-&quot;</span> + mm + <span class="string">&quot;-&quot;</span> + dd;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">dateTime</span> = hh + <span class="string">&quot;:&quot;</span> + mf + <span class="string">&quot;:&quot;</span> + ss;</span><br><span class="line">      &#125;, <span class="number">1000</span>);</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>

<figure class="highlight css"><table><tr><td class="code"><pre><span class="line">&lt;style scoped&gt;</span><br><span class="line"><span class="selector-class">.he-sjzt</span> &#123;</span><br><span class="line">  <span class="attribute">position</span>: absolute;</span><br><span class="line">  <span class="attribute">top</span>: <span class="number">17px</span>;</span><br><span class="line">  <span class="attribute">display</span>: inline-block;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">100px</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.he-xs</span> &#123;</span><br><span class="line">  <span class="attribute">font-size</span>: <span class="number">22px</span>;</span><br><span class="line">  <span class="attribute">font-weight</span>: <span class="number">400</span>;</span><br><span class="line">  <span class="attribute">text-align</span>: center;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.he-nyr</span> &#123;</span><br><span class="line">  <span class="attribute">font-size</span>: <span class="number">16px</span>;</span><br><span class="line">  <span class="attribute">font-weight</span>: <span class="number">400</span>;</span><br><span class="line">  <span class="attribute">text-align</span>: center;</span><br><span class="line">&#125;</span><br><span class="line">&lt;/style&gt;</span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>前端</category>
      </categories>
      <tags>
        <tag>Vue</tag>
        <tag>Javascript</tag>
      </tags>
  </entry>
  <entry>
    <title>Js异步改同步（按顺序执行）</title>
    <url>/2022/04/13/Js%E5%BC%82%E6%AD%A5%E6%94%B9%E5%90%8C%E6%AD%A5%EF%BC%88%E6%8C%89%E9%A1%BA%E5%BA%8F%E6%89%A7%E8%A1%8C%EF%BC%89/</url>
    <content><![CDATA[<h5 id="使用-asycn-x2F-await"><a href="#使用-asycn-x2F-await" class="headerlink" title="使用 asycn &#x2F; await"></a>使用 asycn &#x2F; await</h5><h5 id="使用场景：当有耗时方法执行，想让另一段代码在这段耗时代码之后执行时"><a href="#使用场景：当有耗时方法执行，想让另一段代码在这段耗时代码之后执行时" class="headerlink" title="使用场景：当有耗时方法执行，想让另一段代码在这段耗时代码之后执行时"></a>使用场景：当有耗时方法执行，想让另一段代码在这段耗时代码之后执行时</h5><span id="more"></span>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">val flag = <span class="string">&#x27;before&#x27;</span></span><br><span class="line">val slowFun = <span class="keyword">function</span>(<span class="params"></span>)&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function"><span class="params">resolve</span> =&gt;</span> &#123; <span class="comment">// 返回一个 promise 对象</span></span><br><span class="line">    <span class="built_in">setTimeout</span>(<span class="keyword">function</span>(<span class="params"></span>)&#123;</span><br><span class="line">      flag = <span class="string">&#x27;changed&#x27;</span></span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;slowFun done&#x27;</span>)</span><br><span class="line">      <span class="title function_">resolve</span>() <span class="comment">// 标志此方法完成</span></span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;, <span class="number">2000</span>)</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">doAll</span>(<span class="params"></span>)&#123; <span class="comment">// async 关键字指明是一个同步方法</span></span><br><span class="line">  <span class="keyword">await</span> <span class="title function_">slowFun</span>() <span class="comment">// await 即等待slowFun执行完成</span></span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(flag)</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;have waited slowFun for 2s&#x27;</span>)</span><br><span class="line">&#125;</span><br><span class="line"><span class="title function_">doAll</span>() <span class="comment">// 执行测试</span></span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>前端</category>
      </categories>
      <tags>
        <tag>Javascript</tag>
        <tag>异步同步</tag>
      </tags>
  </entry>
  <entry>
    <title>echarts鼠标首次悬浮经过页面闪动</title>
    <url>/2022/12/27/echarts%E9%BC%A0%E6%A0%87%E9%A6%96%E6%AC%A1%E6%82%AC%E6%B5%AE%E7%BB%8F%E8%BF%87%E9%A1%B5%E9%9D%A2%E9%97%AA%E5%8A%A8/</url>
    <content><![CDATA[<h3 id="使用-echarts-绘制图形后，在页面中首次鼠标悬浮划过会出现页面闪动，突然有滚动条出现又立即消失，从页面来看应该是-tooltip-超出屏幕边界导致的，可以通过以下办法解决-："><a href="#使用-echarts-绘制图形后，在页面中首次鼠标悬浮划过会出现页面闪动，突然有滚动条出现又立即消失，从页面来看应该是-tooltip-超出屏幕边界导致的，可以通过以下办法解决-：" class="headerlink" title="使用 echarts 绘制图形后，在页面中首次鼠标悬浮划过会出现页面闪动，突然有滚动条出现又立即消失，从页面来看应该是 tooltip 超出屏幕边界导致的，可以通过以下办法解决 ："></a>使用 <code>echarts</code> 绘制图形后，在页面中首次鼠标悬浮划过会出现页面闪动，突然有滚动条出现又立即消失，从页面来看应该是 <code>tooltip</code> 超出屏幕边界导致的，可以通过以下办法解决 ：</h3><h3 id="tooltip-options-添加以下属性："><a href="#tooltip-options-添加以下属性：" class="headerlink" title="tooltip options 添加以下属性："></a><code>tooltip options</code> 添加以下属性：</h3><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">	<span class="attr">tooltip</span>:&#123;</span><br><span class="line">		<span class="attr">transitionDuration</span>: <span class="number">0</span>,</span><br><span class="line">		<span class="comment">// ...</span></span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>前端</category>
      </categories>
      <tags>
        <tag>Echats</tag>
      </tags>
  </entry>
  <entry>
    <title>antVL7可视化开发问题</title>
    <url>/2022/06/02/antVL7%E5%8F%AF%E8%A7%86%E5%8C%96%E5%BC%80%E5%8F%91%E9%97%AE%E9%A2%98/</url>
    <content><![CDATA[<h5 id="前一阵子在使用antVL7进行地图可视化开发时遇到一些问题，这里总结记录一下"><a href="#前一阵子在使用antVL7进行地图可视化开发时遇到一些问题，这里总结记录一下" class="headerlink" title="前一阵子在使用antVL7进行地图可视化开发时遇到一些问题，这里总结记录一下"></a>前一阵子在使用antVL7进行地图可视化开发时遇到一些问题，这里总结记录一下</h5><h6 id="经典热力图展示问题"><a href="#经典热力图展示问题" class="headerlink" title="经典热力图展示问题"></a>经典热力图展示问题</h6><blockquote>
<p>首先是基本用法</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> myHeatmapLayer = <span class="keyword">new</span> <span class="title class_">HeatmapLayer</span>()</span><br><span class="line">  .<span class="title function_">source</span>(data)</span><br><span class="line">  .<span class="title function_">shape</span>(<span class="string">&#x27;heatmap&#x27;</span>)</span><br><span class="line">  .<span class="title function_">size</span>(<span class="string">&#x27;demonum&#x27;</span>, [<span class="number">0</span>, <span class="number">1.0</span>])</span><br><span class="line">  .<span class="title function_">style</span>(&#123;</span><br><span class="line">    <span class="comment">// 具体色带，热力图最小半径等配置，可以自行去官网查看</span></span><br><span class="line">    ......</span><br><span class="line">  &#125;)</span><br></pre></td></tr></table></figure>
<p>上述代码 data 是一个由多个 feature 点构成的 geojson 格式数据；<br>其中 demonum 是上述数据中 feature 属性即 <code>feature.properties.demonum</code> 字段大小（必须为数字类型，可以遍历使用<code>Number()</code>操作）<br>由于有多个 feature, 所以热力图 将根据每个 feature 中的 demonum 字段大小作为热力值进行绘制 <span id="more"></span></p>
<p>这里有个坑，如果每个 feature 中的 demonum 都为 0，这时每个点热力值都会按照最大值进行处理，即 <strong>明明每个点的热力值都为 0 ，热力图却按最大值进行绘制了</strong>，这应该算是一个 bug，不知道后续官网会不会处理。</p>
<p>避免方法：可以自行遍历判断每个点数据的 demonum 属性，如果全部为 0 则不进行热力图的绘制，此时前端展示较为合理。</p>
</blockquote>
<h6 id="layer的鼠标移入移出事件频繁异常触发"><a href="#layer的鼠标移入移出事件频繁异常触发" class="headerlink" title="layer的鼠标移入移出事件频繁异常触发"></a>layer的鼠标移入移出事件频繁异常触发</h6><blockquote>
<p>假设现在有一个图层 myLayer ,需求为鼠标移入展示一个 popup 弹窗，鼠标移出销毁此 popup<br>添加取消事件代码：</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">myLayer.<span class="title function_">on</span>(<span class="string">&#x27;mouseenter&#x27;</span>,<span class="function"><span class="params">ev</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;mouseenter......&#x27;</span>)</span><br><span class="line">&#125;)</span><br><span class="line">myLayer.<span class="title function_">on</span>(<span class="string">&#x27;mouseout&#x27;</span>,<span class="function"><span class="params">ev</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;mouseout......&#x27;</span>)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>代码看起来没有问题，我也去官网找到了鼠标事件的用法，这里贴上：</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">layer.<span class="title function_">on</span>(<span class="string">&#x27;mouseenter&#x27;</span>, <span class="function">(<span class="params">ev</span>) =&gt;</span> &#123;&#125;); <span class="comment">// 鼠标进入图层要素</span></span><br><span class="line">layer.<span class="title function_">on</span>(<span class="string">&#x27;mousemove&#x27;</span>, <span class="function">(<span class="params">ev</span>) =&gt;</span> &#123;&#125;); <span class="comment">// 鼠标在图层上移动时触发</span></span><br><span class="line">layer.<span class="title function_">on</span>(<span class="string">&#x27;mouseout&#x27;</span>, <span class="function">(<span class="params">ev</span>) =&gt;</span> &#123;&#125;); <span class="comment">// 鼠标移出图层要素时触发</span></span><br></pre></td></tr></table></figure>

<p>我运行了我的代码，发现鼠标移入 myLayer 图层时，控制台打印了多次<code>mouseenter......</code>和<code>mouseout......</code>，我明明只移入了一次，不知道为何会触发这么多次事件。。。。。。<br>这就造成了我页面中 popup 弹窗频繁闪动。。。</p>
<p>最后，我使用了 <code>layer.on(&#39;mousemove&#39;)</code> 方式处理 popup<br>这种做法的好处是：弹窗不会频繁闪动，因为它在不间断地销毁和生成；<br>坏处是：性能损失较大，而且没有鼠标移出事件，需要点击地图弹窗才能消失。<br>我目前的感觉是 这也是此可视化框架的一个 bug，还在继续研究。。。</p>
</blockquote>
<hr>
<h6 id="待续。。。。。。"><a href="#待续。。。。。。" class="headerlink" title="待续。。。。。。"></a>待续。。。。。。</h6>]]></content>
      <categories>
        <category>前端</category>
      </categories>
      <tags>
        <tag>Vue</tag>
        <tag>Javascript</tag>
        <tag>地图可视化</tag>
      </tags>
  </entry>
  <entry>
    <title>NodeJs换镜像源</title>
    <url>/2022/04/11/NodeJs%E6%8D%A2%E9%95%9C%E5%83%8F%E6%BA%90/</url>
    <content><![CDATA[<h3 id="nodejs-换源"><a href="#nodejs-换源" class="headerlink" title="nodejs 换源"></a>nodejs 换源</h3><p>get命令查看registry</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">npm config get registry</span><br></pre></td></tr></table></figure>

<p>nodejs原版registry为</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="attr">http</span>:<span class="comment">//registry.npmjs.org</span></span><br></pre></td></tr></table></figure>
<span id="more"></span>
<p>用set换为淘宝镜像：</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">npm config set registry <span class="attr">http</span>:<span class="comment">//registry.npm.taobao.org</span></span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>前端</category>
      </categories>
      <tags>
        <tag>Javascript</tag>
        <tag>NodeJs</tag>
      </tags>
  </entry>
  <entry>
    <title>Vue中clearInterval失效问题</title>
    <url>/2022/04/18/Vue%E4%B8%ADclearInterval%E5%A4%B1%E6%95%88%E9%97%AE%E9%A2%98/</url>
    <content><![CDATA[<h5 id="使用场景：在当前页面使用的定时器，离开当前页面需要销毁-以避免不必要的性能浪费"><a href="#使用场景：在当前页面使用的定时器，离开当前页面需要销毁-以避免不必要的性能浪费" class="headerlink" title="使用场景：在当前页面使用的定时器，离开当前页面需要销毁 以避免不必要的性能浪费"></a>使用场景：在当前页面使用的定时器，离开当前页面需要销毁 以避免不必要的性能浪费</h5><h5 id="首先是setInterval和clearInterval的基本用法"><a href="#首先是setInterval和clearInterval的基本用法" class="headerlink" title="首先是setInterval和clearInterval的基本用法"></a>首先是<strong>setInterval</strong>和<strong>clearInterval</strong>的基本用法</h5><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> myTimer = <span class="built_in">setInterval</span>(<span class="keyword">function</span>(<span class="params"></span>)&#123; <span class="comment">// 每 1s 调用一次</span></span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;do once...&#x27;</span>)</span><br><span class="line">&#125;, <span class="number">1000</span>)</span><br><span class="line"></span><br><span class="line"><span class="title function_">beforeDestroy</span>(<span class="params"></span>)&#123;</span><br><span class="line">  <span class="built_in">clearInterval</span>(myTimer) <span class="comment">// 清除定时器 myTimer</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<span id="more"></span>
<h5 id="在-Vue-中，有时会发现-clearInterval-执行后定时器并没有被清除，可以使用下面方法试试"><a href="#在-Vue-中，有时会发现-clearInterval-执行后定时器并没有被清除，可以使用下面方法试试" class="headerlink" title="在 Vue 中，有时会发现 clearInterval 执行后定时器并没有被清除，可以使用下面方法试试"></a>在 Vue 中，有时会发现 clearInterval 执行后定时器并没有被清除，可以使用下面方法试试</h5><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> myTimer = <span class="built_in">setInterval</span>(<span class="keyword">function</span>(<span class="params"></span>)&#123;</span><br><span class="line">  <span class="comment">// do someting...</span></span><br><span class="line">&#125;, <span class="number">1000</span>)</span><br><span class="line"><span class="variable language_">this</span>.$once(<span class="string">&#x27;hook:beforeDestroy&#x27;</span>,<span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">clearInterval</span>(myTimer)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<h5 id="修改为上面的方法之后-clearInterval-就生效了，具体原因不明"><a href="#修改为上面的方法之后-clearInterval-就生效了，具体原因不明" class="headerlink" title="修改为上面的方法之后 clearInterval 就生效了，具体原因不明"></a>修改为上面的方法之后 clearInterval 就生效了，具体原因不明</h5><p>$once 相关用法参考 <a href="https://cn.vuejs.org/v2/api/#vm-once">Vue api 实例方法&#x2F;事件</a></p>
]]></content>
      <categories>
        <category>前端</category>
      </categories>
      <tags>
        <tag>Vue</tag>
        <tag>Javascript</tag>
      </tags>
  </entry>
  <entry>
    <title>vue2/3使用highcharts时3d类图表3d效果不生效问题</title>
    <url>/2024/04/18/vue2-3%E4%BD%BF%E7%94%A8highcharts%E6%97%B63d%E7%B1%BB%E5%9B%BE%E8%A1%A83d%E6%95%88%E6%9E%9C%E4%B8%8D%E7%94%9F%E6%95%88%E9%97%AE%E9%A2%98/</url>
    <content><![CDATA[<h5 id="在进行图表展示开发时，因为外观的需求，有时会有-3d图表-的展示要求，这时可以使用-Highcharts-来满足开发需求。-在这里记录一下其基本用法"><a href="#在进行图表展示开发时，因为外观的需求，有时会有-3d图表-的展示要求，这时可以使用-Highcharts-来满足开发需求。-在这里记录一下其基本用法" class="headerlink" title="在进行图表展示开发时，因为外观的需求，有时会有 3d图表 的展示要求，这时可以使用 Highcharts 来满足开发需求。  在这里记录一下其基本用法"></a>在进行图表展示开发时，因为外观的需求，有时会有 3d图表 的展示要求，这时可以使用 <code>Highcharts</code> 来满足开发需求。 <br/> 在这里记录一下其基本用法</h5><ul>
<li>首先安装 <code>npm install highcharts-vue</code></li>
<li>在展示组件&#x2F;页面里引入，<b>!!!注意后两行，这里是关键，只有引入3d库才能支持3d图表!!!</b><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123;<span class="title class_">Chart</span>&#125; <span class="keyword">from</span> <span class="string">&quot;highcharts-vue&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> highcharts <span class="keyword">from</span> <span class="string">&quot;highcharts&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> highcharts3d <span class="keyword">from</span> <span class="string">&quot;highcharts/highcharts-3d&quot;</span>;</span><br><span class="line"><span class="title function_">highcharts3d</span>(highcharts);</span><br></pre></td></tr></table></figure>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">Chart</span> <span class="attr">:options</span>=<span class="string">&quot;chartOptions&quot;</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;/<span class="name">Chart</span>&gt;</span></span><br></pre></td></tr></table></figure></li>
<li>这时就可以使用 <code>chartOptions</code> 参照官方文档开始配置属性项了</li>
</ul>
]]></content>
      <categories>
        <category>前端</category>
      </categories>
      <tags>
        <tag>Javascript</tag>
        <tag>Highcharts</tag>
      </tags>
  </entry>
  <entry>
    <title>flex布局space-between最后一行展示问题</title>
    <url>/2022/12/29/flex%E5%B8%83%E5%B1%80space-between%E6%9C%80%E5%90%8E%E4%B8%80%E8%A1%8C%E5%B1%95%E7%A4%BA%E9%97%AE%E9%A2%98/</url>
    <content><![CDATA[<h3 id="在使用-flex-进行布局时涉及多个元素遍历渲染，-要使用-space-between-时会发现：-最后一行元素数不满一行个数时会平均分布开，-而不会从左到右排列，-不符合一般样式要求"><a href="#在使用-flex-进行布局时涉及多个元素遍历渲染，-要使用-space-between-时会发现：-最后一行元素数不满一行个数时会平均分布开，-而不会从左到右排列，-不符合一般样式要求" class="headerlink" title="在使用 flex 进行布局时涉及多个元素遍历渲染， 要使用 space-between 时会发现： 最后一行元素数不满一行个数时会平均分布开， 而不会从左到右排列， 不符合一般样式要求"></a>在使用 <code>flex</code> 进行布局时涉及多个元素遍历渲染， 要使用 <code>space-between</code> 时会发现： 最后一行元素数不满一行个数时会平均分布开， 而不会从左到右排列， 不符合一般样式要求</h3><hr>
<p><strong>可以使用下面的办法解决</strong><span id="more"></span></p>
<ul>
<li><code>wells</code> 为一个长度若干的数组 遍历取得每个元素并渲染<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;wells&quot;</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&#x27;well&#x27;</span> <span class="attr">v-for</span>=<span class="string">&quot;(well, index) in wells&quot;</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">	<span class="comment">&lt;!-- 下面这一行 重点 --&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;list&quot;</span> </span></span><br><span class="line"><span class="tag">		<span class="attr">v-for</span>=<span class="string">&quot;item in (5 - wells.length % 5)&quot;</span> </span></span><br><span class="line"><span class="tag">		<span class="attr">v-if</span>=<span class="string">&quot;wells.length % 5 &gt; 0&quot;</span></span></span><br><span class="line"><span class="tag">	&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>
  <figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="selector-class">.wells</span>&#123;</span><br><span class="line">	<span class="attribute">display</span>: flex;</span><br><span class="line">	<span class="attribute">justify-content</span>: space-between;</span><br><span class="line">	<span class="attribute">flex-flow</span>: row wrap;</span><br><span class="line">	<span class="attribute">text-align</span>: center;</span><br><span class="line">	<span class="selector-class">.well</span>&#123;</span><br><span class="line">		<span class="attribute">flex</span>: <span class="number">0</span> <span class="number">0</span> <span class="number">18%</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="selector-class">.list</span> &#123;</span><br><span class="line">		<span class="attribute">content</span>: <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">		<span class="attribute">flex</span>: <span class="number">0</span> <span class="number">0</span> <span class="number">18%</span>;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ul>
]]></content>
      <categories>
        <category>前端</category>
      </categories>
      <tags>
        <tag>Css</tag>
      </tags>
  </entry>
  <entry>
    <title>elementUI修改messageBox弹框样式</title>
    <url>/2022/05/18/elementUI%E4%BF%AE%E6%94%B9messageBox%E5%BC%B9%E6%A1%86%E6%A0%B7%E5%BC%8F/</url>
    <content><![CDATA[<h6 id="elementUI-messageBox-组件自定义样式方法：添加属性’customClass’"><a href="#elementUI-messageBox-组件自定义样式方法：添加属性’customClass’" class="headerlink" title="elementUI messageBox 组件自定义样式方法：添加属性’customClass’"></a>elementUI messageBox 组件自定义样式方法：添加属性’customClass’</h6><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="variable language_">this</span>.$confirm(<span class="string">&#x27;确认？&#x27;</span>,<span class="string">&#x27;告警&#x27;</span>,&#123;</span><br><span class="line">  <span class="attr">confirmButtonText</span>: <span class="string">&#x27;确定&#x27;</span>,</span><br><span class="line">  <span class="attr">cancelButtonText</span>: <span class="string">&#x27;&#x27;</span>,</span><br><span class="line">  <span class="attr">type</span>: <span class="string">&#x27;warning&#x27;</span>,</span><br><span class="line">  <span class="attr">customClass</span>: <span class="string">&#x27;myBox&#x27;</span>  <span class="comment">// 👈</span></span><br><span class="line">&#125;).<span class="title function_">then</span>(<span class="keyword">function</span>(<span class="params"></span>)&#123;</span><br><span class="line">  <span class="comment">// do some </span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<h6 id="注意-放-customClass-的-style-不能加-scoped"><a href="#注意-放-customClass-的-style-不能加-scoped" class="headerlink" title="注意 放 customClass 的 style 不能加 scoped"></a>注意 放 customClass 的 style 不能加 scoped</h6><figure class="highlight css"><table><tr><td class="code"><pre><span class="line">&lt;style&gt;</span><br><span class="line"><span class="selector-class">.myBox</span> &#123;</span><br><span class="line">  <span class="attribute">background</span>: green;</span><br><span class="line">  ......</span><br><span class="line">&#125;</span><br><span class="line">&lt;/style&gt;</span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>前端</category>
      </categories>
      <tags>
        <tag>ElementUI</tag>
        <tag>Css</tag>
      </tags>
  </entry>
  <entry>
    <title>mapbox关闭/取消图层的点击事件</title>
    <url>/2022/05/18/mapbox%E5%85%B3%E9%97%AD-%E5%8F%96%E6%B6%88%E5%9B%BE%E5%B1%82%E7%9A%84%E7%82%B9%E5%87%BB%E4%BA%8B%E4%BB%B6/</url>
    <content><![CDATA[<h6 id="mapbox地图开发时会遇到给图层添加完点击事件无法继续使用匿名函数取消掉此事件，此时稍微修改写法即可"><a href="#mapbox地图开发时会遇到给图层添加完点击事件无法继续使用匿名函数取消掉此事件，此时稍微修改写法即可" class="headerlink" title="mapbox地图开发时会遇到给图层添加完点击事件无法继续使用匿名函数取消掉此事件，此时稍微修改写法即可"></a>mapbox地图开发时会遇到给图层添加完点击事件无法继续使用匿名函数取消掉此事件，此时稍微修改写法即可</h6><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">map.<span class="title function_">on</span>(<span class="string">&#x27;click&#x27;</span>,<span class="string">&#x27;layerId&#x27;</span>,<span class="keyword">function</span>(<span class="params">e</span>)&#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(e)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>👇</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">myClick</span>(<span class="params">e</span>)&#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(e)</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 注册事件</span></span><br><span class="line">map.<span class="title function_">on</span>(<span class="string">&#x27;click&#x27;</span>, <span class="string">&#x27;layerId&#x27;</span>, <span class="title function_">myClick</span>(e))</span><br><span class="line"><span class="comment">// 取消事件</span></span><br><span class="line">map.<span class="title function_">off</span>(<span class="string">&#x27;click&#x27;</span>, <span class="string">&#x27;layerId&#x27;</span>, <span class="title function_">myClick</span>(e))</span><br></pre></td></tr></table></figure>
<h6 id="踩坑！！！-需要注意的是如果用-Vue-开发，上面的自定义-click-事件不要写到-method-中去，直接与-map-on-方法平级即可"><a href="#踩坑！！！-需要注意的是如果用-Vue-开发，上面的自定义-click-事件不要写到-method-中去，直接与-map-on-方法平级即可" class="headerlink" title="踩坑！！！ 需要注意的是如果用 Vue 开发，上面的自定义 click 事件不要写到 method:{} 中去，直接与 map.on() 方法平级即可"></a>踩坑！！！ 需要注意的是如果用 Vue 开发，上面的自定义 click 事件不要写到 method:{} 中去，直接与 map.on() 方法平级即可</h6>]]></content>
      <categories>
        <category>前端</category>
      </categories>
      <tags>
        <tag>Gis开发</tag>
        <tag>Javascript</tag>
        <tag>Mapbox</tag>
      </tags>
  </entry>
  <entry>
    <title>从服务器指定路径下载文件</title>
    <url>/2022/04/11/%E4%BB%8E%E6%9C%8D%E5%8A%A1%E5%99%A8%E6%8C%87%E5%AE%9A%E8%B7%AF%E5%BE%84%E4%B8%8B%E8%BD%BD%E6%96%87%E4%BB%B6/</url>
    <content><![CDATA[<h2 id="从服务器路径-x2F-本地指定路径下载文件"><a href="#从服务器路径-x2F-本地指定路径下载文件" class="headerlink" title="从服务器路径 &#x2F; 本地指定路径下载文件"></a>从服务器路径 &#x2F; 本地指定路径下载文件</h2><h3 id="前端（普通blod下载方式）"><a href="#前端（普通blod下载方式）" class="headerlink" title="前端（普通blod下载方式）"></a>前端（普通blod下载方式）</h3><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">//点击下载</span></span><br><span class="line">   <span class="title function_">downloadInfo</span>(<span class="params"></span>) &#123;</span><br><span class="line">     <span class="variable language_">this</span>.<span class="title function_">axiosFun</span>() <span class="comment">//axios请求</span></span><br><span class="line">       .<span class="title function_">then</span>(<span class="keyword">function</span> (<span class="params">response</span>) &#123;</span><br><span class="line">         <span class="keyword">var</span> blob = <span class="keyword">new</span> <span class="title class_">Blob</span>([response], &#123; <span class="attr">type</span>: <span class="string">&quot;application/x-xls&quot;</span> &#125;); <span class="comment">//创建一个blob对象</span></span><br><span class="line">         <span class="keyword">var</span> a = <span class="variable language_">document</span>.<span class="title function_">createElement</span>(<span class="string">&quot;a&quot;</span>); <span class="comment">//创建一个&lt;a&gt;&lt;/a&gt;标签</span></span><br><span class="line">         a.<span class="property">href</span> = <span class="variable constant_">URL</span>.<span class="title function_">createObjectURL</span>(blob); <span class="comment">// response is a blob</span></span><br><span class="line">         <span class="keyword">var</span> patt = <span class="keyword">new</span> <span class="title class_">RegExp</span>(<span class="string">&#x27;filename=([^;]+\\.[^\\.;]+);*&#x27;</span>)</span><br><span class="line">         <span class="keyword">var</span> contentDisposition = <span class="title function_">decodeURL</span>(res.<span class="property">headers</span>[<span class="string">&#x27;content-disposition&#x27;</span>])</span><br><span class="line">         <span class="keyword">var</span> result = patt.<span class="title function_">exec</span>(contentDisposition)</span><br><span class="line">         <span class="keyword">var</span> fileName = result[<span class="number">1</span>]</span><br><span class="line">         fileName = fileName.<span class="title function_">replace</span>(<span class="regexp">/\&quot;/g</span>,<span class="string">&#x27;&#x27;</span>)</span><br><span class="line">         a.<span class="property">download</span> = fileName; <span class="comment">//文件名称</span></span><br><span class="line">         a.<span class="property">style</span>.<span class="property">display</span> = <span class="string">&quot;none&quot;</span>;</span><br><span class="line">         <span class="variable language_">document</span>.<span class="property">body</span>.<span class="title function_">appendChild</span>(a);</span><br><span class="line">         a.<span class="title function_">click</span>();</span><br><span class="line">         a.<span class="title function_">remove</span>();</span><br><span class="line">         <span class="comment">// this.$refs.upload.clearFiles()</span></span><br><span class="line">       &#125;)</span><br><span class="line">       .<span class="title function_">catch</span>(<span class="keyword">function</span> (<span class="params">err</span>) &#123;</span><br><span class="line">         <span class="variable language_">console</span>.<span class="title function_">log</span>(err);</span><br><span class="line">       &#125;);</span><br><span class="line">   &#125;,</span><br></pre></td></tr></table></figure>
<span id="more"></span>
<h3 id="后端"><a href="#后端" class="headerlink" title="后端"></a>后端</h3><p><em><strong>controller 和  service接口太过简单， 直接 Impl</strong></em></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">exportErr</span><span class="params">(HttpServletResponse response, String tmpId)</span> &#123;</span><br><span class="line">        <span class="type">InputStream</span> <span class="variable">inputStream</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">        <span class="type">OutputStream</span> <span class="variable">outputStream</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="type">File</span> <span class="variable">file</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">File</span>(<span class="string">&quot;文件在服务器的路径&quot;</span>);</span><br><span class="line">            <span class="type">String</span> <span class="variable">fileName</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">String</span>(file.getName().getBytes(<span class="string">&quot;gb2312&quot;</span>),<span class="string">&quot;ISO8859-1&quot;</span>);</span><br><span class="line">            response.setContentType(<span class="string">&quot;application/vnd.ms-excel;chartset=utf-8&quot;</span>);</span><br><span class="line">            response.setHeader(<span class="string">&quot;Content-Disposition&quot;</span>,<span class="string">&quot;attachment;filename=&quot;</span> + fileName);</span><br><span class="line">            inputStream = <span class="keyword">new</span> <span class="title class_">BufferedInputStream</span>(<span class="keyword">new</span> <span class="title class_">FileInputStream</span>(file));</span><br><span class="line">            outputStream = response.getOutputStream();</span><br><span class="line">            <span class="type">byte</span>[] buf = <span class="keyword">new</span> <span class="title class_">byte</span>[<span class="number">1024</span>];</span><br><span class="line">            <span class="type">int</span> len;</span><br><span class="line">            <span class="keyword">while</span> ((len = inputStream.read(buf))&gt;<span class="number">0</span>)&#123;</span><br><span class="line">                outputStream.write(buf,<span class="number">0</span>,len);</span><br><span class="line">            &#125;</span><br><span class="line">            response.flushBuffer();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">        <span class="comment">//别忘了关闭流</span></span><br><span class="line">            <span class="keyword">if</span> (inputStream!=<span class="literal">null</span>)&#123;</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    inputStream.close();</span><br><span class="line">                &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">                    e.printStackTrace();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> (outputStream!=<span class="literal">null</span>)&#123;</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    outputStream.close();</span><br><span class="line">                &#125;<span class="keyword">catch</span> (IOException e)&#123;</span><br><span class="line">                    e.printStackTrace();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<h3 id="结束"><a href="#结束" class="headerlink" title="结束"></a>结束</h3>]]></content>
      <categories>
        <category>前端</category>
        <category>后端</category>
      </categories>
      <tags>
        <tag>Vue</tag>
        <tag>Javascript</tag>
        <tag>上传下载</tag>
        <tag>SpringBoot</tag>
      </tags>
  </entry>
  <entry>
    <title>vue3vite中不支持require后的平替写法</title>
    <url>/2025/01/15/vue3vite%E4%B8%AD%E4%B8%8D%E6%94%AF%E6%8C%81require%E5%90%8E%E7%9A%84%E5%B9%B3%E6%9B%BF%E5%86%99%E6%B3%95/</url>
    <content><![CDATA[<h4 id="当开发框架从-vue2-升级到-vue3-vite-后-或者-项目要从-v2-升级到-v3-vite，一些使用-require-的动态路径引入的资源会报错"><a href="#当开发框架从-vue2-升级到-vue3-vite-后-或者-项目要从-v2-升级到-v3-vite，一些使用-require-的动态路径引入的资源会报错" class="headerlink" title="当开发框架从 vue2 升级到 vue3 + vite 后 或者 项目要从 v2 升级到 v3 + vite，一些使用 require 的动态路径引入的资源会报错"></a>当开发框架从 <code>vue2</code> 升级到 <code>vue3 + vite</code> 后 或者 项目要从 <code>v2</code> 升级到 <code>v3 + vite</code>，一些使用 <code>require</code> 的<font color='#ea7b7b'>动态路径</font>引入的资源会报错<br></h4><h4 id="这一般是因为-vue3-vite-不支持-commonjs-写法，可以安装一些插件来支持，但我个人更倾向于使用-v3-的解决方案："><a href="#这一般是因为-vue3-vite-不支持-commonjs-写法，可以安装一些插件来支持，但我个人更倾向于使用-v3-的解决方案：" class="headerlink" title="这一般是因为 vue3 vite 不支持 commonjs 写法，可以安装一些插件来支持，但我个人更倾向于使用 v3 的解决方案："></a>这一般是因为 <code>vue3</code> <code>vite</code> 不支持 <code>commonjs</code> 写法，可以安装一些插件来支持，但我个人更倾向于使用 <code>v3</code> 的解决方案：<br></h4><ul>
<li><p>这是之前的写法</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">img</span> <span class="attr">alt</span>=<span class="string">&quot;&quot;</span> <span class="attr">:src</span>=<span class="string">&quot;require(`/path/$&#123;aPath&#125;.png&#x27;)`&quot;</span>/&gt;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> aPath = <span class="string">&#x27;imgName&#x27;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>处理成 <code>v3</code> 支持的写法 👇</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">img</span> <span class="attr">alt</span>=<span class="string">&quot;&quot;</span> <span class="attr">:src</span>=<span class="string">&quot;getImgUrl(&#x27;imgName&#x27;)&quot;</span>/&gt;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title function_">getImgUrl</span> = (<span class="params">name</span>) =&gt; &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title function_">URL</span>(<span class="string">&#x27;/path/&#x27;</span> + name + <span class="string">&#x27;.png&#x27;</span>, <span class="keyword">import</span>.<span class="property">meta</span>.<span class="property">url</span>).<span class="property">href</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ul>
]]></content>
      <categories>
        <category>前端</category>
      </categories>
      <tags>
        <tag>Vue</tag>
        <tag>Javascript</tag>
      </tags>
  </entry>
  <entry>
    <title>vue路由重复点击报错</title>
    <url>/2022/12/27/vue%E8%B7%AF%E7%94%B1%E9%87%8D%E5%A4%8D%E7%82%B9%E5%87%BB%E6%8A%A5%E9%94%99/</url>
    <content><![CDATA[<h3 id="通过-router-push-的方式跳转路由时，路由重复点击会报错"><a href="#通过-router-push-的方式跳转路由时，路由重复点击会报错" class="headerlink" title="通过 $router.push() 的方式跳转路由时，路由重复点击会报错"></a>通过 $router.push() 的方式跳转路由时，路由重复点击会报错</h3><p><b>解决办法</b>：</p>
<ol>
<li>在 <code>router</code> 的 <code>index.js</code> 文件中 <code>use router</code> 之前加入以下代码 : <figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">//router/index.js</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">Router</span> <span class="keyword">from</span> <span class="string">&quot;vue-router&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> originalPush = <span class="title class_">Router</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">push</span></span><br><span class="line"><span class="title class_">Router</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">push</span> = <span class="keyword">function</span> <span class="title function_">push</span>(<span class="params">location</span>) &#123;</span><br><span class="line">   <span class="keyword">return</span> originalPush.<span class="title function_">call</span>(<span class="variable language_">this</span>, location).<span class="title function_">catch</span>(<span class="function"><span class="params">err</span> =&gt;</span> err)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li>在使用 <code>$router.push()</code> 时 <code>catch</code> 一下 <code>err</code> : <figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="variable language_">this</span>.<span class="property">$router</span>.<span class="title function_">push</span>(&#123;&#125;).<span class="title function_">catch</span>(<span class="function"><span class="params">err</span> =&gt;</span> &#123;&#125;)</span><br></pre></td></tr></table></figure></li>
</ol>
]]></content>
      <categories>
        <category>前端</category>
      </categories>
      <tags>
        <tag>Vue</tag>
      </tags>
  </entry>
  <entry>
    <title>使用protobuf进行前后端数据交互</title>
    <url>/2023/05/22/%E4%BD%BF%E7%94%A8protobuf%E8%BF%9B%E8%A1%8C%E5%89%8D%E5%90%8E%E7%AB%AF%E6%95%B0%E6%8D%AE%E4%BA%A4%E4%BA%92/</url>
    <content><![CDATA[<h5 id="在前后端交互过程中，一般采用json作为通信协议，不过在特殊情况下-比如最近项目中要求websocket短时间内频繁由后台推送大量数据给前端，由于网络原因很容易阻塞-–-这时就需要将数据包进行压缩-x2F-序列化-amp-反序列化等处理以减小负载。经过考虑最终选择protobuf作为通信协议，先把数据进行序列化再发送…接收…处理"><a href="#在前后端交互过程中，一般采用json作为通信协议，不过在特殊情况下-比如最近项目中要求websocket短时间内频繁由后台推送大量数据给前端，由于网络原因很容易阻塞-–-这时就需要将数据包进行压缩-x2F-序列化-amp-反序列化等处理以减小负载。经过考虑最终选择protobuf作为通信协议，先把数据进行序列化再发送…接收…处理" class="headerlink" title="在前后端交互过程中，一般采用json作为通信协议，不过在特殊情况下:比如最近项目中要求websocket短时间内频繁由后台推送大量数据给前端，由于网络原因很容易阻塞 – 这时就需要将数据包进行压缩&#x2F;序列化&amp;反序列化等处理以减小负载。经过考虑最终选择protobuf作为通信协议，先把数据进行序列化再发送…接收…处理"></a>在前后端交互过程中，一般采用<code>json</code>作为通信协议，不过在特殊情况下:<br/>比如最近项目中要求<span style='color:green'><code>websocket</code>短时间内频繁由后台推送大量数据</span>给前端，由于网络原因很容易阻塞<br/> – 这时就需要将数据包进行压缩&#x2F;序列化&amp;反序列化等处理以减小负载。经过考虑最终选择<code>protobuf</code>作为通信协议，先把数据进行序列化再发送…接收…处理</h5><ol>
<li>首先是前后端协商定义数据格式  &#x3D;&gt; <span id="more"></span>最终后端语言定义并产出<code>.proto</code>文件供前后端使用<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 首先加载proto实体，确定解析的标准</span></span><br><span class="line"><span class="keyword">let</span> model, requestModel;</span><br><span class="line"><span class="keyword">var</span> protobuf = <span class="built_in">require</span>(<span class="string">&quot;protobufjs&quot;</span>);</span><br><span class="line">protobuf.<span class="title function_">load</span>(<span class="string">&quot;../example.proto&quot;</span>, <span class="keyword">function</span> (<span class="params">event, root</span>) &#123;</span><br><span class="line">  model = root.<span class="title function_">lookupType</span>(<span class="string">&quot;com.modelName&quot;</span>);</span><br><span class="line">  requestModel = root.<span class="title function_">lookupType</span>(<span class="string">&#x27;com.requestModelName&#x27;</span>)</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure></li>
<li>前端序列化<code>json</code> &amp;&amp; 发送<code>proto</code>数据<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> payload = &#123;<span class="attr">param1</span>:<span class="string">&#x27;paramData&#x27;</span>&#125;;</span><br><span class="line"><span class="keyword">var</span> errMsg = requestModel.<span class="title function_">verify</span>(payload);</span><br><span class="line"><span class="keyword">if</span> (errMsg)</span><br><span class="line">  <span class="keyword">if</span> (<span class="keyword">typeof</span> fail === <span class="string">&quot;function&quot;</span>)</span><br><span class="line">    <span class="keyword">throw</span> err;</span><br><span class="line"><span class="comment">// Create a new message</span></span><br><span class="line"><span class="keyword">let</span> message = <span class="title class_">RequestDataType</span>.<span class="title function_">create</span>(payload); <span class="comment">// or use .fromObject if conversion is necessary</span></span><br><span class="line"><span class="comment">// Encode a message to an Uint8Array (browser) or Buffer (node)</span></span><br><span class="line"><span class="keyword">let</span> buffer = <span class="title class_">RequestDataType</span>.<span class="title function_">encode</span>(message).<span class="title function_">finish</span>();</span><br><span class="line"><span class="comment">// buffer 即为需要发送的数据包</span></span><br></pre></td></tr></table></figure></li>
<li>前端解析接收到的<code>proto</code>数据<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 这里意思是模拟接收数据的回调</span></span><br><span class="line">xxx.<span class="title function_">then</span>(<span class="function"><span class="params">res</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">let</span> reader = <span class="keyword">new</span> <span class="title class_">FileReader</span>();</span><br><span class="line">  <span class="comment">// 假设res.data为接收到的数据包</span></span><br><span class="line">  reader.<span class="title function_">readAsArrayBuffer</span>(res.<span class="property">data</span>);</span><br><span class="line">  reader.<span class="property">onload</span> =<span class="function">(<span class="params">e</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">let</span> buf = <span class="keyword">new</span> <span class="title class_">Uint8Array</span>(e.<span class="property">target</span>.<span class="property">result</span>);</span><br><span class="line">    <span class="comment">// realData即为解析后的数据</span></span><br><span class="line">    <span class="keyword">let</span> realData = model.<span class="title function_">decode</span>(buf);</span><br><span class="line">    <span class="comment">// todo...根据返回的realData进行业务逻辑处理</span></span><br><span class="line">  &#125;;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure></li>
</ol>
]]></content>
      <categories>
        <category>前端</category>
      </categories>
      <tags>
        <tag>Javascript</tag>
      </tags>
  </entry>
  <entry>
    <title>webgl页面里使用vue动态render组件</title>
    <url>/2025/01/15/webgl%E9%A1%B5%E9%9D%A2%E9%87%8C%E4%BD%BF%E7%94%A8vue%E5%8A%A8%E6%80%81render%E7%BB%84%E4%BB%B6/</url>
    <content><![CDATA[<h4 id="在之前进行-webgl-类项目开发时，比如-mapbox-或者-three-或者它们的耦合体，还有-cesium-开发时，基本都会遇到需要需要在-webgl-页面里-点击产生-复杂弹窗-的需求"><a href="#在之前进行-webgl-类项目开发时，比如-mapbox-或者-three-或者它们的耦合体，还有-cesium-开发时，基本都会遇到需要需要在-webgl-页面里-点击产生-复杂弹窗-的需求" class="headerlink" title="在之前进行 webgl 类项目开发时，比如 mapbox 或者 three 或者它们的耦合体，还有 cesium 开发时，基本都会遇到需要需要在 webgl 页面里 点击产生 复杂弹窗 的需求"></a>在之前进行 <code>webgl</code> 类项目开发时，比如 <code>mapbox</code> 或者 <code>three</code> 或者它们的耦合体，还有 <code>cesium</code> 开发时，基本都会遇到需要需要在 <code>webgl</code> 页面里 点击产生<font color='#ea7b7b'> 复杂弹窗 </font>的需求<br></h4><h4 id="这时例如-threejs-就需要-css2dRender-或者-3dRender-去处理，mapbox-就需要-Popup-内嵌组件，Cesium-就需要-cesiumWidget-内嵌组件"><a href="#这时例如-threejs-就需要-css2dRender-或者-3dRender-去处理，mapbox-就需要-Popup-内嵌组件，Cesium-就需要-cesiumWidget-内嵌组件" class="headerlink" title="这时例如 threejs 就需要 css2dRender 或者 3dRender 去处理，mapbox 就需要 Popup 内嵌组件，Cesium 就需要 cesiumWidget 内嵌组件"></a>这时例如 <code>threejs</code> 就需要 <code>css2dRender</code> 或者 <code>3dRender</code> 去处理，<code>mapbox</code> 就需要 <code>Popup</code> 内嵌组件，<code>Cesium</code> 就需要 <code>cesiumWidget</code> 内嵌组件<br></h4><h4 id="这个时候弹窗想要内嵌一些复杂内容的话，只能把内容作为组件隔离出去，然后需要的时候挂载到-dom-树里"><a href="#这个时候弹窗想要内嵌一些复杂内容的话，只能把内容作为组件隔离出去，然后需要的时候挂载到-dom-树里" class="headerlink" title="这个时候弹窗想要内嵌一些复杂内容的话，只能把内容作为组件隔离出去，然后需要的时候挂载到 dom 树里"></a>这个时候弹窗想要内嵌一些复杂内容的话，只能把内容作为组件隔离出去，然后需要的时候挂载到 <code>dom</code> 树里</h4><h4 id="而且，vue2-和-vue3-的挂载方式又不相同，在这里记录一下"><a href="#而且，vue2-和-vue3-的挂载方式又不相同，在这里记录一下" class="headerlink" title="而且，vue2 和 vue3 的挂载方式又不相同，在这里记录一下"></a>而且，<code>vue2</code> 和 <code>vue3</code> 的挂载方式又不相同，在这里记录一下</h4><ul>
<li><p>首先是 <code>vue2</code> 的动态挂载组件方式</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> myPopup <span class="keyword">from</span> <span class="string">&#x27;./myPopup.vue&#x27;</span></span><br><span class="line"><span class="keyword">const</span> <span class="title class_">MyPopup</span> = <span class="title class_">Vue</span>.<span class="title function_">extend</span>(myPopup);</span><br><span class="line"><span class="keyword">let</span> popup = <span class="keyword">new</span> <span class="title class_">MyPopup</span>(&#123;</span><br><span class="line">    <span class="attr">propsData</span>: &#123;</span><br><span class="line">        <span class="comment">// 给组件传的参数</span></span><br><span class="line">        <span class="attr">data</span>:&#123;&#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br><span class="line">popup.$mount(<span class="string">&#x27;#targetId&#x27;</span>)</span><br></pre></td></tr></table></figure>
<p>👆上述代码就完成了组件实例的创建并挂载到指定 <code>id</code> 的容器中<br><br>至于其中的 <code>targetId</code> 就是你在 <code>webgl</code> 页面中使用它的 <code>api</code> 提前创建好的容器</p>
</li>
<li><p>其次就是 <code>vue3</code> 的动态挂载组件方式</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="title class_">MyPopup</span> <span class="keyword">from</span> <span class="string">&#x27;./myPopup.vue&#x27;</span></span><br><span class="line"><span class="keyword">let</span> vNode = <span class="title function_">h</span>(<span class="title class_">MyPopup</span>, &#123;<span class="attr">model</span>: &#123;&#125;&#125;)</span><br><span class="line"><span class="title function_">render</span>(vNode, <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">`targetId`</span>))</span><br></pre></td></tr></table></figure>
<p>其实只是写法稍稍不同，不管是 <code>mapbox</code> 还是 <code>threejs</code> 还是 <code>cesium</code>，只要使用相应的弹窗 <code>api</code> 创建好容器后，把组件 <code>render</code> 进去就完活了 -.-</p>
</li>
</ul>
]]></content>
      <categories>
        <category>前端</category>
      </categories>
      <tags>
        <tag>Vue</tag>
        <tag>Javascript</tag>
      </tags>
  </entry>
  <entry>
    <title>前端展示文件流图片</title>
    <url>/2022/04/11/%E5%89%8D%E7%AB%AF%E5%B1%95%E7%A4%BA%E6%96%87%E4%BB%B6%E6%B5%81%E5%9B%BE%E7%89%87/</url>
    <content><![CDATA[<h5 id="代码如下"><a href="#代码如下" class="headerlink" title="代码如下"></a>代码如下</h5><span id="more"></span>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line"><span class="comment">//随便搞一个容器</span></span><br><span class="line"> <span class="language-xml"><span class="tag">&lt;<span class="name">img</span> <span class="attr">id</span>=<span class="string">&quot;img1&quot;</span> <span class="attr">:src</span>=<span class="string">&quot;imageUrl1&quot;</span>  <span class="attr">alt</span>=<span class="string">&quot;&quot;</span> <span class="attr">style</span>=<span class="string">&quot;width: 700px&quot;</span>/&gt;</span></span></span><br><span class="line">&lt;/template&gt;</span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"> <span class="title function_">data</span>(<span class="params"></span>)&#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  <span class="keyword">return</span>&#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">   <span class="attr">imageUrl1</span>:<span class="string">&#x27;&#x27;</span>,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  &#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"> &#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"> <span class="title function_">mounted</span>(<span class="params"></span>)&#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  <span class="variable language_">this</span>.<span class="title function_">initImage</span>();</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"> &#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"> <span class="title function_">method</span>(<span class="params"></span>)&#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  <span class="title function_">initImage</span>(<span class="params"></span>)&#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">   <span class="variable language_">this</span>.<span class="title function_">axiosFun</span>()</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        .<span class="title function_">then</span>(<span class="keyword">function</span> (<span class="params">response</span>) &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">          <span class="keyword">var</span> blob = <span class="keyword">new</span> <span class="title class_">Blob</span>([response]); <span class="comment">//创建一个blob对象</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">          <span class="comment">//下面这一行为重点！！！！！！！！！！！！！！！！！！</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">          <span class="variable language_">this</span>.<span class="property">imageUrl1</span> = <span class="variable language_">window</span>.<span class="property">URL</span>.<span class="title function_">createObjectURL</span>(blob);</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        &#125;)</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        .<span class="title function_">catch</span>(<span class="keyword">function</span> (<span class="params">err</span>) &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">          <span class="variable language_">console</span>.<span class="title function_">log</span>(err);</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        &#125;);</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  &#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"> &#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span></span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>前端</category>
      </categories>
      <tags>
        <tag>Vue</tag>
        <tag>Javascript</tag>
      </tags>
  </entry>
  <entry>
    <title>原生HTML-table表格，超出内容鼠标悬浮展示</title>
    <url>/2022/04/28/%E5%8E%9F%E7%94%9FHTML-table%E8%A1%A8%E6%A0%BC%EF%BC%8C%E8%B6%85%E5%87%BA%E5%86%85%E5%AE%B9%E9%BC%A0%E6%A0%87%E6%82%AC%E6%B5%AE%E5%B1%95%E7%A4%BA/</url>
    <content><![CDATA[<h6 id="最近项目上遇到一个需求是地图上的-popup-弹窗里需要做个分页表格，所以这里只能用原生-html-js-来实现，又因为-popup-宽度非常有限，所以过长的-cell-需要用…隐藏，鼠标悬浮展示完整内容，纯-html-css-即可实现"><a href="#最近项目上遇到一个需求是地图上的-popup-弹窗里需要做个分页表格，所以这里只能用原生-html-js-来实现，又因为-popup-宽度非常有限，所以过长的-cell-需要用…隐藏，鼠标悬浮展示完整内容，纯-html-css-即可实现" class="headerlink" title="最近项目上遇到一个需求是地图上的 popup 弹窗里需要做个分页表格，所以这里只能用原生 html js 来实现，又因为 popup 宽度非常有限，所以过长的 cell 需要用…隐藏，鼠标悬浮展示完整内容，纯 html + css 即可实现"></a>最近项目上遇到一个需求是地图上的 popup 弹窗里需要做个分页表格，所以这里只能用原生 html js 来实现，又因为 popup 宽度非常有限，所以过长的 cell 需要用…隐藏，鼠标悬浮展示完整内容，纯 html + css 即可实现</h6><figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">table</span> <span class="attr">class</span>=<span class="string">&#x27;moreTable&#x27;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">td</span> <span class="attr">class</span>=<span class="string">&#x27;tableCell&#x27;</span> <span class="attr">title</span>=<span class="string">&#x27;内容内容内容内容内容内容内容内容&#x27;</span>&gt;</span>内容内容内容内容内容内容内容内容<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">td</span> <span class="attr">class</span>=<span class="string">&#x27;tableCell&#x27;</span> <span class="attr">titel</span>=<span class="string">&#x27;内容内容内容内容内容内容内容内容内容内容内容&#x27;</span>&gt;</span>内容内容内容内容内容内容内容内容内容内容内容<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">td</span> <span class="attr">class</span>=<span class="string">&#x27;tableCell&#x27;</span> <span class="attr">title</span>=<span class="string">&#x27;内容内容内容内容内容内容&#x27;</span>&gt;</span>内容内容内容内容内容内容<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">td</span> <span class="attr">class</span>=<span class="string">&#x27;tableCell&#x27;</span> <span class="attr">title</span>=<span class="string">&#x27;内容内容内容内容内容内容内容内容&#x27;</span>&gt;</span>内容内容内容内容内容内容内容内容<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">table</span>&gt;</span></span><br></pre></td></tr></table></figure>
<span id="more"></span>

<h6 id="👆-title-可以保证鼠标悬浮展示内容，可以通过遍历-table-tr-td-加上这个属性，必须保证-title-文字和内容区相同"><a href="#👆-title-可以保证鼠标悬浮展示内容，可以通过遍历-table-tr-td-加上这个属性，必须保证-title-文字和内容区相同" class="headerlink" title="👆 title 可以保证鼠标悬浮展示内容，可以通过遍历 table tr td 加上这个属性，必须保证 title 文字和内容区相同"></a>👆 title 可以保证鼠标悬浮展示内容，可以通过遍历 table tr td 加上这个属性，必须保证 title 文字和内容区相同</h6><figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="selector-class">.moreTable</span>&#123;</span><br><span class="line">  <span class="attribute">table-layout</span>: fixed;</span><br><span class="line">  <span class="attribute">word-break</span>: break-all;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">300px</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.tableCell</span>&#123;</span><br><span class="line">  <span class="attribute">overflow</span>: hidden; // 超出区域隐藏</span><br><span class="line">  <span class="attribute">text-overflow</span>: ellipsis;  // 文本超出区域...展示</span><br><span class="line">  <span class="attribute">white-space</span>: nowrap;  // 不换行</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h6 id="end…"><a href="#end…" class="headerlink" title="end…"></a>end…</h6>]]></content>
      <categories>
        <category>前端</category>
      </categories>
      <tags>
        <tag>Css</tag>
      </tags>
  </entry>
  <entry>
    <title>基于websocket使用mapbox结合threebox实现车辆实时轨迹展示</title>
    <url>/2023/03/20/%E5%9F%BA%E4%BA%8Ewebsocket%E4%BD%BF%E7%94%A8mapbox%E7%BB%93%E5%90%88threebox%E5%AE%9E%E7%8E%B0%E8%BD%A6%E8%BE%86%E5%AE%9E%E6%97%B6%E8%BD%A8%E8%BF%B9%E5%B1%95%E7%A4%BA/</url>
    <content><![CDATA[<h5 id="最近项目中有遇到根据实时推送数据展示轨迹的需求，并且需要加载gltf、glb此类3D模型作为车辆点，所以在此需要结合threejs但是若使用原生threejs的话结合地图开发不太友好，所以使用threebox作为桥梁可以减少很多心智负担。在这里做个小demo记录一下"><a href="#最近项目中有遇到根据实时推送数据展示轨迹的需求，并且需要加载gltf、glb此类3D模型作为车辆点，所以在此需要结合threejs但是若使用原生threejs的话结合地图开发不太友好，所以使用threebox作为桥梁可以减少很多心智负担。在这里做个小demo记录一下" class="headerlink" title="最近项目中有遇到根据实时推送数据展示轨迹的需求，并且需要加载gltf、glb此类3D模型作为车辆点，所以在此需要结合threejs但是若使用原生threejs的话结合地图开发不太友好，所以使用threebox作为桥梁可以减少很多心智负担。在这里做个小demo记录一下"></a>最近项目中有遇到根据实时推送数据展示轨迹的需求，并且需要加载<code>gltf</code>、<code>glb</code>此类3D模型作为车辆点，所以在此需要结合<code>threejs</code><br/>但是若使用原生<code>threejs</code>的话结合地图开发不太友好，所以使用<code>threebox</code>作为桥梁可以减少很多心智负担。在这里做个小demo记录一下</h5><hr>
<ol>
<li>引入所需的 js 库<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"> <span class="comment">// mapboxgl</span></span><br><span class="line"> &lt;script type=<span class="string">&quot;text/javascript&quot;</span> src=<span class="string">&quot;xxx/mapbox-gl.js&quot;</span>&gt;&lt;/script&gt;</span><br><span class="line">  <span class="language-xml"><span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">&quot;stylesheet&quot;</span> <span class="attr">type</span>=<span class="string">&quot;text/css&quot;</span> <span class="attr">href</span>=<span class="string">&quot;xxx/mapbox-gl.css&quot;</span>/&gt;</span></span></span><br><span class="line"><span class="comment">// threebox</span></span><br><span class="line">  <span class="language-xml"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">&quot;text/javascript&quot;</span> <span class="attr">src</span>=<span class="string">&quot;xxx/threebox/threebox.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span></span><br><span class="line">  <span class="language-xml"><span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">&quot;stylesheet&quot;</span> <span class="attr">type</span>=<span class="string">&quot;text/css&quot;</span> <span class="attr">href</span>=<span class="string">&quot;xxx/threebox/threebox.css&quot;</span> /&gt;</span></span></span><br><span class="line"><span class="comment">// turf</span></span><br><span class="line">  <span class="language-xml"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">&quot;text/javascript&quot;</span> <span class="attr">src</span>=<span class="string">&quot;./turf/turf.min.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span></span><br></pre></td></tr></table></figure>
  <span id="more"></span></li>
<li>创建一个地图容器<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;map-container&quot;</span> <span class="attr">id</span>=<span class="string">&quot;map&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure></li>
<li>声明一些全局变量<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> vehicleModel = <span class="literal">null</span> <span class="comment">// 模型实例</span></span><br><span class="line"><span class="keyword">let</span> socket = <span class="literal">null</span> <span class="comment">// websocket实例</span></span><br><span class="line"><span class="keyword">let</span> idLayer = <span class="literal">null</span> <span class="comment">// 车牌号图层</span></span><br><span class="line"><span class="keyword">let</span> map = <span class="literal">null</span> <span class="comment">// 地图实例</span></span><br><span class="line"><span class="keyword">let</span> wsURL = <span class="string">&#x27;ws://x.x.x.x:xxxx/xxx&#x27;</span> <span class="comment">// websocket url</span></span><br></pre></td></tr></table></figure></li>
<li>根据推送数据渲染&#x2F;更新模型属性<br/><br><strong>注意：当前<code>websocket</code>接口返回每一帧的数据格式为<br/><code>[&#123;      &quot;dateTime&quot;: &quot;2023-02-10 10:08:20:352&quot;,      &quot;originalType&quot;: 10,      &quot;latitude&quot;: 31.4247565,      &quot;picLicense&quot;: &quot;苏EEHC65&quot;,      &quot;stopNum&quot;: 2,      &quot;speed&quot;: 0.44,      &quot;licenseColor&quot;: 9,      &quot;baseLocation&quot;: 22,      &quot;originalColor&quot;: 3,      &quot;courseAngle&quot;: 286.1,      &quot;id&quot;: &quot;400662900&quot;,      &quot;longitude&quot;: 120.6260196  &#125;,...]</code>，<br/>读取属性时 需要根据数据格式做修改</strong><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 初始化地图</span></span><br><span class="line">map = <span class="keyword">new</span> mapboxgl.<span class="title class_">Map</span>(&#123;</span><br><span class="line">	<span class="attr">container</span>: <span class="string">&#x27;map&#x27;</span>,</span><br><span class="line">	<span class="attr">style</span>: <span class="string">&#x27;http://106.120.201.126:14724/style_zpark.json&#x27;</span>,</span><br><span class="line">	<span class="attr">zoom</span>: <span class="number">19</span>,</span><br><span class="line">	<span class="attr">maxZoom</span>: <span class="number">22</span>,</span><br><span class="line">	<span class="attr">minZoom</span>: <span class="number">4</span>,</span><br><span class="line">	<span class="attr">center</span>: [<span class="number">116.28686</span>, <span class="number">40.0518</span>],</span><br><span class="line">	<span class="attr">pitch</span>: <span class="number">65</span>,</span><br><span class="line">	<span class="attr">bearing</span>: <span class="number">15</span>,</span><br><span class="line">&#125;)</span><br><span class="line"><span class="comment">// 地图加载完成 -&gt; 创建3D场景 加载模型</span></span><br><span class="line">map.<span class="title function_">on</span>(<span class="string">&#x27;style.load&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">	map.<span class="title function_">on</span>(<span class="string">&#x27;click&#x27;</span>, <span class="function">(<span class="params">e</span>) =&gt;</span> &#123;</span><br><span class="line">		<span class="variable language_">console</span>.<span class="title function_">log</span>(e)</span><br><span class="line">	&#125;)</span><br><span class="line">	<span class="comment">// 添加3D图层，以支持three模型加载</span></span><br><span class="line">	map.<span class="title function_">addLayer</span>(&#123;</span><br><span class="line">		<span class="attr">id</span>: <span class="string">&#x27;vehicle3D&#x27;</span>,</span><br><span class="line">		<span class="attr">type</span>: <span class="string">&#x27;custom&#x27;</span>,</span><br><span class="line">		<span class="attr">renderingMode</span>: <span class="string">&#x27;3d&#x27;</span>,</span><br><span class="line">		<span class="attr">onAdd</span>: <span class="function">(<span class="params">map, mbxContext</span>) =&gt;</span> &#123;</span><br><span class="line">			<span class="comment">// threebox场景</span></span><br><span class="line">			<span class="variable language_">window</span>.<span class="property">tb</span> = <span class="keyword">new</span> <span class="title class_">Threebox</span>(map, mbxContext, &#123;</span><br><span class="line">				<span class="attr">defaultLights</span>: <span class="literal">true</span>,</span><br><span class="line">				<span class="attr">enableSelectingObjects</span>: <span class="literal">false</span>,</span><br><span class="line">			&#125;)</span><br><span class="line">			<span class="comment">// 加载模型 若为vue项目则对应的模型文件需要放在public目录下，路径省略public即可引入</span></span><br><span class="line">			<span class="variable language_">window</span>.<span class="property">tb</span>.<span class="title function_">loadObj</span>(</span><br><span class="line">				&#123;</span><br><span class="line">					<span class="attr">obj</span>: <span class="string">`./car0.gltf`</span>,</span><br><span class="line">					<span class="attr">type</span>: <span class="string">&#x27;gltf&#x27;</span>,</span><br><span class="line">					<span class="attr">units</span>: <span class="string">&#x27;meters&#x27;</span>,</span><br><span class="line">					<span class="attr">scale</span>: <span class="number">0.8</span>,</span><br><span class="line">					<span class="attr">adjustment</span>: &#123; <span class="attr">x</span>: <span class="number">0.5</span>, <span class="attr">y</span>: <span class="number">1</span>, <span class="attr">z</span>: -<span class="number">0.6</span> &#125;,</span><br><span class="line">					<span class="attr">cloned</span>: <span class="literal">true</span>,</span><br><span class="line">				&#125;,</span><br><span class="line">				<span class="function">(<span class="params">model</span>) =&gt;</span> &#123;</span><br><span class="line">					vehicleModel = model</span><br><span class="line">					<span class="title function_">initWs</span>()</span><br><span class="line">				&#125;</span><br><span class="line">			)</span><br><span class="line">		&#125;,</span><br><span class="line">		<span class="attr">render</span>: <span class="keyword">function</span> (<span class="params">gl, matrix</span>) &#123;</span><br><span class="line">			<span class="variable language_">window</span>.<span class="property">tb</span>.<span class="title function_">update</span>()</span><br><span class="line">		&#125;,</span><br><span class="line">	&#125;)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> lastLocation = [] <span class="comment">// ws上一帧数据</span></span><br><span class="line"><span class="keyword">let</span> vehicleModels = [] <span class="comment">// 存放当前地图中的车辆模型</span></span><br><span class="line"><span class="keyword">let</span> currentLocation = [] <span class="comment">// ws当前帧数据</span></span><br><span class="line"><span class="comment">// 初始化websocket</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">initWs</span>(<span class="params"></span>) &#123;</span><br><span class="line">	<span class="keyword">if</span> (<span class="keyword">typeof</span> <span class="title class_">WebSocket</span> === <span class="literal">undefined</span>) &#123;</span><br><span class="line">		<span class="variable language_">console</span>.<span class="title function_">error</span>(<span class="string">&#x27;您的浏览器不支持socket&#x27;</span>)</span><br><span class="line">	&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">		socket = <span class="keyword">new</span> <span class="title class_">WebSocket</span>(wsURL)</span><br><span class="line">		socket.<span class="property">onopen</span> = <span class="function">(<span class="params">e</span>) =&gt;</span> <span class="title function_">onOpen</span>(e)</span><br><span class="line">		socket.<span class="property">onmessage</span> = <span class="function">(<span class="params">e</span>) =&gt;</span> <span class="title function_">onMsg</span>(e)</span><br><span class="line">		socket.<span class="property">onerror</span> = <span class="function">(<span class="params">e</span>) =&gt;</span> <span class="title function_">onError</span>(e)</span><br><span class="line">		socket.<span class="property">onclose</span> = <span class="function">(<span class="params">e</span>) =&gt;</span> <span class="title function_">onClose</span>(e)</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// websocket连接成功 发送前后端约定好的数据激活推送</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">onOpen</span>(<span class="params">e</span>) &#123;</span><br><span class="line">	<span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;onOpen&#x27;</span>, e)</span><br><span class="line">	e.<span class="property">target</span>.<span class="title function_">send</span>(<span class="title class_">JSON</span>.<span class="title function_">stringify</span>(&#123; <span class="attr">dataType</span>: <span class="string">&#x27;1&#x27;</span>, <span class="attr">leftDownXy</span>: <span class="string">&#x27;123,33&#x27;</span>, <span class="attr">rightUpXy</span>: <span class="string">&#x27;123,33&#x27;</span>, <span class="attr">level</span>: <span class="number">17</span> &#125;))</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 更新模型属性</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">setModel</span>(<span class="params">model, options</span>) &#123;</span><br><span class="line">	<span class="comment">// 修改模型材质颜色 </span></span><br><span class="line">	model.<span class="title function_">traverse</span>(<span class="function">(<span class="params">child</span>) =&gt;</span> &#123;</span><br><span class="line">		<span class="comment">// 根据自己模型材质名称配置，我的模型车辆颜色由name_19材质控制，所以这么写</span></span><br><span class="line">		<span class="keyword">if</span> (child.<span class="property">isMesh</span> &amp;&amp; child.<span class="property">name</span>.<span class="title function_">includes</span>(<span class="string">&quot;_19&quot;</span>)) &#123;</span><br><span class="line">			child.<span class="property">material</span> = child.<span class="property">material</span>.<span class="title function_">clone</span>();</span><br><span class="line">			child.<span class="property">material</span>.<span class="property">color</span>.<span class="title function_">set</span>(<span class="string">&#x27;#000&#x27;</span>); <span class="comment">// 这里我默认给个黑色，可以根据options中自己推送的数据属性或者字典匹配赋值颜色</span></span><br><span class="line">		&#125;</span><br><span class="line">	&#125;);</span><br><span class="line">	<span class="comment">// 加判断防止距离过近模型抖动</span></span><br><span class="line">	<span class="keyword">if</span> (</span><br><span class="line">		turf.<span class="title function_">distance</span>(</span><br><span class="line">			[model.<span class="property">userData</span>.<span class="property">data</span>.<span class="property">longitude</span>, model.<span class="property">userData</span>.<span class="property">data</span>.<span class="property">latitude</span>],</span><br><span class="line">			[options.<span class="property">longitude</span>, options.<span class="property">latitude</span>],</span><br><span class="line">			&#123; <span class="attr">units</span>: <span class="string">&#x27;kilometers&#x27;</span> &#125;</span><br><span class="line">		) &gt; <span class="number">0.0005</span> ||</span><br><span class="line">		options.<span class="property">dill</span> === <span class="string">&#x27;add&#x27;</span></span><br><span class="line">	) &#123;</span><br><span class="line">		model.<span class="title function_">setCoords</span>([options.<span class="property">longitude</span>, options.<span class="property">latitude</span>]) <span class="comment">// 设置经纬度</span></span><br><span class="line">		model.<span class="title function_">setRotation</span>(&#123; <span class="attr">x</span>: <span class="number">90</span>, <span class="attr">y</span>: <span class="number">360</span> - options.<span class="property">courseAngle</span> - <span class="number">90</span>, <span class="attr">z</span>: <span class="number">0</span> &#125;)  <span class="comment">// 设置转向角，根据自己推送数据的角度调整计算</span></span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 根据聚合后的数据处理模型增删改</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">addDelUpdateVehicleModels</span>(<span class="params">allData</span>) &#123;</span><br><span class="line">	<span class="comment">// debugger</span></span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">let</span> item <span class="keyword">of</span> allData) &#123;</span><br><span class="line">		<span class="comment">// 新增</span></span><br><span class="line">		<span class="keyword">if</span> (item.<span class="property">dill</span> === <span class="string">&#x27;add&#x27;</span>) &#123;</span><br><span class="line">			<span class="keyword">let</span> model = vehicleModel.<span class="title function_">duplicate</span>()</span><br><span class="line">			<span class="title function_">setModel</span>(model, item)</span><br><span class="line">			<span class="variable language_">window</span>.<span class="property">tb</span>.<span class="title function_">add</span>(model)</span><br><span class="line">			vehicleModels.<span class="title function_">push</span>(model)</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">for</span> (<span class="keyword">let</span> model <span class="keyword">of</span> vehicleModels) &#123;</span><br><span class="line">			<span class="comment">// 删除</span></span><br><span class="line">			<span class="keyword">if</span> (item.<span class="property">dill</span> === <span class="string">&#x27;del&#x27;</span>) &#123;</span><br><span class="line">				<span class="keyword">if</span> (model.<span class="property">userData</span>.<span class="property">data</span>.<span class="property">id</span> === item.<span class="property">id</span>) &#123;</span><br><span class="line">					<span class="comment">// traverse遍历属性删除 ，要不会一直占用内存</span></span><br><span class="line">					model.<span class="title function_">traverse</span>(<span class="function">(<span class="params">child</span>) =&gt;</span> &#123;</span><br><span class="line">						<span class="keyword">if</span> (child.<span class="property">type</span> === <span class="string">&#x27;Mesh&#x27;</span>) &#123;</span><br><span class="line">							child.<span class="property">geometry</span>.<span class="title function_">dispose</span>()</span><br><span class="line">							child.<span class="property">material</span>.<span class="title function_">dispose</span>()</span><br><span class="line">						&#125;</span><br><span class="line">					&#125;)</span><br><span class="line">					<span class="variable language_">window</span>.<span class="property">tb</span>.<span class="title function_">remove</span>(model)</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="comment">// 更新</span></span><br><span class="line">			<span class="keyword">if</span> (item.<span class="property">dill</span> === <span class="string">&#x27;com&#x27;</span>) &#123;</span><br><span class="line">				<span class="keyword">if</span> (model.<span class="property">userData</span>.<span class="property">data</span>.<span class="property">id</span> === item.<span class="property">id</span>) &#123;</span><br><span class="line">					<span class="title function_">setModel</span>(model, item)</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 格式化list为geojson数据</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">formatArray2Geojson</span>(<span class="params">array</span>) &#123;</span><br><span class="line">	<span class="keyword">let</span> source = &#123;</span><br><span class="line">		<span class="attr">type</span>: <span class="string">&#x27;FeatureCollection&#x27;</span>,</span><br><span class="line">		<span class="attr">features</span>: [],</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">let</span> item <span class="keyword">of</span> array) &#123;</span><br><span class="line">		source.<span class="property">features</span>.<span class="title function_">push</span>(&#123;</span><br><span class="line">			<span class="attr">type</span>: <span class="string">&#x27;Feature&#x27;</span>,</span><br><span class="line">			<span class="attr">properties</span>: item,</span><br><span class="line">			<span class="attr">geometry</span>: &#123;</span><br><span class="line">				<span class="attr">type</span>: <span class="string">&#x27;Point&#x27;</span>,</span><br><span class="line">				<span class="attr">coordinates</span>: [</span><br><span class="line">					item.<span class="property">longitude</span> || item.<span class="property">x</span> || item.<span class="property">xy</span>.<span class="title function_">split</span>(<span class="string">&#x27;,&#x27;</span>)[<span class="number">0</span>],</span><br><span class="line">					item.<span class="property">latitude</span> || item.<span class="property">y</span> || item.<span class="property">xy</span>.<span class="title function_">split</span>(<span class="string">&#x27;,&#x27;</span>)[<span class="number">1</span>],</span><br><span class="line">				],</span><br><span class="line">			&#125;,</span><br><span class="line">		&#125;)</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> source</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 比较前后两帧数据并聚合</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">diff</span>(<span class="params">oldData, newData</span>) &#123;</span><br><span class="line">	<span class="keyword">const</span> add = newData.<span class="title function_">filter</span>(<span class="function">(<span class="params">e</span>) =&gt;</span> !oldData.<span class="title function_">find</span>(<span class="function">(<span class="params">c</span>) =&gt;</span> c.<span class="property">id</span> === e.<span class="property">id</span>))</span><br><span class="line">	<span class="keyword">const</span> del = oldData.<span class="title function_">filter</span>(<span class="function">(<span class="params">e</span>) =&gt;</span> !newData.<span class="title function_">find</span>(<span class="function">(<span class="params">c</span>) =&gt;</span> c.<span class="property">id</span> === e.<span class="property">id</span>))</span><br><span class="line">	<span class="keyword">const</span> com = newData.<span class="title function_">filter</span>(<span class="function">(<span class="params">e</span>) =&gt;</span> oldData.<span class="title function_">find</span>(<span class="function">(<span class="params">c</span>) =&gt;</span> c.<span class="property">id</span> === e.<span class="property">id</span>))</span><br><span class="line">	add.<span class="title function_">forEach</span>(<span class="function">(<span class="params">a</span>) =&gt;</span> (a.<span class="property">dill</span> = <span class="string">&#x27;add&#x27;</span>))</span><br><span class="line">	del.<span class="title function_">forEach</span>(<span class="function">(<span class="params">d</span>) =&gt;</span> (d.<span class="property">dill</span> = <span class="string">&#x27;del&#x27;</span>))</span><br><span class="line">	com.<span class="title function_">forEach</span>(<span class="function">(<span class="params">c</span>) =&gt;</span> (c.<span class="property">dill</span> = <span class="string">&#x27;com&#x27;</span>))</span><br><span class="line">	<span class="keyword">return</span> [...add, ...del, ...com]</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// websocket接收消息回调</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">onMsg</span>(<span class="params">data</span>) &#123;</span><br><span class="line">	<span class="keyword">let</span> dataArray = <span class="title class_">JSON</span>.<span class="title function_">parse</span>(data.<span class="property">data</span>)</span><br><span class="line">	<span class="keyword">let</span> newArray = dataArray.<span class="title function_">filter</span>(<span class="function">(<span class="params">item</span>) =&gt;</span> &#123;</span><br><span class="line">		<span class="keyword">return</span> item.<span class="property">type</span> != <span class="number">4</span> &amp;&amp; item.<span class="property">type</span> != <span class="number">5</span> &amp;&amp; item.<span class="property">type</span> != <span class="number">6</span></span><br><span class="line">	&#125;)</span><br><span class="line">	<span class="keyword">let</span> geojsonData = <span class="title function_">formatArray2Geojson</span>(newArray)</span><br><span class="line">	<span class="comment">// 每个模型上添加对应的车牌号mapbox 2D图层，并随着推送数据更新</span></span><br><span class="line">	<span class="keyword">if</span> (!map.<span class="title function_">getSource</span>(<span class="string">&#x27;vehicle_data&#x27;</span>)) &#123;</span><br><span class="line">		map.<span class="title function_">addSource</span>(<span class="string">&#x27;vehicle_data&#x27;</span>, &#123; <span class="attr">type</span>: <span class="string">&#x27;geojson&#x27;</span>, <span class="attr">data</span>: geojsonData &#125;)</span><br><span class="line">	&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">		map.<span class="title function_">getSource</span>(<span class="string">&#x27;vehicle_data&#x27;</span>).<span class="title function_">setData</span>(geojsonData)</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">if</span> (!map.<span class="title function_">getLayer</span>(<span class="string">&#x27;idLayer&#x27;</span>)) &#123;</span><br><span class="line">		map.<span class="title function_">addLayer</span>(&#123;</span><br><span class="line">			<span class="attr">id</span>: <span class="string">&#x27;idLayer&#x27;</span>,</span><br><span class="line">			<span class="attr">type</span>: <span class="string">&#x27;symbol&#x27;</span>,</span><br><span class="line">			<span class="attr">source</span>: <span class="string">&#x27;vehicle_data&#x27;</span>,</span><br><span class="line">			<span class="attr">layout</span>: &#123;</span><br><span class="line">				<span class="string">&#x27;text-field&#x27;</span>: [<span class="string">&#x27;get&#x27;</span>, <span class="string">&#x27;id&#x27;</span>],</span><br><span class="line">				<span class="string">&#x27;text-size&#x27;</span>: <span class="number">12</span>,</span><br><span class="line">				<span class="string">&#x27;text-allow-overlap&#x27;</span>: <span class="literal">true</span>,</span><br><span class="line">			&#125;,</span><br><span class="line">			<span class="attr">paint</span>: &#123;</span><br><span class="line">				<span class="string">&#x27;text-color&#x27;</span>: <span class="string">&#x27;#fff&#x27;</span>,</span><br><span class="line">				<span class="string">&#x27;text-halo-blur&#x27;</span>: <span class="number">1</span>,</span><br><span class="line">				<span class="string">&#x27;text-halo-color&#x27;</span>: <span class="string">&#x27;#01309b&#x27;</span>,</span><br><span class="line">				<span class="string">&#x27;text-halo-width&#x27;</span>: <span class="number">3</span>,</span><br><span class="line">			&#125;,</span><br><span class="line">		&#125;)</span><br><span class="line">		map.<span class="title function_">setLayoutProperty</span>(<span class="string">&#x27;idLayer&#x27;</span>, <span class="string">&#x27;visibility&#x27;</span>, <span class="string">&#x27;visible&#x27;</span>)</span><br><span class="line">	&#125;</span><br><span class="line">	currentLocation = newArray</span><br><span class="line">	<span class="keyword">let</span> allData = <span class="title function_">diff</span>(lastLocation, currentLocation)</span><br><span class="line">	lastLocation = newArray</span><br><span class="line">	<span class="title function_">addDelUpdateVehicleModels</span>(allData)</span><br><span class="line">	<span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;intervalTime&#x27;</span>).<span class="property">innerText</span> = newArray[<span class="number">0</span>].<span class="property">dateTime</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// websocket错误...</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">onError</span>(<span class="params">e</span>) &#123;</span><br><span class="line">	<span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;onError&#x27;</span>, e)</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// websocket关闭...</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">onClose</span>(<span class="params">e</span>) &#123;</span><br><span class="line">	<span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;onClose&#x27;</span>, e)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li>逻辑代码注释已经很完备了，还是不清楚的话对应<code>api</code>可以参考<code>mapbox</code>及<code>threebox</code>文档即可 <code>^_^</code></li>
</ol>
]]></content>
      <categories>
        <category>前端</category>
      </categories>
      <tags>
        <tag>Javascript</tag>
        <tag>Mapbox</tag>
        <tag>Threejs</tag>
        <tag>Websocket</tag>
      </tags>
  </entry>
  <entry>
    <title>基于websocket数据使用threejs和tween实现数据平滑播放</title>
    <url>/2025/03/17/%E5%9F%BA%E4%BA%8Ewebsocket%E6%95%B0%E6%8D%AE%E4%BD%BF%E7%94%A8threejs%E5%92%8Ctween%E5%AE%9E%E7%8E%B0%E6%95%B0%E6%8D%AE%E5%B9%B3%E6%BB%91%E6%92%AD%E6%94%BE/</url>
    <content><![CDATA[<h5 id="最近在项目中实现了基于-websocket-数据的-threejs-车流孪生展示，其中有几个问题及其思路在这里记录一下"><a href="#最近在项目中实现了基于-websocket-数据的-threejs-车流孪生展示，其中有几个问题及其思路在这里记录一下" class="headerlink" title="最近在项目中实现了基于 websocket 数据的 threejs 车流孪生展示，其中有几个问题及其思路在这里记录一下"></a>最近在项目中实现了基于 <code>websocket</code> 数据的 <code>threejs</code> 车流孪生展示，其中有几个问题及其思路在这里记录一下</h5><ol>
<li><code>websocket</code> 数据是实时推送的，且帧数不超过1秒30帧，肉眼可见的卡顿，所以必然需要补帧</li>
<li>既然需要补帧那就只有两个思路<ol>
<li>一就是对数据做插帧，这种做法计算量较大，且插值后的数据可能还不能达到流畅观感，需要再次插值</li>
<li><strong>二就是结合 <code>tween</code> 做平滑动画</strong></li>
</ol>
</li>
<li>第一种办法个人实践过，当时由于 <code>websocket</code> 数据量本身不小，再加上多次插值与 <code>threejs</code> 场景渲染实体更新，性能较差阻塞了 <code>socket</code>，导致 <code>socket</code> 数据堆积<br>后续有上网了解过可以使用 <code>webworker</code> 把插值计算放到另外的线程处理，但当时由于工期问题不了了之了。</li>
<li><strong>在这里着重说下第二种办法，也是实现了并且效果较好</strong><ol>
<li><code>tween</code> 补帧的原理是已知起点和终点，给定一个时间区间，在 <code>onUpdate</code> 里不断更新，实现平滑动画</li>
<li>但是由于 <code>socket</code> 接收到数据只有当前值，即只有终点&#x2F;起点一个值，所以需要对数据做缓存</li>
<li><code>socket</code> 数据做了缓存 保存几帧 并不够，还需要对给定的上一帧和下一帧做时间的差值计算，再做一个时间区间的数据缓存</li>
<li>这时数据准备完毕，开始执行渲染操作</li>
<li>当缓存的数据超过了设定的大小时，开始执行渲染函数，第一帧只添加实体，后续在渲染时不断地取缓存数据的第1个元素值，调用 <code>tween</code> 设置起点（实体当前位置）和终点（第1个缓存数据）和区间时间（缓存的时间区间第1个元素）</li>
<li><code>tween</code> 的 <code>onUpdate</code> 中不断更新目标实体的 <code>position</code> 和其他需要控制的属性</li>
<li><code>tween</code> 的 <code>onComplete</code> 中移除已使用的缓存数据，并判断缓存数据大小，<strong>递归执行下一次更新</strong></li>
</ol>
</li>
<li>以上就是所有实现步骤，亲测按这个方法的实现效果还是不错的 <code>&gt;.&lt;</code></li>
</ol>
]]></content>
      <categories>
        <category>前端</category>
      </categories>
      <tags>
        <tag>Threejs</tag>
      </tags>
  </entry>
  <entry>
    <title>记一次Cesium的property插值用法</title>
    <url>/2023/04/23/%E8%AE%B0%E4%B8%80%E6%AC%A1Cesium%E7%9A%84property%E6%8F%92%E5%80%BC%E7%94%A8%E6%B3%95/</url>
    <content><![CDATA[<h4 id="cesium-中描述-entity-随时间动态变化时，必然要用到-property-插值，来对应时间和实体的状态，最近有用到这个属性，记录一下："><a href="#cesium-中描述-entity-随时间动态变化时，必然要用到-property-插值，来对应时间和实体的状态，最近有用到这个属性，记录一下：" class="headerlink" title="cesium 中描述 entity 随时间动态变化时，必然要用到 property 插值，来对应时间和实体的状态，最近有用到这个属性，记录一下："></a><code>cesium</code> 中描述 <code>entity</code> 随时间动态变化时，必然要用到 property 插值，来对应时间和实体的状态，最近有用到这个属性，记录一下：</h4><p><strong>一般常用的插值有两种，一种是连续值插值<code>SampleProperty</code>，即给个时间段和一个状态区间，<code>cesium</code>会在区间内自己做平滑处理；<br>一种是枚举值插值<code>TimeIntervalCollectionProperty</code>，即一个时间段对应一个状态，不会做平滑插值。</strong></p>
<p><em>假设现在有一个entity：</em></p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> myEntity = vie.<span class="property">entities</span>.<span class="title function_">add</span>(&#123;</span><br><span class="line">  <span class="attr">id</span>: options.<span class="property">id</span>,</span><br><span class="line">  <span class="attr">model</span>: &#123;</span><br><span class="line">    <span class="attr">uri</span>: <span class="string">`gltf/car.gltf`</span>,</span><br><span class="line">    <span class="attr">scale</span>: <span class="number">0.8</span>,</span><br><span class="line">    <span class="attr">minimumPixelSize</span>: <span class="number">32</span>,</span><br><span class="line">    <span class="attr">color</span>: <span class="title class_">Cesium</span>.<span class="property">Color</span>.<span class="title function_">fromCssColorString</span>(<span class="string">&#x27;#ff0&#x27;</span>),</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>以下的<code>source</code>都是若干个 <code>&#123;时间，对应值组成的对象&#125;</code> 组成的数组list</p>
<span id="more"></span>

<ol>
<li><code>SampleProperty</code>用法：</li>
</ol>
<p><em>首先是特殊的<code>SampledProperty</code>，使用<code>SampledPositionProperty</code>，方便设置entity的位置</em></p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> propertyPosition = <span class="keyword">new</span> <span class="title class_">Cesium</span>.<span class="title class_">SampledPositionProperty</span>();</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">let</span> item <span class="keyword">of</span> source) &#123;</span><br><span class="line">  <span class="keyword">let</span> time = <span class="title class_">Cesium</span>.<span class="property">JulianDate</span>.<span class="title function_">fromDate</span>(<span class="keyword">new</span> <span class="title class_">Date</span>(item.<span class="property">timeStamp</span>));</span><br><span class="line">  <span class="keyword">let</span> position = <span class="title class_">Cesium</span>.<span class="property">Cartesian3</span>.<span class="title function_">fromDegrees</span>(item.<span class="property">longitude</span>, item.<span class="property">latitude</span>, -<span class="number">1</span>);</span><br><span class="line">  <span class="comment">// 为每个 timeStamp 添加 经纬度位置信息，以实现entity平滑移动</span></span><br><span class="line">  propertyPosition.<span class="title function_">addSample</span>(time, position);</span><br><span class="line">&#125;</span><br><span class="line">myEntity.<span class="property">position</span> = propertyPosition</span><br></pre></td></tr></table></figure>

<p><em>其次是普通的<code>SampledProperty</code>，可以随意设置自定义的number值，平滑线性处理</em></p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> customProperty = <span class="keyword">new</span> <span class="title class_">Cesium</span>.<span class="title class_">SampledProperty</span>(<span class="title class_">Number</span>);</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; source.<span class="property">length</span>; i++) &#123;</span><br><span class="line">  <span class="keyword">let</span> time = <span class="title class_">Cesium</span>.<span class="property">JulianDate</span>.<span class="title function_">fromDate</span>(<span class="keyword">new</span> <span class="title class_">Date</span>(source[i].<span class="property">timeStamp</span>));</span><br><span class="line">  customProperty.<span class="title function_">addSample</span>(time, source[i].<span class="property">speed</span>)</span><br><span class="line">&#125;</span><br><span class="line">myEntity.<span class="property">customProperty</span> = customProperty</span><br></pre></td></tr></table></figure>

<ol start="2">
<li><code>TimeIntervalCollectionProperty</code>用法：</li>
</ol>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> property = <span class="keyword">new</span> <span class="title class_">Cesium</span>.<span class="title class_">TimeIntervalCollectionProperty</span>(<span class="title class_">Number</span>);</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; source.<span class="property">length</span> - <span class="number">1</span>; i++) &#123;</span><br><span class="line">  <span class="comment">// 为每个时间段添加一个值属性 （timeInterval试了下用fromDate不生效，只能用Iso8601转，后续再研究下为啥到底可不可以）</span></span><br><span class="line">  property.<span class="property">intervals</span>.<span class="title function_">addInterval</span>(</span><br><span class="line">    <span class="title class_">Cesium</span>.<span class="property">TimeInterval</span>.<span class="title function_">fromIso8601</span>(&#123;</span><br><span class="line">      <span class="attr">iso8601</span>: <span class="string">`<span class="subst">$&#123;<span class="keyword">new</span> <span class="built_in">Date</span>(source[i].timeStamp).toISOString()&#125;</span>/<span class="subst">$&#123;<span class="keyword">new</span> <span class="built_in">Date</span>(source[i + <span class="number">1</span>].timeStamp).toISOString()&#125;</span>`</span>,</span><br><span class="line">      <span class="attr">isStartIncluded</span>: <span class="literal">true</span>,</span><br><span class="line">      <span class="attr">isStopIncluded</span>: <span class="literal">false</span>,</span><br><span class="line">      <span class="attr">data</span>: source[i].<span class="property">courseAngle</span></span><br><span class="line">    &#125;)</span><br><span class="line">  )</span><br><span class="line">&#125;</span><br><span class="line">myEntity.<span class="property">timeIntervalProperty</span> = property</span><br></pre></td></tr></table></figure>

<hr>
<p><strong>上述各种<code>property</code>赋值给<code>entity</code>后，监听<code>clock</code>时间变化取到对应的值，即可进行对应业务逻辑的实现</strong></p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">viewer.<span class="property">clock</span>.<span class="property">onTick</span>.<span class="title function_">addEventListener</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// let getProperty = myEntity.customProperty.getValue(viewer.clock.currentTime)</span></span><br><span class="line">  <span class="comment">// let getProperty = myEntity.timeIntervalProperty.getValue(viewer.clock.currentTime)</span></span><br><span class="line">  <span class="keyword">let</span> getProperty = myEntity.<span class="property">position</span>.<span class="title function_">getValue</span>(viewer.<span class="property">clock</span>.<span class="property">currentTime</span>)</span><br><span class="line">  <span class="comment">// todo</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<hr>
<p><em>至于混合的property：<code>CompositeProperty</code><br>，即把上述两种property混合到一个property的用法，实现部分时间段线性变化，部分时间段跳跃枚举变化，理论上提供了对应的api，是可以实现的，由于暂时没用到，不做记录，后续遇到再研究。。。</em></p>
]]></content>
      <categories>
        <category>前端</category>
      </categories>
      <tags>
        <tag>Cesium</tag>
        <tag>Javascript</tag>
      </tags>
  </entry>
  <entry>
    <title>记录Promise.all用法</title>
    <url>/2022/05/07/%E8%AE%B0%E5%BD%95Promise-all%E7%94%A8%E6%B3%95/</url>
    <content><![CDATA[<h6 id="场景：页面中多个耗时请求返回的数据的集合需要作为另一个业务的前置数据"><a href="#场景：页面中多个耗时请求返回的数据的集合需要作为另一个业务的前置数据" class="headerlink" title="场景：页面中多个耗时请求返回的数据的集合需要作为另一个业务的前置数据"></a>场景：页面中多个耗时请求返回的数据的集合需要作为另一个业务的前置数据</h6><h6 id="使用方法示例："><a href="#使用方法示例：" class="headerlink" title="使用方法示例："></a>使用方法示例：</h6><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> newNum = <span class="number">0</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 第一个耗时请求 返回第一个数据</span></span><br><span class="line"><span class="keyword">var</span> firstSlow = <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function"><span class="params">resolve</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// 模拟一个耗时请求</span></span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">axios</span>.<span class="title function_">get</span>(<span class="string">&#x27;/xxx&#x27;</span>).<span class="title function_">then</span>(<span class="function"><span class="params">res</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="title function_">resolve</span>(<span class="number">2</span>)</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;)</span><br><span class="line"><span class="comment">// 第二个耗时请求 返回第二个数据</span></span><br><span class="line"><span class="keyword">var</span> secondSlow = <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function"><span class="params">resolve</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// 模拟一个耗时请求</span></span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">axios</span>.<span class="title function_">get</span>(<span class="string">&#x27;/yyy&#x27;</span>).<span class="title function_">then</span>(<span class="function"><span class="params">res</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="title function_">resolve</span>(<span class="number">3</span>)</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;)</span><br><span class="line"><span class="comment">// 使用promise.all()等待以上两个请求返回数据后执行某些操作</span></span><br><span class="line"><span class="title class_">Promise</span>.<span class="title function_">all</span>([firstSlow,secondSlow]).<span class="title function_">then</span>(<span class="keyword">function</span>(<span class="params">res</span>)&#123; <span class="comment">// 此处的 res 值应为 [2, 3]</span></span><br><span class="line">  <span class="comment">// 拿到以上两个请求返回的数据进行处理</span></span><br><span class="line">  newNum = res[<span class="number">0</span>] + res[<span class="number">1</span>]</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(newNum) <span class="comment">// newNum = 5</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>前端</category>
      </categories>
      <tags>
        <tag>Javascript</tag>
        <tag>异步同步</tag>
      </tags>
  </entry>
  <entry>
    <title>处理拉取代码或者push时git提示Failed to connect to github.com port 443 after 21090 ms: Couldnt connect to server</title>
    <url>/2025/01/21/%E5%A4%84%E7%90%86%E6%8B%89%E5%8F%96%E4%BB%A3%E7%A0%81%E6%88%96%E8%80%85push%E6%97%B6git%E6%8F%90%E7%A4%BAFailed-to-connect-to-github-com-port-443-after-21090-ms-Couldnt-connect-to-server/</url>
    <content><![CDATA[<ul>
<li>最近在 <code>github</code> 更新博客模板代码时，碰到提示 <code>Failed to connect to github.com port 443 after 21090 ms: Couldnt connect to server</code> <br><br>试过刷新 <code>dns</code> 缓存，开关梯子等操作，都不好使，后来使用一个方法，最终处理了这个问题，在这里记录一下</li>
</ul>
<ol>
<li>因为我这边网络本身不挂梯子进不去 <code>github</code>，所以我这里的前置条件是开着代理</li>
<li>从 window 设置里，进入 <code>网络和 Internet</code> -&gt; <code>代理</code> -&gt; <code>使用代理服务器</code>右边的<code>编辑</code></li>
<li>然后看代理的端口是多少，例如是 <code>7897</code></li>
<li>在命令行输入以下 设置 <code>git</code> 的代理端口 <figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">git config --global http.proxy 127.0.0.1:7897</span><br><span class="line">git config --global https.proxy 127.0.0.1:7897</span><br></pre></td></tr></table></figure></li>
<li>最后重新试下拉取或者提交<br><br>✌好使了，完活 -.-</li>
</ol>
]]></content>
      <categories>
        <category>通用</category>
      </categories>
      <tags>
        <tag>Git</tag>
      </tags>
  </entry>
  <entry>
    <title>记录一下vue3的hooks</title>
    <url>/2025/01/18/%E8%AE%B0%E5%BD%95%E4%B8%80%E4%B8%8Bvue3%E7%9A%84hooks/</url>
    <content><![CDATA[<h4 id="在24年开始，个人逐步从-vue2-迁移到了-vue3-框架的开发，但是在开发过程中的体现也只是部分写法的转变，一些很好用的特性并没有深入学习，单文件过大的拆解前期也仅仅停留在-function-的提取，在这里记录一下后来前两个月才开始使用的-hooks-写法"><a href="#在24年开始，个人逐步从-vue2-迁移到了-vue3-框架的开发，但是在开发过程中的体现也只是部分写法的转变，一些很好用的特性并没有深入学习，单文件过大的拆解前期也仅仅停留在-function-的提取，在这里记录一下后来前两个月才开始使用的-hooks-写法" class="headerlink" title="在24年开始，个人逐步从 vue2 迁移到了 vue3 框架的开发，但是在开发过程中的体现也只是部分写法的转变，一些很好用的特性并没有深入学习，单文件过大的拆解前期也仅仅停留在 function 的提取，在这里记录一下后来前两个月才开始使用的 hooks 写法"></a>在24年开始，个人逐步从 <code>vue2</code> 迁移到了 <code>vue3</code> 框架的开发，但是在开发过程中的体现也只是部分写法的转变，一些很好用的特性并没有深入学习，单文件过大的拆解前期也仅仅停留在 <code>function</code> 的提取，在这里记录一下后来前两个月才开始使用的 <code>hooks</code> 写法</h4><ol>
<li><p>首先创建 <code>hooks</code> <code>js</code> 文件，在我项目中涉及到了 <code>webgis</code> 模块的多个业务图层的分隔处理，比如加载红绿灯图层并根据数据每秒驱动渲染的逻辑单独封装一个 hooks，可以大大方便后续其他模块对这个功能调用的便捷性。而且有些图层的加载与更新涉及的代码量很大，也可以减少单文件行数，方便后续维护，功能模块的 <code>bug</code> 也更好排查。 <br><br>以下给一个简单的示例 <code>useExampleHooks.js</code>，记录一下。。。</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> (initNum) =&gt; &#123;</span><br><span class="line">    <span class="keyword">let</span> convertRuleNum = <span class="title function_">ref</span>(initNum)</span><br><span class="line">    <span class="title function_">onMounted</span>(<span class="function">()=&gt;</span>&#123;</span><br><span class="line">        <span class="keyword">const</span> apiResult = <span class="number">10000</span></span><br><span class="line">        convertRuleNum.<span class="property">value</span> += apiResult</span><br><span class="line">    &#125;)</span><br><span class="line">    <span class="keyword">const</span> <span class="title function_">numConvert</span> = (<span class="params">num</span>) =&gt; &#123;</span><br><span class="line">        <span class="keyword">return</span> num.<span class="title function_">toFixed</span>(<span class="number">2</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 导出要在其他多个模块使用的变量和方法</span></span><br><span class="line">    <span class="keyword">return</span> &#123; convertRuleNum, numConvert &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>在 <code>vue</code> 文件中使用 <code>hooks</code></p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> useExampleHooks <span class="keyword">from</span> <span class="string">&#x27;./useExampleHooks.js&#x27;</span></span><br><span class="line"><span class="keyword">const</span> &#123; convertRuleNum, numConvert &#125; = <span class="title function_">useExampleHooks</span>(<span class="number">10</span>)</span><br></pre></td></tr></table></figure>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span>&gt;</span>&#123;&#123; convertRuleNum &#125;&#125;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span>&gt;</span>&#123;&#123; numConvert(10) &#125;&#125;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure></li>
</ol>
]]></content>
      <categories>
        <category>前端</category>
      </categories>
      <tags>
        <tag>Vue</tag>
      </tags>
  </entry>
  <entry>
    <title>记录一下常用比较好用的css</title>
    <url>/2024/04/29/%E8%AE%B0%E5%BD%95%E4%B8%80%E4%B8%8B%E5%B8%B8%E7%94%A8%E6%AF%94%E8%BE%83%E5%A5%BD%E7%94%A8%E7%9A%84css/</url>
    <content><![CDATA[<h6 id="首先，在工作中秉着能用-css-完成的就不用切图的原则，一些略微特殊的样式还是尽量使用-css-展示以提高页面展示效率，以下是一些常用的属性："><a href="#首先，在工作中秉着能用-css-完成的就不用切图的原则，一些略微特殊的样式还是尽量使用-css-展示以提高页面展示效率，以下是一些常用的属性：" class="headerlink" title="首先，在工作中秉着能用 css 完成的就不用切图的原则，一些略微特殊的样式还是尽量使用 css 展示以提高页面展示效率，以下是一些常用的属性："></a>首先，在工作中秉着能用 css 完成的就不用切图的原则，一些略微特殊的样式还是尽量使用 css 展示以提高页面展示效率，以下是一些常用的属性：</h6><ol>
<li><p>边框渐变（结合边框渐变可以完成比较常见的渐变分割条等效果</p>
<figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="comment">/* 边框渐变 */</span></span><br><span class="line"><span class="comment">/* 渐变方向有多种方式表示 角度 例如90deg 方向 例如to right */</span></span><br><span class="line"><span class="comment">/* 实际使用可以选择顺手的 （方向的可以有更为复杂的组合写法 详见mdn官网 */</span></span><br><span class="line"><span class="attribute">border-width</span>: <span class="number">1px</span>;</span><br><span class="line"><span class="attribute">border-style</span>: solid;</span><br><span class="line"><span class="attribute">border-image-source</span>: <span class="built_in">linear-gradient</span>(<span class="number">90deg</span>, <span class="number">#269cd7</span>, <span class="number">#0090ea</span>);</span><br><span class="line"><span class="attribute">border-image-slice</span>: <span class="number">1</span>; <span class="comment">/* 填充整个边框宽度 */</span></span><br><span class="line"><span class="attribute">border-image-repeat</span>: stretch; <span class="comment">/* 根据需要选择 repeat、stretch 或 round 等重复方式 */</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>背景色渐变</p>
<figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="comment">/* 渐变方向与上面的边框渐变同理 */</span></span><br><span class="line"><span class="comment">/* 首先是 side by side 的渐变 */</span></span><br><span class="line"><span class="attribute">background-image</span>: <span class="built_in">linear-gradient</span>(to right, <span class="number">#0d80d7</span>, <span class="number">#04477b</span>);</span><br><span class="line"><span class="comment">/* 其次是中心渐变 （可以结合div的不同排布 实现热力图展示 */</span></span><br><span class="line"><span class="attribute">background</span>: <span class="built_in">radial-gradient</span>(<span class="built_in">rgba</span>(<span class="number">237</span>, <span class="number">34</span>, <span class="number">44</span>,<span class="number">0.6</span>), transparent, transparent);</span><br></pre></td></tr></table></figure>
</li>
<li><p>多个子元素斑马等样式展示</p>
<figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="comment">/* 涉及到多个子元素不同样式则要用到 nth-child 伪类 */</span></span><br><span class="line"><span class="comment">/* 老是记不清偶数和奇数怎么表示 -.-|  偶数even 奇数odd */</span></span><br><span class="line"><span class="comment">/* 奇数子元素 */</span></span><br><span class="line"><span class="selector-tag">div</span><span class="selector-pseudo">:nth-child</span>(odd) &#123;</span><br><span class="line">    <span class="attribute">background-color</span>: <span class="number">#133260</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/* 偶数子元素 */</span></span><br><span class="line"><span class="selector-tag">div</span><span class="selector-pseudo">:nth-child</span>(even) &#123;</span><br><span class="line">    <span class="attribute">background-color</span>: <span class="number">#112b4e</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>… … 待更新 … …</p>
</li>
</ol>
]]></content>
      <categories>
        <category>前端</category>
      </categories>
      <tags>
        <tag>Css</tag>
      </tags>
  </entry>
  <entry>
    <title>记录一下好用的Js技巧（新手向大佬勿喷）</title>
    <url>/2022/04/20/%E8%AE%B0%E5%BD%95%E4%B8%80%E4%B8%8B%E5%A5%BD%E7%94%A8%E7%9A%84Js%E6%8A%80%E5%B7%A7%EF%BC%88%E6%96%B0%E6%89%8B%E5%90%91%E5%A4%A7%E4%BD%AC%E5%8B%BF%E5%96%B7%EF%BC%89/</url>
    <content><![CDATA[<h6 id="从数组中删除重复项"><a href="#从数组中删除重复项" class="headerlink" title="从数组中删除重复项"></a>从数组中删除重复项</h6><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> deletedArr = [...<span class="keyword">new</span> <span class="title class_">Set</span>(arr)]</span><br></pre></td></tr></table></figure>
<span id="more"></span>
<h6 id="数组排序"><a href="#数组排序" class="headerlink" title="数组排序"></a>数组排序</h6><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> <span class="title function_">sortFunction</span> = (<span class="params">a, b</span>) =&gt; &#123;</span><br><span class="line">  <span class="keyword">return</span> a - b</span><br><span class="line">&#125;</span><br><span class="line">[<span class="number">3</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">1</span>, <span class="number">4</span>].<span class="title function_">sort</span>(sortFunction) <span class="comment">//[1, 2, 2, 3, 4]</span></span><br></pre></td></tr></table></figure>

<h6 id="从对象数组中取得某属性为指定值的元素"><a href="#从对象数组中取得某属性为指定值的元素" class="headerlink" title="从对象数组中取得某属性为指定值的元素"></a>从对象数组中取得某属性为指定值的元素</h6><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> data = [&#123;<span class="attr">type</span>:<span class="string">&#x27;test0&#x27;</span>, <span class="attr">name</span>:<span class="string">&#x27;name1&#x27;</span>&#125;,&#123;<span class="attr">type</span>:<span class="string">&#x27;test1&#x27;</span>, <span class="attr">name</span>:<span class="string">&#x27;name2&#x27;</span>&#125;,&#123;<span class="attr">type</span>:<span class="string">&#x27;test1&#x27;</span>, <span class="attr">name</span>:<span class="string">&#x27;name3&#x27;</span>&#125;]</span><br></pre></td></tr></table></figure>

<p>1. </p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> findSingle = data.<span class="title function_">find</span>(<span class="function">(<span class="params">dataItem</span>) =&gt;</span> &#123; <span class="comment">//注意：.find()方法会返回找到的第一个元素，即使有多个符合条件的</span></span><br><span class="line">  <span class="keyword">return</span> (dataItem.<span class="property">type</span> === <span class="string">&quot;test1&quot;</span>)</span><br><span class="line">&#125; <span class="comment">// [&#123;type:&#x27;test1&#x27;, name:&#x27;name2&#x27;&#125;]</span></span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<p>2. </p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> filterArr = data.<span class="title function_">filter</span>(<span class="function">(<span class="params">item</span>)=&gt;</span>&#123; <span class="comment">// .filter()方法会筛选出所有符合条件的元素，并组合成新的数组</span></span><br><span class="line">  <span class="keyword">return</span> item.<span class="property">type</span> == <span class="string">&#x27;test1&#x27;</span></span><br><span class="line">&#125;) <span class="comment">// [&#123;type:&#x27;test1&#x27;, name:&#x27;name2&#x27;&#125;, &#123;type:&#x27;test1&#x27;, name:&#x27;name3&#x27;&#125;]</span></span><br></pre></td></tr></table></figure>

<p><strong>区别</strong><br>find() 返回第一个元素<br>filter() 返回一个包含所有通过测试函数的元素的新数组</p>
<h6 id="二维数组一维展开-reduce方法"><a href="#二维数组一维展开-reduce方法" class="headerlink" title="二维数组一维展开(reduce方法)"></a>二维数组一维展开(reduce方法)</h6><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> arr = [[<span class="number">1</span>, <span class="number">2</span>, <span class="number">4</span>],[<span class="number">3</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>]]</span><br><span class="line"><span class="keyword">var</span> newArr = arr.<span class="title function_">reduce</span>(<span class="keyword">function</span>(<span class="params">a, b</span>)&#123;</span><br><span class="line">  <span class="keyword">return</span> a.<span class="title function_">concat</span>(b)</span><br><span class="line">&#125;, [])</span><br><span class="line"><span class="comment">// newArr: [1,2,4,3,3,4,5]</span></span><br></pre></td></tr></table></figure>

<p>&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;</p>
<p>待续……</p>
]]></content>
      <categories>
        <category>前端</category>
      </categories>
      <tags>
        <tag>Javascript</tag>
        <tag>ES6</tag>
      </tags>
  </entry>
  <entry>
    <title>谷歌浏览器滚动条样式优化</title>
    <url>/2022/04/21/%E8%B0%B7%E6%AD%8C%E6%B5%8F%E8%A7%88%E5%99%A8%E6%BB%9A%E5%8A%A8%E6%9D%A1%E6%A0%B7%E5%BC%8F%E4%BC%98%E5%8C%96/</url>
    <content><![CDATA[<h6 id="众所周知-谷歌浏览器默认的滚动条很丑-，在项目中非常影响美观，还好可以使用-css-样式控制，代码如下："><a href="#众所周知-谷歌浏览器默认的滚动条很丑-，在项目中非常影响美观，还好可以使用-css-样式控制，代码如下：" class="headerlink" title="众所周知 谷歌浏览器默认的滚动条很丑 -.-| ，在项目中非常影响美观，还好可以使用 css 样式控制，代码如下："></a>众所周知 谷歌浏览器默认的滚动条很丑 -.-| ，在项目中非常影响美观，还好可以使用 css 样式控制，代码如下：</h6><span id="more"></span>
<figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="comment">/*滚动条样式：谷歌浏览器下*/</span></span><br><span class="line">::-webkit-scrollbar &#123;</span><br><span class="line">    <span class="attribute">width</span>: <span class="number">8px</span>;</span><br><span class="line">    <span class="attribute">height</span>: <span class="number">8px</span>;</span><br><span class="line">    <span class="attribute">background-color</span>: transparent;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*滚动条的轨道*/</span></span><br><span class="line">::-webkit-scrollbar-track &#123;</span><br><span class="line">    <span class="attribute">background-color</span>: <span class="number">#18354c</span>;</span><br><span class="line">    <span class="attribute">border</span>: <span class="number">1px</span> solid <span class="built_in">rgba</span>(<span class="number">92</span>, <span class="number">151</span>, <span class="number">219</span>, <span class="number">1</span>);</span><br><span class="line">    <span class="attribute">border-radius</span>: <span class="number">4px</span>;</span><br><span class="line">    <span class="attribute">padding</span>: <span class="number">0</span> <span class="number">1px</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*滚动条的滑块按钮*/</span></span><br><span class="line">::-webkit-scrollbar-thumb &#123;</span><br><span class="line">    <span class="attribute">border-radius</span>: <span class="number">3px</span>;</span><br><span class="line">    <span class="attribute">width</span>: <span class="number">6px</span>;</span><br><span class="line">    <span class="attribute">height</span>: <span class="number">6px</span>;</span><br><span class="line">    <span class="attribute">background-color</span>: <span class="number">#5c97db</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*滚动条的上下两端的按钮*/</span></span><br><span class="line">::-webkit-scrollbar-button &#123;</span><br><span class="line">    <span class="attribute">height</span>: <span class="number">0</span>;</span><br><span class="line">    <span class="attribute">width</span>: <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>前端</category>
      </categories>
      <tags>
        <tag>Css</tag>
      </tags>
  </entry>
</search>
